\documentclass[a4paper, 11pt]{report}
\usepackage[czech]{babel}
\usepackage[utf8]{inputenc}
\usepackage{multirow}
\usepackage{amsmath}
\usepackage{amsfonts}

\usepackage{geometry}
\usepackage{layout}

\geometry{
  includeheadfoot,
  hmargin=2.0cm,
  vmargin={0cm, 1.0cm}
}

\usepackage{color}
\usepackage[unicode,colorlinks,hyperindex,plainpages=false,pdftex]{hyperref}

\usepackage{listings}  
\definecolor{mygreen}{rgb}{0,0.6,0}
\lstset{language=VHDL,commentstyle=\color{mygreen},tabsize=4}

\usepackage{fancyhdr}
\pagestyle{fancyplain}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}

\cfoot{\hfill © Jakuje \hfill \thepage }


\begin{document}

Chybí: 1, 4, 7, 13, 14, 15, 26, 28, 29

\ref{cha:1}
\ref{cha:2}
\ref{cha:3}
\ref{cha:4}
\ref{cha:5}
\ref{cha:6}
\ref{cha:7}
\ref{cha:8}
\ref{cha:9}
\ref{cha:10}

\ref{cha:11}
\ref{cha:12}
\ref{cha:13}
\ref{cha:14}
\ref{cha:15}
\ref{cha:16}
\ref{cha:17}
\ref{cha:18}
\ref{cha:19}
\ref{cha:20}

\ref{cha:21}
\ref{cha:22}
\ref{cha:23}
\ref{cha:24}
\ref{cha:25}
\ref{cha:26}
\ref{cha:27}
\ref{cha:28}
\ref{cha:29}
\ref{cha:30}

\ref{cha:31}
\ref{cha:32}
\ref{cha:33}
\ref{cha:34}
\ref{cha:35}
\ref{cha:36}
\ref{cha:37}
\ref{cha:38}
\ref{cha:39}
\ref{cha:40}

\newpage

\tableofcontents


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Princip činnosti polovodičových prvků} \label{cha:1}

???

(dioda, bipolární a unipolární tranzistor ve spínacím režimu, realizace logických členů NAND a NOR v technologii CMOS)

%1. Princip činnosti polovodičových prvků
%Za tu minutu jsem si moc nestihnul napsat, ale lepsi nez nic. Zacal jsem diodou, ale chteli napred vedet co je to polovodic. Rekl jsem ze to je material, ktery vede el. proud jen za urcitych podminek. Pak jsem tedy nakreslil PN prechod, oznacil +/- v propustnem smeru, zeptal se me, kde jsou diry a elektrony, tak jsem to tam nakreslil. Pak chtel VA charakteristiku, taky jsem nakreslil a zminil jsem, ze prurazem se znici (chtel jsem zminit Zenerovu jeste, ale nedostal jsem se), pak chtel nakreslit bipolarni a unipolarni tranzistor, bipolarni jsem nakrelil v kolecku a unipolarni bez kolecka, u unipolarniho jsem ale oznacil vyvody taky jako B, C, E (misto S, G, D), ale to mu az tak nevadilo. Zeptal se me asi spis ze zajimavosti, jestli vim, proc se kresli nekdy s koleckem a bez, normalne bych k tomu dosel, ale radsi jsem neriskoval, ze budu placat, tak rekl on, ze to je pouzdro a ze kdyz jsou na integrovanem obvode, tak jsou bez kolecka. Pak cim se tranzistor spina, tak jsem nejdriv spatne rikal ze napetim na bazi, pak jsem si uvedomil, ze zalezi na proudu mezi bazi a emitorem, pak se zeptal jak je to u toho unipolaru, tam jsem rikal ze je to tim napetim a ze se tam tvori vodivy "tunel" (misto kanal ). Nakonec chtel abych nakreslil zapojeni trazistoru ktere realizuji NAND, v tom jsem se motal. Zvonil budik ale nechal me tam neco stvorit, nakreslil jsem dva tranzistory v serii, tak se me alespon zeptal, co realizuje to co jsem nakreslil, tak jsem rikal ze AND (on doplnil ze s tim ze to neni komplementarni - chybi tam ty dalsi dva). V podstate dobry, zbytecne jsem zmatkoval, na nem bylo videt, ze by to chtel kvalitneji a na lepsi urovni. Zkouska tedy za C.





















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Kombinační logické obvody} \label{cha:2}

2. semestr, INC, 3. přednáška

(multiplexor, demultiplexor, kodér, dekodér, binární sčítačka)

Hierarchicky uspořádaný obvod, ve kterém jednotlivé komponentu zpracovávají informaci reprezentovanou v binární podobě (log. úrovně) a mezi sebou komunikují.

\subsection{Komponenty}
\begin{itemize}
	\item Kombinační chování
	\item Každý vstup připojen pouze k jednomu výstupu (výstupy nelze spojovat)
	\item Struktura neobsahuje cykly (zpětné vazby)
\end{itemize}

Členy AND (\&), OR ($\geq{}1$), NOT (1$\circ$), NAND (\&$\circ$), NOR ($\geq{}1\circ$), XOR ($=1$).

Aktivitu v log. 0 značí $\circ$.

Moduly: Složitější komponenty složené z jednodušších log. členů. Vykonávají specifickou, často používanou funkci. Stavební bloky obvodu.

\section{Demultiplexor}

\begin{description}
	\item[D] 1 datový vstup
	\item[A] N adresových vstupů
	\item[Y] $2^N$ výstupů
\end{description}

Přenos logické úrovně z D na jeden z výstupů Y. Ostatní neaktivné. Výstup určen binární hodnotou A.

DMX 1-$2^N$

\subsection{DMX 1-4}

\begin{itemize}
	\item Vstupy: $D$, $A_1$, $A_0$
	\item Výstupy: $Y_3$, $Y_2$, $Y_1$, $Y_0$
\end{itemize}

\begin{tabular}{ |c c c | c c c c |}
\hline
\multicolumn{3}{ | c |}{Vstupy} & \multicolumn{4}{ | c |}{Výstupy} \\
$D$ & $A_1$ & $A_0$ & $Y_3$ & $Y_2$ & $Y_1$ & $Y_0$ \\ \hline
0 & 0 & 0 & 0 & 0 & 0 & \textbf{0} \\ 
0 & 0 & 1 & 0 & 0 & \textbf{0} & 0 \\
0 & 1 & 0 & 0 & \textbf{0} & 0 & 0 \\
0 & 1 & 1 & \textbf{0} & 0 & 0 & 0 \\ \hline

1 & 0 & 0 & 0 & 0 & 0 & \textbf{1} \\ 
1 & 0 & 1 & 0 & 0 & \textbf{1} & 0 \\
1 & 1 & 0 & 0 & \textbf{1} & 0 & 0 \\
1 & 1 & 1 & \textbf{1} & 0 & 0 & 0 \\ \hline
\end{tabular}

\section{Dekodér}

Demultiplexor s D=1. N adresních vstupů, $2^N$ výstupů.

Použití: adresový dekodér, pro displeje, nebo paměti.

Může obsahovat povolovací vstup, potom se chová stejně jako DMX.

\subsection{DC 2 - 4}

\begin{tabular}{ |c c | c c c c |}
\hline
\multicolumn{2}{ | c |}{Vstupy} & \multicolumn{4}{ | c |}{Výstupy} \\
$A_1$ & $A_0$ & $Y_3$ & $Y_2$ & $Y_1$ & $Y_0$ \\ \hline
 0 & 0 & 0 & 0 & 0 & \textbf{1} \\ 
 0 & 1 & 0 & 0 & \textbf{1} & 0 \\
 1 & 0 & 0 & \textbf{1} & 0 & 0 \\
 1 & 1 & \textbf{1} & 0 & 0 & 0 \\ \hline
\end{tabular}

Pro více vstupů a výstupů: Paralelní struktura, Stromová (řešení omezeného množství vstupů AND), Maticová.

Použití pro generování logických funkcí: $X,Y,Z \to DC \to OR \to f(X,Y,Z)$

\subsection{Dekodér BCD}

Převod binárního čísla BCD na danou reprezentaci Dekodér 1 z 10.

\subsection{Dekodér pro 7segmentový displej}

Dekodér 1 z 7. 

\section{Multiplexor}

\begin{description}
	\item[S] N adresových vstupů
	\item[D] $2^N$ datových vstupů
	\item[Y] 1 datový výstup
\end{description}

MX, MUX. Opak demultiplexoru. Na základ binární kombinace na S přivede na Y jeden z vstupů na D.

Realizace log. funkcí: Proměnné na S, Na D přivést $V_{CC}$, nebo $GND$.

\section{Kodér}

\begin{description}
	\item[X] $2^N$ datových vstupů
	\item[A] N výstupů
\end{description}

Výstupem je binární reprezentace pořadí aktivního vstupu. Nedefinované chování při více aktivních vstupech.

\section{Prioritní kodér}

Výstupem navíc GS, které říká, zda je vybraný alespoň jeden vstup a má definované chování i pro více aktivních vstupů.

\section{Binární sčítačka poloviční (Half Adder)}

Nemá vstup carry (přenos z nižšího řádu)

\begin{description}
	\item[Vstup] X, Y
	\item[C] Carry, $ c = x \cdot y$
	\item[S] Suma, $ s = y \oplus x$
\end{description}

\begin{tabular}{ |c | c | c | c |}
 \hline
 x & y & c & s \\ \hline
 0 & 0 & 0 & 0 \\
 0 & 1 & 0 & 1 \\
 1 & 0 & 0 & 1 \\
 1 & 1 & 1 & 0 \\ \hline
\end{tabular}

\section{Binární sčítačka úplná (Full Adder}

\begin{description}
	\item[Vstup] $x_i$, $y_i$
	\item[$c_{i-1}$] Vstup carry z nižšího řádu
	\item[$c_i$] Carry, $ c_i = x_i \cdot y_i + x_i \cdot c_{i-1} + y_i \cdot c_{i-1}$
	\item[$s_i$] Suma, $ s_i = x_i \oplus y_i \oplus c_{i-1}$
\end{description}

Vícebitová - zřetězení - levné a pomalé (přenos carry přes celou kaskádu). Zrychlení paralelní strukturou, nebo Carry lookahead.

\section{Další}

Test na shodu, Test na nulu, Komparátor, Válcový posouvač.





















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Sekvenční logické obvody } \label{cha:3}

2. semestr, INC, 4 - 6. přednáška

(klopné obvody, čítače, registry, stavové automaty – reprezentace a implementace)

\begin{description}
	\item[Kombinační obvody] Výstup závislý pouze na hodnotách vstupního vektoru
	\item[Sekvenční obvody] Hodnoty výstupního vektoru jsou funkcí současných i minulých hodnot vstupního vektoru
\end{description}

\begin{description}
	\item[Synchronní] jednoduchý návrh, KO pro paměť stavu, synchronizováno hodinovým isgnálem, Vzorkování vstupů.
	\item[Asynchronní] složitý návrh
	\begin{description}
		\item[Fundamentální režim činnosti] Vstup musí být stabilní, než se obvod ustálí, jednom okamžiku lze provést pouze jednu změnu vstupů a čekat na ustálení. Paměť = zpoždění.
		\item[Pulsní režim činnosti] Vstup je aktivní pouze v určitou dobu = pulzy, pouze jeden pulz může být aplikován na vstup.
	\end{description}
\end{description}


\subsection{Paměť}
Pamatuje si vektor vnitřního (současného) stavu.

\section{Model - reprezentace}

Modelujeme jako sekvenční automaty - šestice $A = (X, Y, Q, q_0, P, V)$
\begin{description}
	\item[$X$] Vstupní abeceda
	\item[$Y$] Výstupní abeceda
	\item[$Q$] Vnitřní abeceda (stavy)
	\item[$q_0$] Počáteční stav
	\item[$P$] Přechodová funkce, která některým $X \times Q$ přiřazuje prvek z $Q$
	\item[$V$] Výstupní funkce, která některým $X \times Q$ přiřazuje prvek z $Y$
\end{description}

\subsection{Výstupní funkce}
\begin{description}
	\item[Maelyho automat] $y_i = V(x_i, q_i)$ Vstupem funkce je stav a vstup
	\item[Mooreův automat] $y_i = V(q_i)$ Vstupem je pouze aktuální stav
\end{description}

Přechodová funkce na základě vstupu a aktuálního stavu generuje hodnotu následujícího stavu.

\subsection{Graf přechodů}

\begin{itemize}
	\item Stav = Uzel
	\item Přechod = Orientovaná hrana
	\item Vstupy = ohodnocení hrany
	\item Výstupy = K hraně za lomítko (Mealy), nebo k uzlu za lomítko (Moore)
\end{itemize}

\subsection{Tabulka přechodů}

\begin{itemize}
	\item Řádky - stavy a Moorovy výstupy
	\item Sloupce - vstupy
	\item Průsečíky - následující stavy a Mealyho výstupy
\end{itemize}

Paměť -- volatilní -- informace lze číst a ukládat dle potřeby. Nevolatilní -- čtení podle potřeby, zápis jednorázový nebo pomalý (FLASH). Nejčastěji klopné obvody -- rychlé, dva stavy 0 a 1. Bistabilní klopné obvody (KO).

\subsection{Zpoždění signálů}

\begin{description}
	\item[Inerční zpoždění] Způsobené setrvačností, parazitními kapacitami. Pulz musí být minimální délky, aby obvodem prošel.
	\item[Transportní zpoždění] Dáno rychlostí šíření signálu v daném médiu. Dříve využíváno jako paměti
	\item[Zpožďovací linka] Informace vložená na začátku se na konci objeví až po určitém čase  (vhodné médium, např. rtuť).
\end{description}

\section{Klopné obvody}

\subsection{RESET SET -- R-S KO}

Sestavený z členů NOR. Hladinový -- RS Latch.

Nejjednodušší, dva stavy, třetí nevalidní.

\begin{description}
	\item[R = 0, S = 1] SET Nastaví stav na 1
	\item[R = 1, S = 0] RESET Nastaví stav na 0
	\item[R = 0, S = 0] HOLD Drží poslední nastavený stav na výstupu
	\item[R = 1, S = 1] Zakázaný vstup, nedefinovaný výstup
\end{description}

\subsection{RESET SET s povolovacím vstupem -- Gated R-S Latch}

Nastavit a nulovat lze pouze s C=1 (controll, clock).

\subsection{D KO s povolovacím vstupem -- Transparent D Latch}

Spojení vstupů SET a RESET (přes invertor) na D.

\begin{description}
	\item[C = 1, D = X] STORE Nastaví do paměti hodnotu na vstupu D (Transparent mode)
	\item[C = 0, D = X] HOLD Drží poslední nastavený stav na výstupu (Latch mode)
\end{description}

\subsection{J-K KO s povolovacím vstupem -- Gated J-K Latch}

Zpětnou vazbou eliminuje zakázanou kombinaci. Nový stav TOGGLE.

\begin{description}
	\item[C = 0 nebo J=K=0] HOLD Drží poslední nastavený stav na výstupu
	\item[C = 1, K = 1] RESET Nastaví do paměti 0
	\item[C = 1, J = 1] SET Nastaví do paměti 1
	\item[C = K = J = 1] TOGGLE Překlop stav v paměti
\end{description}

\subsection{T KO s povolovacím vstupem -- Gated T Latch}

Spojení J a K do T. Pokud trvale C=T=1, neustále osciluje -- řešení Master-Slave, Edge-triggered KO.

\begin{description}
	\item[C = 0 nebo T=0] HOLD Drží poslední nastavený stav na výstupu
	\item[C = T = 1] TOGGLE Překlop stav v paměti
\end{description}

\subsection{Dvoufázové KO}

Realizace pomocí dvou KO s povolovacím vstupem přivedeném z CLK.

Informace se při CLK=0 zapisuje do Mater KO, při CLK=1 do Slave KO, odkud je po celou dobu hodinového pulzu předávána na výstup (do změny stavu z Master).

\begin{description}
	\item[R-S KO] Master-Slave R-S Flip-Flop
	\item[J-K KO] Master-Slave J-K Flip-Flop
	\item[T KO] Master-Slave T Flip-Flop
	\item[D KO] Master-Slave D Flip-Flop
\end{description}

\subsection{Derivační KO}

Úmyslné generování log. hazardu (krátký impulz) pomocí nestejné délky logické větve -- zpoždění invertoru. Generováno s hranou hodinového signálu na povolovací vstup KO.

Změna stavu může nastat pouze ve chvíli změny hrany hodin. signálu.

\begin{description}
	\item[R-S KO] Edge-Triggered R-S Flip-Flop
	\item[J-K KO] Edge-Triggered J-K Flip-Flop
	\item[T KO] Edge-Triggered T Flip-Flop
	\item[D KO] Edge-Triggered D Flip-Flop
\end{description}


\section{Sekvenční logické obvody}
	
Kombinační log. síť --sdružuje přechodovou (NS = Next State) a výstupní funkcí (Mealy, Moore)

Paměť -- pamatuje si vektor vnitřního (současného) stavu (PS = Present State). Realizováno pomocí registru z klopných obvodů, řízených hodinovým isgnálem CLK. Často inicializace (RST).

\begin{description}
	\item[+] Stačí dodržet časy Thold, Tsetup definované pro jednotlivé KO
	\item[+] Jednoduchá automatická syntéza
	\item[-] Přizpůsobení nejpomalejšímu KO (lze omezit vhodným návrhem)
	\item[-] Vyžadován stabilní CLK (malý jitter a malé zpoždění (skew) mezi jednotlivými KO
\end{description}

Tabulka přechodů KO (opak k pravdivostní tabulce).

\begin{tabular}{| *{2}{c} | *{2}{c} | *{2}{c} | c | c |}
	\hline
	$Q_t$ & $Q_{t+1}$ & $S$ & $R$ & $J$ & $K$ & $D$ & $T$ \\ \hline
	0 & 0 & 0 & X & 0 & X & 0 & 0 \\
	0 & 1 & 1 & 0 & 1 & X & 1 & 1 \\
	1 & 0 & 1 & 1 & X & 1 & 0 & 1 \\
	1 & 1 & X & 0 & X & 0 & 1 & 0 \\
	\hline
\end{tabular}


Kódování stavů automatu -- každý stav musí mít unikátní kód:
\begin{description}
	\item[Binární] binární hodnota čísla stavu
	\item[One-hot] Každý stav má k dispozici jeden KO
	\item[Johnsonův, Grayův, Kompaktní] ...
\end{description}

\section{Asynchronní čítač (binární)}

asynchronní = nemá centrální hodinový signál, který synchronizuje všechno KO současně.

Tříbitový: 3 J-K KO zapojení jako T K. QN připojeno na C dalšího KO. Generuje posloupnost 0,1,2,3,4,5,6,7,0,1 ...

Výstup platný až po ustálení všech výstupů.

\subsection{Asynchronní čítač (mod 10) dekadický}

Výstupy Q1 a Q3 (hodnota 10) přes NAND hradlo se provádí asynchronní nulování všech KO (= Nulovací pulz = Glitch. Velmi krátký).

\subsection{Asynchronní čítač modulo 12}

První dva KO počítají 0 -- 3. Další dva je třeba nulovat př přechodu na hodnotu 3.

Standardní čítač 4bitový: IO 7493 - dva hodinové vstupy CLKA (první KO) a CLKB (ostatní KO), dva resety RO1, RO2.

\section{Synchronní čítač}

\begin{itemize}
	\item Při aktivním CLK automat přechází ze stavu do stavu
	\item Často více nastavení, směr počítání UP/DOWN
	\item indikace přetečení Ripple Carry Output (Kaskádní - pomalejší ustálení, Paralelní - rychlejší, složitější)
	\item Clock enable
	\item Dělící poměr
	\item Kaskáda -- RCO připojit na vstup CE dalšího
\end{itemize}

Například pro generování Grayova kódu.

Použití jako dělička kmitočtu (synchronní i asynchronní). Při zapojení v kaskádě se dělící poměry násobí.

Například digitální hodiny: $60Hz => DIV 10 => DIV 6 => (1 Hz) => sekundy => DIV 60 => minuty => DIV 60 => hodiny$

Převod paralelní posloupnosti na sériovou: CTR DIV 8 jako data select MUX. Paralelní data o šířce 8 bitů. Výstup sériová linka.

\section{Posuvné registry}

synchronní, sestavené z KO. Sériové/paralelní vstupy/výstupy, shift/rotate left/right

Použité například jako kruhový čítač.

Univerzální posuvný registr.















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Hierarchie paměti v počítači} \label{cha:4}

5. semestr, IPZ, ?. přednáška

(typy a principy pamětí, princip lokality, organizace rychlé vyrovnávací paměti)





















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Vestavěné systémy} \label{cha:5}

?. semestr, ??, ?. přednáška

(mikrokontrolér, periferie, rozhraní, převodníky)





























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Principy řízení a připojování periferních zařízení} \label{cha:6}

5. semestr, IPZ, 1. - 4. přednáška ??

(přerušení, programová obsluha, přímý přístup do paměti, sběrnice)

\paragraph{Periferní operace} komunikace na které se podílejí:

Počítač (procesor) -- systémová sběrnice -- adaptér (řadič) PZ -- V/V (I/O) sběrnice -- PZ

\subsection{Zahájení periferní operace}

\begin{itemize}
	\item V ASM nastavený bit \uv{start operace} = 1, součástí stavového registru
	\item V řadiči řídící a stavový registr. Řadič pozná, že je adresován, vloží obsah datové části sběrnice do adresového registru. V odpovědi vloží obsah adresovaného registru na datovou sběrnici. Signály řízení jsou generovány instrukcemi vstupu a výstupu.
\end{itemize}

\subsection{Komunikace mezi procesorem a  řadičem PZ}

Komunikace s registry řadiče (R/W) - před zahájením a po dokončení PO:
\begin{description}
	\item[Izolovaný vstupy a výstupy] Instrukce IN a OUT -- dekodér, datová sběrnice přivedena na všechny vstupy, pouze na jeden povolení na základě komparátoru požadované části adresy. \uv{Zápis do registru}
	\item[Adresy registrů mapovány do adresového prostoru OP] \uv{Zápis do paměti} odvozen od instrukce pro práci s pamětí.
	
	Nepřímá adresace: Registr (nebo paměť) adresován obsahem registru, nikoliv obsahem adresové části sběrnice. Adresu je potřeba do registru nejprve vložit (OUT).
\end{description}


Mezi univerzálním registrem procesoru a registry řadiče.

Nelze mezi pamětí a registrem řadiče, protože by v jednu chvíli musel být adresy obou na sběrnici.

DMA -- přímý přístup do paměti bez účasti procesoru -- řízeno řadičem DMA, který v tu chvíli ovládá sběrnici.

\section{Systémová sběrnice}

ISA, EISA, PCI -- postupné zvyšování rychlosti a šířky.

PIO (Programmed Input/Output) a DMA (Direct Memory Access). Různé rychlosti, potřeba vyvíjet výkon obou dvou.

Rychlost závisí na:
\begin{itemize}
	\item kmitočtu synchronizace [MHz],
	\item šířce sběrnice,
	\item technologii (paralelní / sériová).
\end{itemize}

Typy informací přenášené po sběrnici:
\begin{itemize}
	\item data,
	\item adresy,
	\item příkazy,
	\item stavové informace.
\end{itemize}

Nejprve jsou vystavena data, poté je generován řídící signál. Ten určuje platnost dat. Následuje vložení informace z datové sběrnice do registru (řízeno hodinami).

\subsection{Nesdílená sběrnice}
(ISA) -- data, adresy, příkazy a stav -- každý typ informace je vystaven na samostatné sadě vodičů

\subsection{Sdílená sběrnice}
(PCI) všechny typy signálů na stejná sadě vodičů. Rozšířeno o identifikační signály, které rozlišují typ informace v každém okamžiku nebo je význam zajištěn pomocí časového multiplexu -- přenášení informace ve vymezených časových intervalech.

\paragraph{Konstrukce} Rozvody na systémové desce, konektory pro komunikaci s řadiči PZ.

\paragraph{Služby} Přenos dat, adresy, řízení (přenos informace, inicializace a realizace DMA, přerušení), stavové informace

\subsection{Signál o shodě adres}
Interní signál řadiče ISA, nebo signálem sběrnice (DEVSEL) u PCI.

Problém s různými rychlostmi -- řešení dedikovaná sběrnice (AGP)

\begin{description}
	\item[Tradiční architektura (ISA)] Rychlá paměť, ostatní jsou pomalé
	
	Local Bus -- Procesor a cache
	
	System Bus -- Paměť
	
	Expansion Bus -- Síť, SCSI, modem, serial
	
	\item[Vyšší typy PC] každý ze segmentů je na jiné frekvenci
	
	Procesor -- Local Bus -- Cache -- System Bus -- Memory
	
	Cache -- High Speed Bus -- Graphics, LAN, Video, SCSI
	
	High Speed Bus -- Expansion Bus -- Serial, Modem, FAX
	
	\item[PCI]
	
	norhtbridge -- transformace sběrnice procesoru na sběrnici PCI
	
	southbridge -- transformace PCI sběrnice na rozhraní PZ
\end{description}

\subsection{V/V procesor}

Procesor nemá přístup k registrům řadičů, procesor komunikuje s řadiči jednotným způsobem -- signální sledy.

Snaha o sjednocení konstrukce řadičů -- V/V procesor v řadiči PZ -- jednotná komunikace s PZ přes V/V procesor, jednotně konstruované ovladače

V/V procesor -- Univerzální přenosový procesor -- UPPR -- obsahuje mikroprogram.

\subsection{SCSI}
host adapter na straně procesoru, řadič SCSI a řadiče PZ na straně PZ, ovládání pomocí signálových sledů.

\subsection{UNIBUS}
všechny prvky na sběrnici stejné úrovně, umějí řídit sběrnici a komunikovat mezi sebou (např. disk -- tiskárna)

\subsection{PZ u počítačů 3. generace}
kanálová koncepce -- IBM. PZ a řadiče jsou jeden celek, komunikace pomocí signálových sledů. Kanál = program/počítač

\begin{description}
	\item[Multiplexní kanál] Pro pomalá PZ (tiskárny)
	\item[Selekční kanál] Pro rychlá PZ (disky)
\end{description}

Podobné jako DMA, ale data procházela přes kanál.

\subsection{Princip přidělování sběrnice}

Rozhodnutí se, ze kterého zařízení na sběrnici se bude vysílat.

\begin{description}
	\item[Centralizované] Řídící prvek -- Arbitr, rozhoduje podle priorit (u PCI northbridge). V řídící části sběrnice probíhají signály pro přidělení datové.
	\item[Distribuované] Prvky na sběrnici se musí \uv{domluvit}
\end{description}

\paragraph{Centrálně řízená sběrnice na výzvy}
Žádost je poslána po společném vodiči, Arbirt vyvolává čísla, PZ se \uv{pozná}, nastaví obsazení sběrnice a přenáší data.

\paragraph{Centrálně řízená postupná obsluha sběrnice}
Žádost na společném vodiči, informace \uv{sběrnice volná} přeposílána  z jednoho zařízení na druhé až tomu, které žádost poslalo. To přeposílání zablokuje a obsadí sběrnici.

\paragraph{Decentralizované přidělování sběrnice}
Stejně jako minulé, ale bez arbitra -- žádost připojena na vstup zařízení, která si signál předávají dále, dokud se nedojde k odesílateli. Například SCSI -- pro každé zařízení jeden bit.

\section{Principy konstrukce Systémové sběrnice}

Řízení, adresa, data. Propojení dvou a více zařízení, vysílá jedno zařízení, přijímat mohou všechny. 

\subsection{Adresová část}
Jak adresovat dvě zařízení (zdroj, cíl)?
\begin{itemize}
	\item Implicitně -- univerzální registr procesoru
	\item jinak -- při DMA
\end{itemize}

Standardně část adresuje konkrétní PZ a další část konkrétní registr zařízení nebo buňku paměti. Nebo využití signálu pro přidělení sběrnice pro adresaci druhého prvku (např. ISA).

DMA -- řadič PZ, řadič DMA, paměť, systémová 

\subsection{Řídící část}

Signály:
\begin{description}
	\item[Memory Read/Write] Datová část $\to$ paměť
	\item[I/O Read/Write] Datová část $\to$ registr
	\item[Transfer ACK] Potvrzení příjmu
	\item[Bus Request/Grant] Přidělní sběrnice
	\item[Interrupt Request/ACK] přerušení
	\item[Clock, Reset] Synchronizace a nulování
\end{description}

\subsection{Fyzická realizace} rozvody na systémové desce a konektory. V moderních je vše na systémové desce, včetně řadičů PZ -- výhoda: konektor omezuje maximální frekvence/rychlosti.

\paragraph{Synchronní sběrnice}
Operace odvozeny od jedná z hran synchronizačního pulzu -- s hranou kontrola připravenosti obou zařízení.

Hodinový, nebo sběrnicový cyklus -- mezi dvěma sousedními nástupnými hranami.

\paragraph{Asynchronní sběrnice}
Nejsou synchronizační signály, generování signálu vázáno na předchozí události (Read $\to$ ACK, Write $\to$ ACK -- Handshake / Dotaz -- Odpověď).

\paragraph{Sdílená sběrnice (multiplexed)} (PCI)
Časový multiplex, sada signálů postupně využívána pro různé typy informací.

\paragraph{Nesdílená sběrnice (dedicated)} (ISA)
Sada vodičů vyhrazená pro přesný typ informace.

\paragraph{Dedikovaná sběrnice}
Sběrnice vyhrazená pro propojení dvou zařízení.




\section{Řadič PZ (adaptér)}

Princip komunikace s procesorem přes systémovou sběrnici, komunikace s PZ přes V/V sběrnici

Autonomně řídí PZ, zjišťuje stav, předává data, přenáší do procesoru a zpět.

PO
\begin{itemize}
	\item Řídit po celou dobu provádění řadičem (typické signály pro PZ)
	\item Autonomní provádění (kontrola stavu, zahájení PO zápisem do registru PZ, autonomní provádění, uvědomění řadiče a procesory o dokončení (přerušení)
\end{itemize}

\subsection{Kontrola chyb}
\begin{description}	
	\item Stavová slabika (status byte) obsahuje bit značící chybu (any error)
	\item Slabiky závad (sense byte) obsahují pro každý typ chyby PZ jeden bit -- řadič zjistí typ a řeší opravení/opakování atd
\end{description}

Konstrukce: Informace uložená v registrech (datový, řídící), sekvenční automat řídí PO.

\subsection{Vyrovnávací paměť}
Vyrovnává rozdíly v rychlosti zařízení komunikujících mezi sebou. Může být v řadiči, nebo v PZ (tiskárna -- v PZ, řádek nebo stránka, disková paměť -- řadič, sektor, nebo více). Souvisí s potřebou realizovat PO autonomně. 

\subsection{Princip provedení PO}
\begin{enumerate}
	\item Procesor vloží do vyrovnávací paměti data.
	\item Procesor vloží do registrů parametry PO.
	\item Procesor nastaví bit \uv{start operace}.
	\item Sekvenční automat zjistí bit \uv{start operace} a zahájí PO.
	\item Provede autonomně PO bez účasti procesoru.
	\item Řadič generuje žádost o přerušení.
	\item Procesor přečte obsah stavového registru.
	\item Pokud chyba, přečte slabiku závad.
\end{enumerate}

\section{V/V sběrnice}

Komunikace mezi zařízeními na V/V sběrnici podílejících se na PO a řadičem PZ. Často kabel.

Může být pro konkrétní typ PZ (IDE -- disky), nebo pro různé typy (SCSI -- tiskárny, CD, disky -- vyšší úroveň řízení PZ).

\begin{description}
	\item[Blokový režim] přenáší se souvislé bloky dat.
	\item[Slabikový režim] přenáší se po slabikách.
\end{description}

\section{Periferní zařízení}

\paragraph{Autonomní periferní operace}
PZ jsou elektromechanická zařízení, realizace je časově náročná, proto jsou operace procesorem zahájeny a dále jsou řízeny řadičem.

Výstupní periferní operace
\begin{enumerate}
	\item Přenos data z OP do řadiče PZ.
	\item Přenos dat do PZ.
	\item Zahájení PO -- klopný obvod \uv{start operace}.
	\item Autonomní provedení.
	\item Hlášení o dokončení operace.
	\item Analýza stavové informace PO procesorem.
\end{enumerate}

\section{Přerušení}

Po ukončení PO je potřeba synchronně informovat procesor (\uv{požadavek na přerušení}). Jedná se o rozšíření systémové sběrnice, každý řadič PZ může generovat požadavek.


\begin{description}
	\item[Spouštěné hranou] každý řadič má na sběrnici jednu pozici.
	\item[Spouštěné úrovní] více přerušení sdruženo do jednoho signálu.
\end{description}

\subsection{Řadič přerušení}

Sdružuje přerušení (redukce počtu signálů s procesorem -- žádost + potvrzení), řeší priority, předává požadavek procesoru. Posílá také odkaz do tabulky přerušení (vektor přerušení, v PC 255 adres).

\begin{description}
	\item[Vnitřní přerušení] generováno periferiemi na čipu procesoru
	\item[Vnější přerušení] generováno periferiemi na systémové sběrnici
	\item[Programové] generované instrukcí INT x
	\item[Nemaskovatelné] vysoká priorita
\end{description}

\subsection{Přenos dat s využitím DMA -- řadič DMA}
Přenos dat z datového registru (řadič PZ, například disk) přes sběrnici do OP. Řízeno řadičem DMA -- automat, který generuje signály, kterými řídí sběrnici, stejně jako řadič sběrnice. Na dobu přenosu se stává BUS MASTER.

\section{PIO}
Programmed Input/Output -- programové řízení vstupu/výstupu dat -- polling

V řadiči registr, do kterého se z PZ přenese slovo dat a nastaví se bit \uv{konec operace} ve stavovém registru.

Procesor průběžně testuje stavový registr na bit \uv{konec operace}. Jakmile je nastaven, přenese se obsah do některého univerzálního registru a potom do paměti. Obdobné řešení opačným směrem.

Testování přenosem z řadiče do GP registru a tam testování, nebo je součástí speciálně testovatelný bit -- jednodušší operace, náročnější na HW konstrukci.














































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{chapter}{7}
\chapter{Minimalizace logických výrazů} \label{cha:8}

2. semestr, INC, 2. přednáška

(algebraické metody, Karnaughova mapa, Quine McCluskey)

\subsection{Kritéria}
\begin{itemize}
	\item Velikost obvodu (počet hradel, plocha na čipu)
	\item Zpoždění obvodu (rychlost, výkonnost)
	\item Počet proměnných, vodičů
	\item Příkon
\end{itemize}

\subsection{Reprezentace}

\begin{description}
	\item[Výraz] 
		$ F(x,y,z) = \overline{x} \cdot \overline{y} \cdot z + \overline{x} \cdot y \cdot z + x \cdot y \cdot \overline{z}$
	\item[Graf] N-rozměrná jednotková krychle - neorientovaný graf, použitelné max do 4 proměnných. $2^N$ uzlů, kde $N$ je počet proměnných. Barevné zvýraznění hodnot funkce ve vrcholech
	\item[Mapa] Logická mapa (Svobodova, Karnaughova). Sousedná políčka obsahují sousedné kombinace. Do 4 proměnných. V buňkách pod pruhem je log. 1.
	\item[Vennův diagram]
	\item[Tabulka]
		\begin{tabular}{| c | c | c | c | c | }
			\hline
			\multirow{3}{*}{Stavový index s}	& \multicolumn{3}{|c|}{Vstupní stav} & pravdivostní hodnoty \\ \hline
				& 4 & 2 & 1 & F(x,y,z) \\ \hline
				& x & y & z & 	\\ \hline
			0   & 0 & 0 & 0 & 0 \\ \hline
			1   & 0 & 0 & 1 & 1 \\ \hline
			2   & 0 & 1 & 0 & 0 \\ \hline
			3   & 0 & 1 & 1 & 1 \\ \hline
			4   & 1 & 0 & 0 & 0 \\ \hline
			5   & 1 & 0 & 1 & X \\ \hline
			6   & 1 & 1 & 0 & 1 \\ \hline
			7   & 1 & 1 & 1 & X \\ \hline
		\end{tabular}
		
\end{description}

\subsection{Metody}

\begin{description}
	\item[Algebraické] postupnou aplikací axiomů a theorémů booleovy algebry (viz otázka č. \ref{cha:19})
	\item[Grafické] Jednotková krychle, Vennův diagram, Mapy (Svobodova, Karnaughova)
	\item[Algoritmické] Quine-McCluskey, Espresso
\end{description}

\subsection{Hodnocení kvality}
\begin{itemize}
	\item Počet logických členů AND, OR, NOT
	\item V průmysly většinou počet členů NAND (převedených z ostatních)
	\item Počet spojů (vodičů)
	\item Zpoždění
	\item Příkon
\end{itemize}

\subsection{Metriky}
\begin{description}
	\item[P] Počet log. členů
	\item[S] Počet spojů (počet vstupů log. členů + počet výstupů obvodu)
	\item[T] Zpoždění obvodu (součet nejdelší cesty [dt])
\end{description}

\subsection{Hazardy}
Různé délky logických větví, různé zpoždění vodičů a log. členů.

\begin{description}
	\item[Staticky 1 hazard] z log. 1 do 0 a zpět
	\item[Staticky 0 hazard] z log. 0 do 1 a zpět
	\item[Dynamické] více než jeden pulz na výstupu. Více různě dlouhých cest.
\end{description}

Eliminace vzorkováním do registrů. Nebo odstraněním kombinací, které se liší v jedné proměnné a zároveň produkují stejné hodnoty výstupu log. funkce. V Karnaughově mapě jsou to buňky ležící vedle sebe. Řešení - překrytí pomocí přídavných členů (ale už není minimální).

U obvodů s více výstupy lze sdílet části obvodu. Nelze jednoznačně určit (NP-úplný problém).

\subsection{Normální formy}

\begin{description}
	\item[Term] uspořádaná skupina proměnných a operátorů
	\item[ÚNDF] Úplná normální disjunktní forma - suma součinů. Seznam, kde je funkce rovna 1
	\item[ZNDF] Zkrácená normální disjunktní forma - částečně minimalizovaná
	\item[MNDF] Minimální normální disjunktní forma
	\item[ÚNKF] Úplná normální konjunktní forma - součin sum. Seznam, kde je funkce rovna 0, proměnné zapisujeme komplementárně!
	\item[ZNKF] Zkrácená normální konjunktní forma - částečně minimalizovaná
	\item[MNKF] Minimální normální konjunktní forma
\end{description}

Zkrácené zápisy ÚNDF (tam, kde nabývá log. 1):
$$ F(x,y,z) = \lor(0,2,4,6) = 1(0,2,4,6) = \sum{}m(0,2,4,6)$$

Zkrácené zápisy ÚNKF (tam jde nabývá log. 0):
$$ F(x,y,z) = \land(1,3,5,7) = \&(1,3,5,7) = \prod{}M(1,3,5,7)$$

\paragraph{Neúplně definovaná funckce}
Neurčený stav - X - Don't care
$$ F(w,x,y,z) = \lor(2,3,4,6,8,9,13) + x(7,12,14) = \land(0,1,5,10,11,15) \cdot X(7,12,14)$$


\section{Karnaughova mapa}

\begin{enumerate}
	\item Hledáme sousední buňky ve kterých nabývá funkce hodnotu log. 1
	\item Sdružením těchto buněk eliminujeme proměnnou, ve které se proměnná mění.
\end{enumerate}

\section{Jednotková krychle}

\begin{enumerate}
	\item Hledáme stavy, které se liší v jedné proměnné (jsou spojeny hranou)
	\item Lze eliminovat proměnnou, která je rovna rozdílu hodnot příslušných stavů
\end{enumerate}

\section{Quine-McCluskey}

Tabulární metoda, použitelné i pro více než 5 proměnných, na rozdíl od KM a ostatních. Minimální pokrytí hledáme pomocí Petrickovy funkce.

\subsection{Terminologie}
\begin{description}
	\item[Úplný implikant] term ÚNDF, který obsahuje všechny proměnné
	\item[Pokrácený (částečně zkrácený) implikát] některé proměnné eliminovány
	\item[Zkrácený implikant] má všechny sousední proměnné eliminované. Obvod sestavený ze zkrácených implikátů nemá hazardy.
	\item[] Množina minimálních implikátů obsahuje zkrácené implikáty
	\item[Nesporný implikant] Zkrácený implikant, která bude vždy součástí minimálního řešení.
	\item[Volitelný implikant] Zkrácený implikant, který nemusí být součástí min. řešení, pokud lze použít jiný zkrácený implikant
\end{description}

$$F(w,x,y,z) = 1(2,4,6,8,9,10,12,13,15)$$
\begin{tabular}{ | c | c | c |}
	\hline
	Implikant & w.x.y.z & Skupina jedniček \\ \hline
	2	& 0010	& 1 \\ \hline
	4	& 0100	& 1 \\ \hline
	8	& 1000	& 1 \\ \hline
	6	& 0110	& 2 \\ \hline
	9	& 1001	& 2 \\ \hline
	10	& 1010	& 2 \\ \hline
	12	& 1100	& 2 \\ \hline
	13	& 1101	& 3 \\ \hline
	15	& 1111	& 4 \\ \hline
\end{tabular}

\begin{enumerate}
	\item Seřaď do řádků tabulky jednotlivé implikanty v pořadí podle počtu jedniček a podle jejich binárních vah -- skupiny sousedných implikantů
	\item Sepiš do skupin všechny sousedné impikanty, mezi jednotlivými skupinami v tabulce. Eliminovanou proměnnou označ pomlčkou. Opakuj dokud existuje další sousednost. Implikanty, které jsou pokryty jinými, označíme.
	\item Pokud některý implikant nemá další sousedné termy, říkáme mu zkrácený implikant
	\item Hledej minimální řešení, například pomocí Petrickovy funkce, nebo Mřížky implikátů
\end{enumerate}

\subsection{Mřížka implikátů}

\begin{tabular}{| c || c | c | c | c | c | c | c | c | c |}
	\hline
		& 2 & 4 & 6 & 8 & 9 & 10 & 12 & 13 & 15 \\ \hline \hline
	PI1	&   &   &   & x & \textbf{x} &    & x  & x  &    \\ \hline
	PI2	& x &   & x &   &   &    &    &    &    \\ \hline
	PI3	& x &   &   &   &   & x  &    &    &    \\ \hline
	PI4	&   & x & x &   &   &    &    &    &    \\ \hline
	PI5	&   & x &   &   &   &    & x  &    &    \\ \hline
	PI6	&   &   &   & x &   & x  &    &    &    \\ \hline
	PI7	&   &   &   &   &   &    &    & x  & \textbf{x}  \\ \hline
\end{tabular}

PI jsou zkrácení implikanty. Nejprve je třeba najít nesporné implikanty, které pokrývají jako jediné daný vrchol (zde vrcholy 9 a 15 zobrazené tučně). Nesporné implikanty jsou PI1 a PI7.

\section{Petrickova funkce}

\begin{enumerate}
	\item Najdi všechny zkrácené implikanty (Karnaughova mapa nebo Quine-McCluskey)
	\item Pomocí mřížky implikantů nalézt všechny nesporné implikanty.
	\item Z ostatních napsat logický výraz - pro každý nepokrytý implikant sumu zkrácených implikantů, které jej pokrývají.
	\item Výsledné sumy sepsat jako součin (Konjunktní forma)
	\item Vzniklý zápis přepsat do Disjunktní formy roznásobením, poté zjednodušit
	\item Kařdý vzniklý term představuje jedno možné pokrytí
	\item Vyber pokrytí s nejnižší cenou podle vlastních požadavků
\end{enumerate}

















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{chapter}{8}
\chapter{Reprezentace čísel a základní dvojkové aritmetické operace v počítači} \label{cha:9}

2. semestr, INC, 1. přednáška,\\
1. semestr, IAS, 1. a 11. přednáška

(doplňkové kódy, sčítání, odčítání, násobení, pevná a plovoucí řádová čárka, standard IEEE 754)

\section{Reprezentace čísel v počítači}

\subsection{Přirozený / přímý kód}

MSB obsahuje znaménko. Kód obsahuje dvě nuly -- kladnou a zápornou.

\subsection{Doplněk číselné soustavy o základy r}

$$ [N]_r = r^n - (N)_r $$

Rozsah: $ -r^{n-1} \dots r^{n-1} - 1 $. Pouze jedna nula

\subsection{Doplněk číselné soustavy o základy r snížený o 1}

$$ [N]_r = ((r^n -1) - (N)_r)+1$$

Stále dvě nuly. Mezioperace při výpočtu doplňku přičtením jedničky.

\subsection{Konkrétní reprezentace}
\begin{description}
	\item[Jedničkový doplněk] Negace bitů daného čísla.
	\item[Dvojkový doplněk] jedničkový doplněk + přičtení jedničky. Základ aritmetiky počítačů.
\end{description}

\section{Sčítání binárních čísel}

\begin{tabular}{ r | r r}
	+ & 0 & 1 \\ \hline
	0 & 0 & 1 \\
	1 & 1 & (1)0 \\
\end{tabular}

\subsection{Bez znaménka}

Neřešíme přenosy

\subsection{Se znaménkem}

\begin{description}
	\item[Neomezený rozsah] Pouze MSB je vždy znaménko
	\item[Omezený]	Sledovat přetečení do nejvyššího bitu
\end{description}

Přetečení může nastat při sčítání dvou kladných nebo záporných čísel. Detekce speciálním obvodem.

Odečítání bývá často převedeno na sčítání.

\section{Násobení binárních čísel}

\begin{tabular}{ r | r r}
	$\cdot$ & 0 & 1 \\ \hline
	0 & 0 & 0 \\
	1 & 0 & 1 \\
\end{tabular}

\subsection{Bez znaménka}

Neřešíme znaménkový bit a přenosy do něj. Výsledek zobrazený na dvojnásobném počtu bitů.

\begin{tabular}{r}
\ttfamily      1011 \\
\ttfamily   $*$1101 \\ \hline
\ttfamily      1011 \\
\ttfamily     00000 \\
\ttfamily    101100 \\ 
\ttfamily  +1011000 \\ \hline
\ttfamily 100001111
\end{tabular}

\subsection{Se znaménkem ve dvojkovém doplňku}

Kladné číslo záporným -- standardně.

Při násobení znaménkovými bitem -- korekce výsledku přičtením dvojkového doplňku násobitele.

Je třeba šířit znaménku doleva v případě násobení záporného čísla.

\section{Pevná řádová čárka}

číslo má $k$ bitů, $n$ vlevo a $m$ vpravo od řádové čárky (může být i záporné), $m+n = k$.

\begin{description}
	\item[Rozsah zobrazení] Interval ohraničený zleva nejmenším zobrazitelným číslem a zprava největším zobrazitelným číslem
	\item[Rozlišitelnost zobrazení] Nejmenší (kladné) zobrazitelné číslo
	\item[Přesnost zobrazení] Počet platných dekadických číslic, které je možná zobrazit v daném paměťovém prostoru.
\end{description}

\subsection{Bez znaménka}

\begin{description}
	\item[Rozsah zobrazení] $< 0, (2^n - n^m) >$
	\item[Rozlišitelnost zobrazení] $2^m$
	\item[Přesnost zobrazení] $k \log_{10}(2)$
\end{description}

Dnes používáno pouze pro celá čísla (m = 0, n = k). Rozlišitelnost zobrazení = 1, rozsah $<0, (2^n-1)>$

\subsection{Se znaménkem}

Kódy:
\begin{description}
	\item[Přímý] použité pro mantisy reálných čísel (znaménko v samostatném nezávislém bitu)
	\item[Doplňkový] použitý pro celá čísla se znaménkem
	\item[Kód transformované nuly] exponenty reálných čísel. Od doplňkového kódu invertovaný znaménkový bit $X = 128 + x$
\end{description}

Overflow = přenos do zn. bitu $\neq$ přenos nad rozsah.

\section{Pohyblivá řádová čárka}

S | exponent e | mantisa m = $\pm mantisa 2^{exponent}$ 

Dle IEEE 754:
\subsection{Single precission}
32 bit, float

\begin{tabular}{| c | c | c |}
	\hline
	31 & 30 .. 23 & 22 .. 0 \\ \hline
	Sign S  & Exponent e (8b) & Mantisa m (23b) \\ \hline
\end{tabular}

\begin{tabular}{| c | c | l |}
	\hline
	e & f & význam \\ \hline
	$0<e<255$ & * & normalizované číslo, $(-1)^S 2^{(e-127)} 1.f$  \\ \hline
	0 & $f \neq 0$ & nenormalizované číslo, $(-1)^S 2^{-126} 0.f$  \\ \hline
	255 & 0 & $\inf$ \\ \hline
	255 & $f \neq 0$ & NaN \\ \hline
\end{tabular}

\begin{description}
	\item[Rozsah zobrazení] $< -2^{127}, 2^{127} >$
	\item[Rozlišitelnost zobrazení] $2^127$
	\item[Přesnost zobrazení] asi 7 dekadických číslic
\end{description}

\subsection{Double precission}
64 bit, double

\begin{tabular}{| c | c | c |}
	\hline
	63 & 62 .. 52 & 51 .. 0 \\ \hline
	Sign S  & Exponent e (11b) & Mantisa m (52b) \\ \hline
\end{tabular}

\begin{description}
	\item[Rozsah zobrazení] $< -2^{1023}, 2^{1023} >$
	\item[Rozlišitelnost zobrazení] $2^1023$
	\item[Přesnost zobrazení] asi 16 dekadických číslic
\end{description}


















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{chapter}{9}
\chapter{Principy VHDL} \label{cha:10}

2. semestr, INC, 7. přednáška

(entita, architektura, proces, příklady kombinačních a sekvenčních obvodů)

Jak popsat číslicový obvod?
\begin{description}
	\item[Slovně] přirozené, ale pro počítač nepoužitelné
	\item[Matematicky] Stále nelze automaticky implementovat
	\item[Graficky] Pomocí schématu -- Funkční bloky, propojení. Pro velké sítě nepřehledné
	\item[Programovacím jazykem] Popis chování. HDL jazyky -- VHDL (EU), Verilog (USA). Popis funkce obvodu $\to$ modelování, simulace, syntéza do HW.
\end{description}

\section{Entita}

Definuje rozhraní komponenty - signály, generické parametry. Vstupní, výstupní, obousměrné.

\section{Architektura}

Popisuje funkci a chování komponenty.

Jedna entita může mít více architektur. Architektura vždy svázána s konkrétní entitou.

Popis může být na úrovni struktury, chování, nebo data-flow popisu.

\begin{description}
	\item[Behaviorální popis] Složení z jednoho nebo více procesů. Jak se mění vstupy v závislosti na výstupech. Nemusí být zřejmé implementace.
	\item[Strukturální popis] Obsahuje pouze instance komponent a jejich vzájemné propojení
\end{description}

Často kombinované i v rámci jedné komponenty.

\section{Proces}

Obsahuje Sensitivity list -- sledování změn na vstupu pro přepočet výstupů

Může popisovat chování celé komponenty, nebo její části.

Architektura může obsahovat více procesů komunikujících vzájemně pomocí signálů.

Proces nemůže být nikdy ukončen! Pouze pozastaven (WAIT FOR čas, WAIT ON sensitivity list, WAIT UNTIL podmínka). Nelze kombinovat se sensitivity listem.

Může obsahovat běžné řídící struktury:\\
\verb|if then elsif else|\\
\verb|case exp is when val => statement|\\
\verb|while do| \\
\verb|for loop| \\

\lstset{caption=Jednoduchý příklad procesu}
\begin{lstlisting}
process (bus_in) --sensitivity list
	variable count: stc_logic_vector(3 downto 0);
begin
	count := "0000";
	for i in 0 to 15 loop
		if bus_in(i) = '1' then
			count := count + 1;
		end if;
	end loop;
	N_ONE <= count;
end process;
\end{lstlisting}

\lstset{caption={Více procesů (NAND), komunikace pomocí signálu ab\_and}}
\begin{lstlisting}
architecture behav of NAND is
	signal ab_and : std_logic_vector(7 downto 0);
begin
	and_proc : process (A, B)
	begin
		ab_and <= A and B;
	end process and_proc;
	
	not_proc : process(ab_and)
	begin
		Y <= not ab_and;
	end process not_proc;
end behav;
\end{lstlisting}

\subsection{Dataflow popis architektury}

popis datových závislostí na úrovni architektury.

\lstset{caption={Dataflow}}
\begin{lstlisting}
architecture dataflow of NAND is
begin
	Y <= not (A AND B);
end dataflow;
\end{lstlisting}

\subsection{Strukturální popis}

\lstset{caption={Strukturální popis}}
\begin{lstlisting}
architecture struct of CNT1ZN is
signal cnt_bin : std_logic_vector(7 downto 0);
begin
	cnt_i : entity work.cnt
	port map (CLK => CLK, RST => RST, CE => CE, DOUT => cnt_bin);
	dec1n : entity work.dec1n
	port map (addr +> cnt_bin, y => DO);
end struct;
\end{lstlisting}

\subsection{Signály}

komunikace mezi komponentami a procesy

\begin{description}
	\item[Vodič] std\_logic
	\item[Sběrnice] std\_logic\_vector(7 downto 0). 7 = MSB
\end{description}

\paragraph{Atributy signálů}

\verb|<signal>'<atribut>|

\begin{description}
	\item[event] Nastala změna signálu -- například náběžná hrana hodin
	\item[last\_value] Předchozí hodnota
	\item[transaction] Nad signálem je aktivována transakce (naplánována změna na určitý čas)
\end{description}

\subsection{Proměnné}

V procesu. hodnota přiřazená okamžitě, zachována i při opětovném spuštění procesu.

\lstset{caption={}}
\begin{lstlisting}
	variable a: integer := 3;
begin
	a := a + 2;
...
\end{lstlisting}

\begin{description}
	\item[Komentář] \verb|--|
	\item[Znak / bit] \verb|'1'|
	\item[Řetězec / bit. vektor] \verb|"0000"|
	\item[Identifikátor] Písmena a čísla, začíná písmenem
	\item[Výčtový typ]
	\item[Pole] \verb|IS ARRAY|
	\item[Konkatenace bitů] \verb|c <= a & b|
	\item[Posuny] \verb|b <= b(2 downto 0) & '0'|
	\item[Agregace] \verb|a <= ('0', '1', others => '0')|
\end{description}

\lstset{caption={Příklad výčtového typu}}
\begin{lstlisting}
TYPE mup_typ IS (reset, idle, rw, io)l
signal muj_typ: stav;
stav <= reset; -- nelze stav <= "00"
\end{lstlisting}

\subsection{Textbench}





























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Metody rasterizace 2D vektorových objektů: úseček, kružnic a křivek} \label{cha:11}

4. semestr, IZG, 3. a 6. přednáška


\subsection{Počítačová grafika}

CG -- část oboru informatika, zabývá se analýzou, interpretací a tvorbou obrazové informace. Může být 2D $\times$ 3D, vektorová $\times$ rastrová.

\begin{description}
	\item[Rasterizace] Proces převodu vektorových entit na jejich odpovídající rastrové zobrazení. Tento proces probíhá automaticky se snahou o jeho maximální rychlost a kvalitu. Často opakovaný proces, realizován v HW.
	\item[Vektoriazce] Proces převodu rastrového zobrazení objektů na jejich vektorovou reprezentaci. Není triviální a v mnoha případech je nejednoznačný. Není automatizovatelný.
\end{description}

\section{Úsečka}
dva koncové body, rovnice přímky popisující její geometrii.

Obecná rovnice přímky: $(y_1 - y_2) x + (x_2 - x_1) y + C = 0$, Parametrická: $y = kx + q$

Vykreslujeme přímku v prvním kvadrantu, když roste nejvíce ve směru osy X, pokud v jiné poloze, provedeme výměnu os, souřadnic, znamének.

Gradient = strmost.

\subsection{DDA}

Digital Differencial Analyser. Používá FP aritmetiku, málo efektivní. Naivní přístup.

Po ose X se posouváme s přírůstkem 1, na ose Y připočítáváme v každém kroku směrnici ($k = \frac{y_2-y_1}{x_2-x_1}$) a zaokrouhlujeme na nejbližší celé číslo.

\subsection{Error controll DDA}

posun na další řádek, pokud relativní odchylka $ E \geq 0,5$ (inkrementována s každým dalším dx).

\subsection{Bresenhamův algoritmus}

Používá celočíselnou aritmetiku, sčítání a porovnávání, lze jednoduše implementovat v HW grafické karty.

Po ose X stále přírůstek 1, o ose Y rozhodujeme na základě znaménka prediktoru: $P_0 = 2 \Delta y - \Delta x$, pokud $ < 0: P_{i+1} = P_i + 2\Delta y$, jinak posun p ose Y a $P_{i+1} = P_i + 2\Delta y - 2 \Delta x$.

\section{Kružnice}

Definována středem a poloměrem, obecná rovnice: $(x-s_1)^2 + (y-s_2)^2 - R^2 = 0$. 8x symetrická, stačí tedy nakreslit pouze jednu část. Všechny ostatní získáme podobně jako úsečky jiným směrem. Postupujeme od bodu $[0, R]$ do bodu, kde se $x = y$.

\subsection{Naivní algoritmus}
FP aritmetika, Na ose X přírůstek. Hodnotu na ose Y vypočítáme ze obecné rovnice: $y = \sqrt{R^2 + x^2}$ a zaokrouhlíme na celá čísla.

\subsection{Vykreslení jako N-úhelník}

Zvolíme posun o konstantní úhel, body spojujeme úsečkami:

$x_{n+1} = x_n \cos{\alpha} - y_n \sin{\alpha}$

$y_{n+1} = x_n \sin{\alpha} + y_n \cos{\alpha}$

\subsection{Midpoint algoritmus}

Celočíselná aritmetika, rychlé a  efektivní. Podobný jako Bresenhamův algoritmus. Určuje se poloha midpointu vůči kružnici. Změna na ose Y určena znaménkem prediktoru.

$p_0 = 1-R$

$p_{i+1} = p_i + 2 x_i + 3$ pro $p_i < 0$

$p_{i+1} = p_i + 2 x_i - 2y_i + 5$ jinak

\section{Elipsa}
Podobně jako kružnice, 4x symetrická, algoritmus s skládá ze dvou fází podle parciálních derivací (normála ve směru $(1,1)$).

\section{Křivky}

\paragraph{Požadované vlastnosti}
\begin{itemize}
	\item Invariance k lineárním transformacím
	\item Interpolace krajních bodů -- křivka prochází krajními body
	\item Konvexní obálka -- křivka se nachází v konvexní obálce definované řídícími body
	\item Lokalita změn -- lokální, globální
\end{itemize}

\subsection{Dělění}
\begin{description}
	\item[Interpolační křivky] Prochází body
	\item[Aproximační křivky] Neprochází řídícími body
\end{description}

\begin{description}
	\item[Racionální] Váhové koeficienty řídících bodů
	\item[Iracionální] Váhy řídících bodů jsou stejné.
\end{description}

\subsection{Vyjádření}
\begin{itemize}
	\item Matematické: nevhodné pro naše použití
	\item Parametrická 2D křivka: $Q(t) = [x(t), y(t)], t \in <0,1>$
	
	\begin{description}
		\item[Polynomiální křivka] Kubická křivka
		
		$x(t) = a_x t^3 + b_x t^2 + c_x t + d_x$
		
		$y(t) = a_y t^3 + b_y t^2 + c_y t + d_y$
		
		\item[Maticový zápis] $Q(t) = T \cdot C =
\begin{bmatrix}
t^3 & t^2 & t & 1
\end{bmatrix}
\begin{bmatrix}
a_x & a_y\\
b_x & b_y\\
c_x & c_y\\
d_x & d_y\\
\end{bmatrix} = T \cdot M P$ (Bázová matice a matice řídících bodů).
	\end{description}
\end{itemize}

\subsection{Parametrická spojitost křivek $C^N$}
\begin{itemize}	
	\item $C^0$ -- totožnost navazujících koncových bodů
	\item $C^1$ -- totožnost tečnových vektorů u navazujících bodů
	\item $C^2$ -- totožnost vektorů druhé derivace u navazujících bodů
\end{itemize}

Podobně oslabená podmínka spojitosti $G^N$ (totožnost bodů, lineární závislost vektorů).

\paragraph{Spline} po částech polynomiální křivka. Spline N-tého řádu splňuje spojitost $C^{N-1}$.

\paragraph{Fergusonova kubika} Nejčastější, určena dvěma koncovými body a dvěma tečnými vektory. Segmenty navázány shodností koncových bodů a shodností tečných vektorů.

Málo interaktivní a intuitivní řízení tvaru, nelokální změna jedním bodem.

Přirozený spline -- maticové řešení celé křivky pro nulové koncové vektory

\paragraph{Kochanek-Bartels Spline}

Využívá Fergusonových kubik, N tečných bodů s koeficienty $a_i$, $b_i$, $c_i$ (tenze, šikmost, špičatost) určující chování v daném bodě.

\paragraph{Catmul-Rom spline}

N bodů, tečný vektor bodu $P_i$ je rovnoběžný se spojnicí bodů $P_{i-1}$ a $P_{i+1}$. Ekvivalentní Kochanek-Bartels spline s nulovými koeficienty.

Obecně neleží v konvexní obálce! Neprochází koncovými body.

\paragraph{Beziérovy křivky}
Aproximační křivky, křivka stupně N je určena N+1 body. Prochází koncovými body. Polynomiální křivka s použitím Bernsteinových polynomů. Leží v konvexní obálce, k vykreslení se používá algoritmus de Casteljau.

\paragraph{Algoritmus de Casteljau} Rekurzivní algoritmus v vykreslení Beziérových křivek, vychází z rekurzivní definice Bernsteinových polynomů.

Úseky řídícího polynomu jsou děleny v poměru $t : (1-t)$. Nevíme jako zvolit velikost kroku pro získání vhodně rozdělených bodů. Ty potom spojujeme úsečkami.

Výpočet po konstantním kroku t.

\paragraph{Beziérovy kubiky}

segment popsán 4 řídícími body, nelokální změna tvaru, invariantní k lineárním transformacím.

Podmínky pro navazování segmentů pro spojitost $C^1$
\begin{itemize}
	\item Totožnost koncových bodů
	\item Sousední tečné vektory -- koncový bod úseku je středem předposledního bodu $Q_i$ a druhého bodu $Q_{i+1}$
\end{itemize}

\emph{de Casteljau pro Beziérovy kubiky} -- rekurzivní dělení intervalu na dvě podkřivky v polovině ($t = 0,5$). Dostatečně rovná křivka může být vykreslena pohromadě.

\paragraph{Racionální beziérovy křivky} přidávají váhový koeficient řídících bodů, leží v konvexní obálce, nemají rekurentní definici a pro vykreslení nelze použít de Casteljau.

\paragraph{Coonsovy křivky (kubiky)} aproximační, stupeň n určen n+1 řídícími body.

Neprochází koncovými body, pokud dvojíme, bod bude v 1/6 od dalšího bodu, pokud ztrojíme, končí v daném trojbodu.

Segmenty se navazují zopakováním posledních 3 bodů. Nelze pracovat s jednotlivými body, pouze s celým segmentem.

\paragraph{B-Spline křivky}

Zobecnění coonsových křivek, určení n+1 body, křivka stupně k vykazuje spojitost typu k+1.

Uzlový vektor určuje hodnoty parametru t v uzlech. Délka n+k+2. 

Vykreslování algoritmem de Boor.

Uniformní: $t_{i+1} - t_i$ konstantní.

\paragraph{NURBS} Non-Uniform Rational B-Spline -- zobecnění B-Spline křívek, přidány váhové koeficienty.

Invariantní vůči lineárním transformacím.





























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Transformace, reprezentace a zobrazení 3D objektů} \label{cha:12}

5. semestr, IZG, 5. přednáška

Popis objektů v počítači je založen na uzlových bodech, vrcholech.

\paragraph{Vytváření a zobrazování objektů}: Posunutí, rotace, zvětšení, zkosení vrcholů.

Implementace v HW pro vyšší výkon.

\subsection{Způsob aplikace transformace}
Změna souřadného systému do vhodnější pozice.

3D scéna: Rozmístění objektů, umístění kamery (poloha, směr, úhel záběru), souřadný systém scény (posunutí, rotace).

Zobrazení - transformace do souřadného systému kamery = (perspektivní) projekce.

\section{Lineární transformace}

Zobrazení f z jednoho vektorového prostoru do druhého, které zachovává lineární kombinace.

\paragraph{Homogenní souřadnice ve 2D}
Umožňuje pracovat se všemi druhy základních transformací jednotně, pomocí maticového zápisu. Umožňuje skládat transformace a provádět zaráz. Souřadnice bodu $[x, y]$: $P = [X, Y, w]$, kde $X = x/w, Y = y/w$. $w$ je 1 pro bod a 0 pro vektor.

\begin{description}
	\item[Posunutí] bodu v rovině $P(x,y,w)$, vektor $(d_x, d_y)$. $x' = x + dx$, $y' = y + dy$
	
	$P' = P \cdot T = \begin{bmatrix} x' & y' & 1 \end{bmatrix} = \begin{bmatrix} x & y & 1 \end{bmatrix}
	\cdot \begin{bmatrix}
		1 & 0 & 0 \\
		0 & 1 & 0 \\
		d_x & d_y & 1
	\end{bmatrix}$
	\hfill
	$T^{-1} = \begin{bmatrix}
		1 & 0 & 0 \\
		0 & 1 & 0 \\
		-d_x & -d_y & 1
	\end{bmatrix}$
	
	\item[Otočení] bodu v rovině o úhel $\alpha$. Střed otáčení v počátku souřadného systému
	
	$P' = P \cdot R = \begin{bmatrix} x' & y' & 1 \end{bmatrix} = \begin{bmatrix} x & y & 1 \end{bmatrix}
	\cdot \begin{bmatrix}
		\cos{\alpha} & \sin{\alpha} & 0 \\
		-\sin{\alpha} & \cos{\alpha} & 0 \\
		0 & 0 & 1
	\end{bmatrix}$
	\hfill
	$R^{-1} = \begin{bmatrix}
		\cos{\alpha} & -\sin{\alpha} & 0 \\
		\sin{\alpha} & \cos{\alpha} & 0 \\
		0 & 0 & 1
	\end{bmatrix}$
	
	\item[Změna měřítka] Poměr zvětšení ve směru os $S_x$, $S_y$; $< 0$: zrcadlení, $< 1$ zmenšení, jinak zvětšení.
	
	$P' = P \cdot S = \begin{bmatrix} x' & y' & 1 \end{bmatrix} = \begin{bmatrix} x & y & 1 \end{bmatrix}
	\cdot \begin{bmatrix}
		S_x & 0 & 0 \\
		0 & S_y & 0 \\
		0 & 0 & 1
	\end{bmatrix}$
	\hfill
	$S^{-1} = \begin{bmatrix}
		1/S_x & 0 & 0 \\
		0 & 1/S_y & 0 \\
		0 & 0 & 1
	\end{bmatrix}$
	
	\item[Zkosení ve 2D] faktory zkosení podle os $S_x$, $S_y$.
	
	$P' = P \cdot S_H = \begin{bmatrix} x' & y' & 1 \end{bmatrix} = \begin{bmatrix} x & y & 1 \end{bmatrix}
	\cdot \begin{bmatrix}
		1 & S_y & 0 \\
		S_x & 1 & 0 \\
		0 & 0 & 1
	\end{bmatrix}$
	\hfill
	$S_H^{-1} = \begin{bmatrix}
		1 & -S_y & 0 \\
		-S_x & 1 & 0 \\
		0 & 0 & 1
	\end{bmatrix}$
\end{description}

Transformace lze skládat, záleží na pořadí (další transformace přidáváme v pravo). Nejdříve vyjádříme matice, vynásobíme a poté je dáme grafické kartě k aplikaci na objekty: $M = S \cdot R \cdot T$

\section{Transformace ve 3D} Body popsány 3D souřadnicemi $P(x,y,z,w)$ podobně jako ve 2D.

\begin{description}
	\item[Posunutí] stejné jako 2D, jen o jednu souřadnici více (čtvrtý řádek)
	\item[Změna měřítka] stejné jako ve 2D, jen o jednu souřadnici více (na hlavní uhlopříčce).
	\item[Rotace] Podle dané osy (x, y, z)
	
	Podle osy Y: $\begin{bmatrix}
		\cos{\alpha} & 0 & \sin{\alpha} & 0 \\
		0 & 1 & 0 & 0 \\
		-\sin{\alpha} & 0 & \cos{\alpha} & 0 \\
		0 & 0 & 0 & 1
	\end{bmatrix}$
	
	\item[Zkosení] podle dvou os
	
	Podle os XY: $\begin{bmatrix}
		1 & 0 & 0 & 0 \\
		0 & 1 & 0 & 0 \\
		S_{HX} & S_{HY} & 1 & 0 \\
		0 & 0 & 0 & 1
	\end{bmatrix}$
\end{description}

\subsection{Rotace podle obecné osy skládáním}
\begin{enumerate}
	\item Posunutí osy do počátku souřadného systému
	\item Otočení osy do jedné souřadné roviny (XY)
	\item Otočení osy do jedné souřadné osy (X)
	\item Rotace podle osy X ($\omega$)
	\item Vrácení osy do původní pozice
\end{enumerate}

Maticově: $M = T \cdot R_X \cdot R_Z \cdot R_{X(\omega)} \cdot R_Z^{-1} \cdot R_X^{-1} \cdot T^{-1}$

Mnohem efektivnější pomocí kvaternionů!

\section{Projekce}

Zobrazení 3D objektů na 2D průmětnu (ztráta informace).

\subsection{Podle tvaru průmětny}
\begin{description}
	\item[Rovna průmětna] úsečka se promítají na úsečky -- stačí promítat vrcholy úseček
	\item[Zakřivená průmětna] Úsečky se promítají na křivky -- projekce všech rastrových bodů (Rybí oko, panorama)
\end{description}

\subsection{Podle typu projekce}
\begin{description}
	\item[Paralelní (rovnoběžná)] lineární, prostřednictvím rovnoběžných paprsků, většinou technické aplikace. Zachovává rovnoběžnost hran. Vzdálenost od průmětny neovlivňuje velikost obrazu. Nejčastěji kolmé promítání.
	
	$P_{XY} = \begin{bmatrix}
		1 & 0 & 0 & 0 \\
		0 & 1 & 0 & 0 \\
		0 & 0 & 0 & 0 \\
		0 & 0 & 0 & 1
	\end{bmatrix}$ (zanedbání souřadnice Z -- průmět do roviny Z
	
	\item[Obecná kolmá projekce] \hfill
	\begin{enumerate}
		\item Přenést objekty do souřadného systému, kde je průmětna souběžná s rovinou XY (složená lineární transformace)
		\item Provést promítání do roviny XY
	\end{enumerate}
	\item[Perspektivní (středová)] Paprsky vycházejí z jednoho bodu (místo pozorovatele), nezachovává rovnoběžnost hran. Odpovídá realitě, používá se v architektuře, virtuální realita, hry. Vzdálenost od středu ovlivňuje velikost průmětu.
	
	(počet os, které průmětna protíná) 
	\begin{description}
		\item[Jednobodová perspektiva]$T_{per} = \begin{bmatrix}
		1 & 0 & 0 & 0 \\
		0 & 1 & 0 & 0 \\
		0 & 0 & 1 & 1/d_z \\
		0 & 0 & 0 & 1 \\
		\end{bmatrix}$, kde $d_z$ je vzdálenost objektu od průmětny po ose Z
		
		\item[Tříbodová perspektiva] $T_{per} = \begin{bmatrix}
		1 & 0 & 0 & 1/d_x \\
		0 & 1 & 0 & 1/d_y \\
		0 & 0 & 1 & 1/d_z \\
		0 & 0 & 0 & 1 \\
		\end{bmatrix}$
	\end{description}
\end{description}

Ořezávání: přední/zadní ořezávací stěna. Hranol/komolý jehlan -- oříznutí mimo tento útvar (okno). Urychlení procesu zobrazení, možnost převedení na jednotkovou krychli/jehlan.

\section{Kvaterniony}

Efektivní způsob realizace rotace ve 3D.

Kvaternion: rozšíření komplexních čísel: $q = q_1 + i q_2 + j q_3 + k q_4$ (jedna reálná část, 3 komplexní).

Vektor je vtah mezi dvěma body $\Rightarrow$ Kvaternion je vztah mezi dvěma vektory ve 3D.

$q = w + i x + j y + k z$\qquad $|q| = \sqrt{w^2 + x^2 + y^2 + z^2}$

sdružený kvaternion: $q^* = w - i x - j y - k z$ \qquad $q q^* = 1$

Rotaci lze popsat úhlem otočení $\alpha$ a jednotkovým vektorem $a = (a_1, a_2, a_3)$, který reprezentuje osu otáčení. $q = cos(\alpha/2) + a_1 \sin(\alpha/2) i + a_2 \sin(\alpha/2) j + a_3 \sin(\alpha/2) k$

Otočení: $ v' = q v q^*$, kde $v$ je vektor s $\mathbb{R}$ složkou 0: $v = v_0 i + v_1 j + v_2 k$

Skládání rotací odpovídá násobení kvaternionů.

Kvaternion lze převést na Rotační matici pro výpočet v HW, což je velmi důležité.

\section{Reprezentace 3D objektů}

\subsection{Požadavky na model}
\begin{itemize}
	\item Obecnost -- rozsah problémů, které pokrývá
	\item Úplnost
	\item Jednoznačnost -- lze vyhodnotit jen jedním způsobem
	\item Unikátnost -- jedno těleso = jeden model
	\item Přesnost
	\item Regulérnost -- nemožnost vytvořit nereálnou reprezentaci
	\item Konzistence vůči vybraným operacím
	\item Kompaktnost -- paměťové nároky
	\item Efektivita zpracování
\end{itemize}

\paragraph{Manifold} tělesa, která lze vyrobit. Hrana sdílí pouze dvě stěny, bod má v množině stěn otevřené okolí.

\paragraph{Eulerovy rovnice} kontrola topologie objektu podle počtu hran, stěn, vrcholů a dalších informací (vrcholů - hran + stěn = 2).

\subsection{Modely}
\begin{description}
	\item[Konstrukční] skládání jednotlivých 3D primitiv
	\begin{description}
		\item[CSG] Konstrukční geometrie. Objekt je popsán stromem primitiv (součet, rozdíl, průnik). Zobrazení může být urychleno použitím octree (oktalový strom).
	\end{description}
	\item[Šablonování] translační, rotační, protahování. Pohyb křivky/plochy/tělesa po zvolené trajektorii.
	\item[Dekompoziční metody] Diskrétní popis, rozklad na objemové jednotky (Voxel)
	\begin{description}
		\item[Objemové (obsah)] CT (medicína, strojírenství), reprezentace pomocí 3D pole (velká datová náročnost), octree (vhodné pro malou hustotu dat)
	\end{description}
	\item[Hraniční reprezentace (povrch)] popis pouze povrchu.
	\begin{description}
		\item[B-rep] hranice modelu. Vrcholy, stěny, hrany a jejich vzájemné propojení
		\item[Okřídlená hrana]lineární seznamy vrcholů, hran a stěn. Každá hrana má odkaz na dva sousední vrcholy, 2 sousední stěny a 4 sousední hrany.
		\item[Drátový model] Může být nejednoznačný, používá se jako jednoduchý návrh
		\item[Polygonální model] HW podpora, ideální pro interaktivní zobrazení, nutnost dodržet regulérnost (uzavřenost).
		\item[Hraniční spline model]
		\item[LOD] Level of detail -- při pozorování z velké vzdálenosti nemá cenu počítat polygony, které se ani nezobrazí.
	\end{description}
	\item[3D plochy] rozšíření parametrických polynomiálních křivek, spojování segmentů až do $C^2$
	\begin{description}
		\item[Bikubické plochy] analogie Fergusonových kubik, 4x4 řídící body
		\item[Beziérovy plochy] aproximační. Mohou být racionální, nebo neracionální.
		\item[algoritmus de Casteljau] podobný princip jako vykreslování křivek, dvě proměnné
		\item[NURBS plochy] Invariantní k lineárním transformacím
	\end{description}
	\item[Implicitní plochy] Potenciální pole elementárních částí kostry (\uv{náboj} může být kladný nebo záporný), povrch v místě, kde je intenzita 0. Omezená směšovací funkce.
	
	Lze kombinovat například s CSG (stromy primitiv, bool. operace (uzly)).
	
\end{description}






































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{chapter}{15}
\chapter{Množiny, relace a zobrazení} \label{cha:16}

1. semestr, IDA

\section{Intuitivní pojem množiny}

Každé shrnutí určitých navzájem různých předmětů našeho nazírání do jediného celku. Může být vymezená:
\begin{itemize}
	\item Výčtem prvků: $\{0, 1, 2, 3, 4\}$.
	\item Predikátem (charakterizací): $\{x | x \in N, 0 \leq x \leq 4\}$.
\end{itemize}

Je li S množina, jejíž prvky jsou opět množiny, nazýváme ji zpravidla \emph{systémem množin}.

\subsection{Russellův paradox}

Pokud je množina $S = \{ X | X \notin X\}$ všech množin, které nejsou svým vlastním prvkem, potom obě tvrzení $ S \in S $ a $ S \notin S$ vedou ke sporu:
\begin{itemize}
	\item Pokud S není svým vlastním prvkem, měla by do S podle definice patřit;
	\item pokud však je S svým vlastním prvkem, pak by do S patřit neměla.
\end{itemize}

\subsection{Velikost a porovnávání množin}

Množiny A, B, C, $B \subseteq C $, vzájemně jednoznační přiřazení $f: A  \to B$, potom množiny A a B mají stejnou mohutnost, a množina C je alespoň tak mohutná, jako množina A. Zapisujeme $|A| = |B|$, $|A| \leq |C|$.

S jsou sudá čísla, N přirozená, $F(n) = 2n$ vzájemně jednoznačné přiřazení, pak $|S| = |N|$, stejně jako pro lichá čísla. Všechny tyto množiny jsou stejně mohutné.

\subsection{Spočetná množina}
Množina stejné mohutnosti, jakou má množina přirozených čísel se nazývá spočetná (existuje bijekce $F: N \to A$). Množina která není spočetná je \emph{nespočetná}.

\subsection{Operace s množinami}

\begin{description}
	\item[rovnost množin] $A = B \iff \forall x (x \in A \iff x \in B)$
	\item[podmnožina] $ A \subset B \iff \forall x (x \in A \Rightarrow x \in B)$
	\item[sjednocení] $ \forall x (x \in A \cup B \iff x \in A \lor x \in B)$
	\item[průnik] $ \forall x ( x \in A \cap B \iff x \in A \land x \in B)$
	\item[rozdíl] $ \forall x ( x \in A \setminus B \iff x \in A \land x \notin B)$
	\item[symetrická diference (XOR)] $X \div Y$ 
\end{description}

Komutativní, asociativní, distributivní a DeMorganovy zákony platí na množinových operacích.

\section{Binární relace}

X, Y jsou množiny, kartézský součin $X \times Y = \{(x,y) | x \in X, y \in Y\}$. Binární relace je libovolná podmnožina $R \subseteq X \times Y$ \emph{kartézského součinu}. Pokud $Y = X$, jedná se o binární relaci na množině X.

$\Delta{}X = {(x,x) | x \in X}$ je diagonální relace na X

$R \subseteq X \times Y$:
\begin{description}
	\item[Dom R] definiční obor $Dom R = \{x | \exists y  \in Y, (x,y) \in R\}$
	\item[Im R] Obor hodnot (Image) $Im R = \{y | \exists x  \in Y, (x,y) \in R\}$
\end{description}

\subsection{Zobrazení}
$f \subseteq X \times Y$ -- pokud každému x z Dom $f \subseteq X$ existuje právě jeden prvek $y \in Y$, že $(x,y) \in f$, říkáme, že f je \emph{zobrazení X do Y}, $f: X \to Y$.

\begin{description}
	\item[Prosté = injektivní] Každý obraz má nejvýše jeden vzor, $\forall x_1, x_2$ platí $x_1 \neq x_2 \Rightarrow f(x_1) \neq f(x_2)$ 
	\item[Na = surjektivní] Každý prvek z Y má nějaký vzor v X $\forall y \in Y \exists x \in X: y = F(x)$
	\item[Vzájemně jednoznačné = bijektivní] 1:1. Současně surjektivní a injektivní.
\end{description}

$id_X: X \to X: id_X(x) = x$ -- identita na X = diagonální relace

\subsection{Inverzní relace k R}

$R^{-1} = \{ (y,x) | \exists (x,y) \in R\}$

Jsou-li navíc $R$ a $R^{-1}$ zobrazení, $R^{-1}$ se nazývá \emph{inverzní zobrazení}.

\section{Relace na množině}

$R \subset A \times A$, $(x,y) \in R$, $xRy$, $R(x,y)$.

\begin{description}
	\item[reflexivní] $(x,x) \in R$ pro každé $x \in X$
	\item[symetrická] $(x,y) \in R \Rightarrow (y,x) \in R$
	\item[antisymetrická] $\{(x,y) \in R \land (y,x) \in R\} \Rightarrow x = y$
	\item[tranzitivní] $\{(x,y) \in R \land (y,z) \in R\} \Rightarrow (x,z) \in R$
\end{description}

\begin{description}
	\item[Ekvivalence] reflexivní, symetrická a tranzitivní relace
	\item[(Částečné) uspořádání] reflexivní, antisymetrická a tranzitivní
	\item[Kvaziuspořádání] reflexivní a tranzitivní
\end{description}

\subsection{Třídy rozkladu}

Systém $A$ neprázdných podmnožin množiny $M$ se nazývá rozklad množiny $M$, jestliže platí $\bigcup_i M_i = M$ pro $M_i$, $M_j \in A$, $i \neq j$ je $A_i \cap A_j = \emptyset$

Množiny systému $A$ se nazývají třídy rozkladu.

\subsection{Uspořádání}

X je množina, $R \subseteq X \times X$ relace uspořádání na X, (X, R) uspořádaná množina

\paragraph{Lineární uspořádání}

$\forall x,y \in Y$ platí $x \leq y$ nebo $y \leq x$

Na množině $R$ čísel uspořádány hustě -- mezi každými dvěma čísly je další.

$A = \{1,2,3\}, X = 2^A = \{\emptyset, \{1\}, \{2\}, \{3\}, \{1, 2\}, \{1, 3\}, \{2, 3\}, \{1, 2, 3\} \}$. Množina $(X, \subseteq)$ uspořádána, ale ne lineárně.

\paragraph{Pokrytí prvků množiny}
$(X, \leq), a,b \in X$. b pokývá a, pokud $a < b$ a neexistuje $x \in X$ takové, aby platilo $a < x < b$. Z toho vyplývá Hasseův diagram -- prvky množiny jsou spojeny čárami s prvky, které pokrývají.

\paragraph{horní, dolní závora}
$(X, \leq)$ je uspořádaná množina, $A \subseteq X$ je podmnožina, $a \in X$ je \emph{horní (resp. dolní) závorou množiny $A$}, jestliže pro všechna $x \in A$ je $x \leq a$ (resp. $x \geq a$).

\paragraph{suprémum, infimum množiny}
Existuje-li mezi všemi horními závorami nejmenší, říkáme mu \emph{suprémum} množiny A (sup A), existuje-li mezi všemi dolními závorami největší, říkáme mu \emph{infimum} množiny A (inf A). Nemusí být v A!

\paragraph{maximální, minimální prvek}
$(X, \leq)$ je uspořádaná množina, prvek $m \in X$ je \emph{maximální (minimální)}, jestliže v $X$ neexistuje prvek větší (menší) než on.

V $R$ má každá shora omezená množina suprémum a každá zdola omezená množina infimum.

\paragraph{Duální uspořádání}
$R \subseteq X \times X$ uspořádání na X, $R^{-1}$ je uspořádání na X, které je \emph{duální} k $\leq$ a označujeme jej $\geq$.

\paragraph{Svaz}
$(X, \leq)$ je uspořádaná množina -- \emph{svazově uspořádaná} (svaz), pokud každé dva prvky množiny X mají v X suprémum i infímum.








































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Diferenciální a integrální počet funkcí více proměnných} \label{cha:17}

2. semestr, IMA, skripta

\section{Diferenciální počet}
minimalizace hodnoty funkce (hledání extrémů na intervalu) -- položení první derivace rovno 0.
Elektrické obvody $Ri + L\frac{di}{dt} = U \Rightarrow i(t) = \frac{U}{R}\left(1-e^{-(R/L)t} \right)$

\subsection{Limita}
Funkční hodnotu v bodě $a$ se blíží číslo $b$. Funkce $f$ má v bodě $a$ limitu $b$, když
\begin{itemize}
	\item $a$ je hromadným bodem množiny $D_f$ (bod, v jehož libovolně redukovaném okolí leží alespoň jedem bod dané množiny).
	\item k libovolnému okolí $U(b)$ limity $b$ existuje okolí $U(a)$ bodu $a$ tak, že funkce $f$ zobrazí redukované okolí $U^*(a)$ do $U^*(b)$, tedy
	
	$\forall U(b) \exists U(a): f(U^*(a) \subset U(b)$
\end{itemize}

Je-li $b \neq \pm \infty$, pak se jedná o vlastní limitu. Jinak je to limita nevlastní.

$\lim\limits_{x \to a} c = c \qquad
\lim\limits_{x \to a} x = a \qquad
\lim\limits_{x \to \pm \infty} \frac{1}{x} = 0 \qquad
\lim\limits_{x \to \infty} a^x = \infty \qquad
\lim\limits_{x \to - \infty} a^x = - \infty \qquad a > 1$

\paragraph{Relativní limita} (vzhledem k množině M) -- definovaná na intervalu/množině M.

\paragraph{Limita zleva/zprava} je relativní limita pro interval $(a,\infty)$ / $(\infty, a)$.

Limita posloupnosti, Hromadná hodnota, Horní, dolní limita

\paragraph{Limita složené funkce} $a$ je hromadný bod $D_f$, $f = g \circ h$, $c = \lim\limits_{c \to a} g(x)$, $d = \lim\limits_{t \to c} h(t)$ na jistém okolí bodu a je pro $x \neq a$ také $g(x) \neq c$, pak $\lim\limits_{x \to a} g(x) = d$.

\subsection{Spojitost}
Funkce $f(x)$ je spojitá v bodě, platí-li $\lim\limits_{x \to a} f(x) = f(a)$. Podobně je definována spojitost zprava a zleva.

\paragraph{Nespojitosti}
\begin{itemize}
	\item Prvního druhu -- spojitá zprava a zleva, vlastní limity.
	\begin{itemize}
		\item Pokud okolí $f(a^+) = f(a^-)$ pak spojitost odstranitelná
		\item Jinak skoková
	\end{itemize}
	\item Druhého druhu
\end{itemize}

Spojitost na uzavřeném intervalu znamená, že je funkce spojitá v každém bodě tohoto intervalu.

\subsection{Derivace}
Směrnice tečny, Okamžitá rychlost.

\paragraph{V bodě} nechť pro funkcí definovanou na nějakém okolí $U(x_0)$ existuje vlastní limita $f'(x_0) = \lim\limits_{x \to x_0} \frac{f(x) - f(x_0)}{x - x_0}$, potom tuto limitu nazýváme derivací funkce $f$ v bodě.

Derivace zleva, zprava -- jednostranné limity.

\paragraph{Tečna ke grafu funkce v bodě $x_0$}: $y-f(x_0) = f'(x_0) (x-x_0)$

je-li $f(x_0) \neq 0$, přímka o rovnici $y - f(x_0) = - \frac{1}{f'(x_0)}$ je normála ke grafu funkce.

Polotečna -- v rovnici použita levá a pravá derivace.

\paragraph{Na intervalu}
funkce definována na intervalu $<a, b>$, v každém bodě mé derivaci. Potom má derivaci na intervalu.

$(c)' = 0 \qquad
(x^n)' = nx^{n-1} \qquad
(\sin{x})' = \cos{x} \qquad
(\cos{x})' = - \sin{x} \qquad
(e^x)' = e^x$

\paragraph{L'Hospitalovo pravidlo} Výpočet limit neurčitých výrazů (nelze vypočítat jako funkční hodnoty) $\lim\limits_{x \to a} \frac{f'(x)}{g'(x)} = \lim\limits_{x \to a} \frac{f(x)}{g(x)}$, pokud $\lim\limits_{x \to a} f(x) = \lim\limits_{x \to a} g(x) = 0 \text{nebo} \infty$

\subsection{Derivace vyšších řádů} druhá derivace -- zrychlení.

$f''(x) = \frac{d^2f}{fx^2}$

Rekurzivně: $f^{(n)} = \left( f^{(n-1)} \right)'$ Derivace n-tého řádu je derivace (n-1)-ní derivace.

Je-li funkce n.krát diferencovatelná v bodě $x_0$, pak $d' f(x_0) = f^{(n)} (x_0) dx^n$ je diferenciál n-tého řádu.

Linearizace: aproximace funkce v bodě přímkou: $y - f(x_0) = f'(x_0) (x-x_0)$

\paragraph{Aproximace Taylorovým rozvojem}

$f(x) = T_n(x) + R_{n+1}(x)$ Taylorův rozvoj a zbytek po n-tém členu Taylorova rozvoje (vystupuje číslo mezi $x$ a $x_0$).

$T_n(x) = \sum\limits_{k=0}^n \frac{f^{k}(x_0)}{k!} (x-x_0)^k = f(x_0) + \frac{f'(x_0)}{1!} (x-x_0) + \dots + \frac{f^{n}(x_0)}{n!} (x-x_0)^n$

\subsection{Extrémy, průběh funkce}

$f'(x) \geq 0$, potom $f(x)$ je neklesající, $f'(x) \leq 0$, potom je $f(x)$ nerostoucí.

Lokální extrém vzniká, když $f'(x) = 0$ (stacionární bod), nebo když je funkce není v bodě definovaná. 

Lokální maximum je, pokud $f''(x) < 0$ ve stacionárním bodě, 
lokální maximum je, pokud $f''(x) > 0$.

\paragraph{Absolutní extrémy} získáme porovnáním lokálních extrémů a okrajových bodů intervalu.

\paragraph{Inflexní box} $f''(x) = 0$ nebo neexistuje -- změna konvexnosti (pod přímkou) / konkávnosti (nad přímkou).

\paragraph{Asymptoty}
\begin{itemize}
	\item bez směrnice (rovnoběžné s Y) -- limita v bodě zprava nebo zleva je rovna $\pm \infty$
	\item se směrnicí: $\lim\limits_{x \to \pm \infty} \left[ f(x) - (ax + b) \right] = 0$
\end{itemize}

\section{Integrální počet}

Neurčitý integrál -- zákon dráhy po přímce, je definována jeho okamžitá rychlost.

$F'(x) = f(x)$, kde $F$ je primitivní funkce k funkci $f$.

$\int f(x) dx = F(x) + C$, kde $C \in \mathbb{R}$ (f je integrand, integrovaná funkce, x je integrační proměnná)

\subsection{Integrační metody}
\begin{description}
	\item[Per partes] $\int u(x) v'(x) dx = u(x) v(x) - \int u'(x) v(x) dx$
	\item[Substituční metoda] $\int f(t) dt = \int f( g(x) ) g'(x) dx$, kde $t = g(x)$, $dt = g'(x)dx$
	\item[Racionální lomené funkce] $R(x) = \frac{P_m(x)}{Q_n(x)}$, $m < n$, Rozložení na parciální zlomky a jejich následná integrace.
\end{description}

$\int 0 dx = C \qquad
\int 1 dx = x \qquad
\int x^k dx = \frac{x^{k+1}}{k+1} \qquad
\int \frac{1}{x} dx = ln |x|$

$\int\left(a f \left(x \right) + b g \left(x \right) \right) dx = a \int f(x) dx + b \int g(x) dx$

\subsection{Určitý integrál} Obsah plochy pod grafem, odhad pomocí dělení intervalu.

\paragraph{Integrální součet} $s(D,f) = \sum\limits_{i=1}^n F(\xi_i) (x_i - x_{i-1}$ s funkcí f a dělením D.

$f: <a,b> \to \mathbb{R}$ je ohraničená funkce f, integrovatelná na intervalu , jestliže existuje číslo $I \in \mathbb{R}$, že ke každému $\varepsilon > 0$ existuje $\delta > 0$ tak, že pro každé dělené D intervalu $<a,b>$ jehož norma $\nu(D) < \delta$, platí $|s(D,f)| < \varepsilon$.
$I = \int_a^b f(x) dx$ (integrand, dolní mez, horní mez, integrační proměnná x. Určitý integrál je číslo!

Funkce je integrovatelná, pokud má na daním intervalu pouze konečně mnoho nespojitostí.

$\int_a^b dx = b - a \qquad \int_a^a f(x) = 0$

Odhad hodnoty: integrační střední hodnota $\mu = \frac{1}{b-a} \int_a^b f(x) dx$

Funkce horní meze, funkce dolní meze ...

\paragraph{Newton-Leibnizova věta} spojitá funkce $f(x)$ na intervalu $<a, b>$:

$F'(x) = f(x)$, $\int_a^b f(x) dx = F(b) - F(a) = \left[ F(x) \right]_a^b$

\paragraph{Per partes pro spojité integrály}

$\int_a^b u(x) v'(x) dx = [u(x) v(x) ]_a^b - \int_a^b u'(x) v(x) dx$

\paragraph{Substituce pro spojité integrály}

$\int_a^b f(g(x))g'(x) dx = \int_{g(a)}^{g(b)}f(t) dt$

\paragraph{Využití} Obsah rovinné oblasti, objem tělesa, objem rotačního tělesa $\pi \int_a^b f^2(x) dx$, Délka křivky, která je grafem: $L = \int_a^b \sqrt{1+[f'(x)]^2} dx$


\subsection{Nevlastní integrál} zobecnění pro neohraničené intervaly (nekonečno):

$\int_a^\infty f(x) dx = \lim\limits_{\xi \to \infty} \int_a^\xi f(x) dx$

Je-li limita nevlastní, nebo neexistuje, integrál diverguje. Jinak konverguje. Nespojitost maximálně v konečném množství bodů.

\section{Funkce více proměnných}
n reálných proměnných $f: \mathbb{R}^n \to \mathbb{R}$, $f(x,y,z)$ pro $\mathbb{R}^3$.

\paragraph{Složená funkce} $f:A \to \mathbb{R}, A \subset \mathbb{R}^m$ a m funkcí n proměnných $\varphi_1, \varphi_2, \dots, \varphi_m$ na množině $m \subset \mathbb{R}^n$:

$f( \varphi_1(t_1, t_2, \dots, t_n),  \varphi_2(t_1, t_2, \dots, t_n), \dots \varphi_m(t_1, t_2, \dots, t_n) )$ je složená funkce (vnitřní a vnější složka).

\paragraph{Vrstevnice} průmět křivky vzniklé jako řez rovinou z=k do $D_f$. Rovnice $f(x,y) = k$.

\subsection{Limita a spojitost}

definice formálně stejná jako pro funkci jedné proměnné.

Vzdálenost v Eukleidovském prostoru: $d(X,Y) = \sqrt{(x_1 - y_1)^2 + (x_2 - y_2)^2 + \dots + (x_n - y_n)^2}$

\paragraph{Otevřená množina} neobsahuje žádný bod své hranice
\paragraph{Uzavřená množina} obsahuje všechny body své hranice
\paragraph{Hromadný bod množiny} v každém bodě jeho redukovatelného okolí leží nějaký bod množiny

\subsection{Derivace podle více proměnných}

\paragraph{Parciální derivace} podle proměnné x: $f_x'(X_0)$ v okolí bodu $X_0$, pokud existuje limita $\lim\limits_{h \to 0} \left( \frac{f(x_0 +h, y_0) - f(x_0, y_0}{h} \right)$ v bodě $X_0$.

Podobně pro druhou až n-tou proměnnou.

\paragraph{Směrová derivace} Ne podle osy, ale podle libovolného jednotkového vektoru $u \in E_n$:

$\lim\limits_{h \to 0} \frac{f(X_0 + h u) - f(X_0)}{h} = f_u'(X_0)$

\paragraph{Gradient} $grad f(X_0) = (f_{x_1}'(X_0), \dots, f_{x_n}'(X_0) )$

Gradient funkce v bodě $X_0$ je směr (vektor), ve kterém roste funkce nejrychleji (ve 2D je kolmý na vrstevnici).

Diferenciál funkce f v bodě $X_0$: $df(X_0, h) = gradf(X_0) \cdot h = f_h'(X_0)$

\paragraph{Rovnice tečné roviny} v bodě $X_0 = (x_0, y_0, f(x_0,y_0))$:

$z-f(x_0, y_0) = df((x_0, y_0), (x,y)) = f_x'(x_0, y_0)(x-x_0) + f_y'(x_0, y_0)(y-y_0)$ 

Normála: $(f_x'(x_0, y_0), f_y(x_0, y_0), -1)$

\section{Derivace a diferenciály vyšších řádů}

$f_{x_i, x_j}''(X_0) = \frac{\partial^2f}{\partial x_i \partial x_j}$ smíšená parciální derivace druhého řádu

Druhá derivace funkce $f$: matice všech kombinací $x_i, X_j$.

Diferenciál k-tého řádu funkce f v bodě $X_0: d^k f(X_0)$

\paragraph{Taylorův polynom} $T_k(X_0)$

$f(X_0) + \frac{1}{1!}df(X_0, X - X_0) + \frac{1}{2!}d^2f(X_0, X - X_0) + \dots + \frac{1}{k!}d^kf(X_0, X - X_0)$

\paragraph{Extrémy funkce} Ve stacionárních bodech -- $f'(X_0) = grad  f(X_0)$. Maximum nebo minimum rozhodne znaménko druhé derivace $d^2f(X_0,h) > 0$ minimum, $< 0$ maximum. Pokud nějaký nulový, extrém nemusí nastat (sedlový bod?).

\paragraph{Subdeterminanty} $D_k$ obsahují prvních k řádků a sloupců matice $f''$

\paragraph{Sylvestrovo kriterium}
\begin{itemize}
	\item Subdeterminanty kladné: lokální minimum
	\item Subdeterminanty $D_1, D_3, \dots $ záporné, $D_2, D_4, \dots $ kladné: lokální maximum
	\item Subdeterminant se sudým indexem záporný, extrém nenastane
	\item Subdeterminant s lichým indexem kladný a jiný záporný, extrém nenastane
\end{itemize}

Jestli je nějaký rovný nule, nelze rozhodnout.

\paragraph{Absolutní extrémy} opět v lokálních, nebo v hraničních bodech.

\section{Dvojný a trojný integrál}

Integrální součet: $\sum\limits_{i = 1}^n f(\xi_i) m_1(I_i)$, kde $I_1, I_2, \dots I_n$ jsou intervaly, jejichž sjednocením je interval $<a,b>$, $m_1(I_i) = x_i - x_{i-1}$ je délka intervalu $I_i$, $\xi_i \in I_i$, $\forall i,j, i \neq j \Rightarrow m_1(I_i \cap I_j) = 0$.

Pro dvojný integrál $m_2(I_i)$ je plošný obsah intervalu $I_i$ (dvojrozměrný interval)

$\mathcal{J} = \int_I f(x,y) dx dy$ dvojný integrál funkce f. Určuje objem tělesa pod plochou dvojného integrálu:

\paragraph{Fubininova věta} pro interval: $V = \int_a^b F(X) dx = \int_a^b \left[ \int_c^d f(x,y) dy \right] dx = \int_c^d \left[ \int_a^b f(x,y) dx \right] dy$

Postupná integrace podle jednotlivých proměnných a intervalů.

Transformace integrálů a převod z kartézských souřadnic do polárních, cylindrických.
































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Číselné soustavy a převody mezi nimi} \label{cha:18}

1. semestr, IAS, 1. přednáška
2. semestr, INC, ???

\paragraph{$z$} Základ číselné soustavy -- přirozené číslo $ > 1$. Báze, Radix

\paragraph{$a_i$} Číslice dané soustavy $ 0 \le a_i < z$

$$a_{n-1}z^{n-1} + a_{n-2} z^{n-2} + \dots + a_0 z^0 + a_{-1} z^{-1} + a_{-2} z^{-2} + \dots =$$

$$ = (a_{n-1} a_{n-2}  \dots a_0 a_{-1} a_{-2} \dots)_z$$

\section{Používané číselné soustavy}

\begin{description}
	\item[binární]
	\item[oktalová]
	\item[desítková]
	\item[hexadecimální]
\end{description}

\subsection{Možné zápisy}
\begin{description}
	\item[Poziční] $(3,14)_{10}$
	\item[Polynomiální] $N =  \sum_{i=-l}^{k-1} n_i z^i$
\end{description}

\section{Převody mezi soustavami}

\subsection{Substituční metoda}

\begin{enumerate}
	\item Číslo zapiš polynomem  v soustavě A
	\item Výpočet proveď v soustavě B
\end{enumerate}


Velmi jednoduché pro převod do desítkové soustavy. Pro člověka nepřirozené do jiných soustav.

\subsection{Metoda dělení základem (pro celá čísla)}

Jednoduché pro převod z desítkové soustavy do soustavy o základu z.

\lstset{caption={Metoda dělení základem},language=C}
\begin{lstlisting}
	while( cislo != 0 ){
		a[i] = cislo mod z;
		cislo = cislo div z;
		i++;
	}
	n = i; //pocet platnych mist
\end{lstlisting}

\subsection{Metoda násobení základem (pro necelá čísla)}

Jednoduché pro převod z desítkové soustavy do soustavy o základu z.

\lstset{caption={Metoda násobení základem},language=C}
\begin{lstlisting}
	while( cislo != 0 || i < limit){
		pom = cislo * z;
		a[i] = celacast(cislo);
		cislo = pom - a[i];
		i++;
	}
	m = i; //pocet platnych mist
\end{lstlisting}

Převod končí, když je výsledek násobení roven 0 nebo když je dosaženo požadované přesnosti.

\subsection{Kombinace}

Pro člověka ideální kombinace těchto dvou: Převést číslo ze soustavy a do desítkové pomocí metody substituční a z desítkové do soustavy B pomocí metody dělení/násobení základem.

Speciálně lze převádět mezi soustavami, které jsou mocninami (2 => 4 => 8 => 16 a zpět), protože můžeme převádět samostatné číslice.























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{chapter}{18}
\chapter{Boolovy algebry} \label{cha:19}

2. semestr, INC, 2. přednáška

\section{Historie}
\begin{description}
	\item[George Boole, 1854] Matematický aparát
	\item[E. V. Huntington, 1905] Boolova algebra
	\item[C. E. Shanon, 1938] Popis chování logických obvodů (Switching algebra)
\end{description}

Algebra: definuje množinu prvků, množinu operátorů, axiomy (postuláty) a theorémy (věty).

\section{Boolovy algebry}

\begin{description}
	\item[Obecná Booleova algebra] Šestice $(B, +, ., ', 0, 1)$ (Huntington)\\
		Axiomy:\\
		\begin{tabular}{l l l}
			Uzavřenost: 			&$a+b \in B$		&$a.b \in B$	\\
			Neutralita 0 a 1: 		&$a+0 = a$			&$a.1 = a$		\\
			Komutativita: 			&$a+b = b+a$		&$a.b = b.a$	\\
			Distibutivita:	 		&$a+b.c = a+b.a+c$	&$a.(b+c) = (a.b)+(a.c)$\\
			Existence komplementu: 	&$a.a' = 0$			&$a+a' = 1$		\\
			\multicolumn{3}{l}{V množině B existují alespoň 2 různé prvky}
		\end{tabular}
		
		Teorémy (odvozeny na základě axiomů. Definují další užitečné vlastnosti):\\
		\begin{tabular}{l l l}
			Idempotence: 			&$a+a = a$			&$a.a = a$		\\
			Agresivita 0 a 1: 		&$a.0 = 0$			&$a+1 = 1$		\\
			Absorpce: 				&$a+a.b = a$		&$a.(a+b) = a$	\\
			\multicolumn{3}{l}{Existence jediného komplementu}			\\
			DeMorganovy zákony		&$(a+b)' = a'.b'$	&$(a.b)' = a'+b'$\\
			Asociativita			&$(a+b)+c = a+(b+c)$&$(a.b).c = a.(b.c)$\\
		\end{tabular}
		
		Princip duality\\
			Pokud platí nějaké tvrzení, tak platí i duální tvrzení, které vznikne vzájemnou záměnou operací + a . a prvků 0 a 1.

			Důsledek: Umožňuje realizovat jakýkoliv logický obvod s použitím pouze jediné operace a komplementů jednotlivých proměnných.
	\item[Dvouhodnotová Booleova algebra] Proměnné moho nabývat pouze hodnot 0 a 1. Realizace pomocí relé, dnes tranzistory (C. E. Shannon, 1938)\\
		Logické proměnné\\
		Logické funkce\\
		Logický výraz\\
		Logické operace: AND, OR, NOT, NOR, NAND, XOR, XNOR, Implikace, Inhibice (negace implikace), Kontradikce (0), Tautologie (1)
	\item[Switching albegra] Proměnné reprezentují spínače, X=0 značí sepnutý spínač, OR je sériové zapojení, AND je paralelní
	\item[Shefferova algebra] Realizace všech logických funkcí pomocí logické funkce NAND. Platí komutativita, neplatí asociativita
		\begin{itemize}
			\item $(a.a)' = a'$
			\item $(a.0)' = 1$
			\item $(a.1)' = a'$
			\item $(a.b)'.1 = ((a.b)')' = a . b$
			\item $((a.a)'.(b.b)')' = (a'.b')' = a + b$
		\end{itemize}
	\item[Piercova algebra] Realizace všech logických funkcí pomocí logické funkce NOR. Platí komutativita, neplatí asociativita
		\begin{itemize}
			\item $(a+a)' = a'$
			\item $(a+0)' = a'$
			\item $(a+1)' = 0$
			\item $(a+b)'+0 = ((a+b)')' = a + b$
			\item $((a+a)'+(b+b)')' = (a'+b')' = a . b$
		\end{itemize}
\end{description}


Vizualizace: Vennovy diagramy
\begin{description}
	\item[Logický součet] Sjednocení
	\item[Logický součin] Průnik
\end{description}

Zjednodušování logikcých výrazů za účelem minimalizace ceny, příkonu, maximalizace rychlosti za pomocí Booleovy algebry. Viz otázka č. \ref{cha:8}.
\begin{itemize}
	\item algebraické metody
	\item Karnaughova mapa
	\item Quine McCluskey
\end{itemize}






















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Regulární jazyky a jejich modely} \label{cha:20}

3. semestr, IFJ, opora, 3. a 4. přednáška (omáčka 1. a druhá přednáška)

(konečné automaty, regulární výrazy)

\begin{description}
	\item[Abeceda] Libovolná neprázdná konečná množina. Prvky abecedy nazýváme symboly, například $\{0, 1\}$ -- binární abeceda.
	\item[Slovo] Buď V abeceda, Slovo nad V je konečná posloupnost symbolů z V. Prázdnou posloupností je prázdné slovo - $\varepsilon$.
	\item[Délka slova] $a_1 a_2 \dots a_n$, $|a| = n$, $|\varepsilon| = 0$.
	\item[Zřetězení slov] a,b slova, $ab$ zřetězení.
	\item[Mocnina slova] $a^i = \varepsilon$ pro i = 0; $a^i = a a^{i-1}$ pro $i \geq 1$. $|a^i| = i |a|$.
	\item[Prefix slova] V je abeceda, x,y jsou slova, x je prefix (sufix) slova y, jestliže existuje slovo z na V tak, že platí $xz = y$ ($zx = y$). Pokud $x \neq y \neq \varepsilon$ potom se jedná o vlastní prefix (sufix).
	\item[Reverze slova] $x^R = x$ pro $x = \varepsilon$; $x^R = y^Ra$ pro $x = ay$.
\end{description}

\subsection{Jazyk}

V je abeceda, $L \subseteq V^*$, pak L je jazyk nad abecedou V. $\{\varepsilon\}, \emptyset$ jsou jazyky nad každou abecedou.

\paragraph{Konečný jazyk}
Jazyk je \emph{konečný}, obsahuje-li konečný počet slov. Jinak je nekonečný.

S jazyky (množiny slov) lze provádět množinové operace.

\paragraph{Iterace jazyka}
Iterace jazyka $L^* = \bigcup^\infty_{i=0} L_i$

\section{Chomského klasifikace gramatik}

Generativní gramatika $G = (N,T,P,S)$.
\begin{itemize}
	\item $N$ abeceda neterminálů
	\item $T$ abeceda terminálů
	\item $P \subseteq (N \cup T)^* N (N \cup T)^* \times (N \cup T)^*$ konečná množina pravidel. Zapisujeme $ x \to y $
	\item $S \in N$ Počáteční symbol gramatiky
\end{itemize}

\subsection{Derivace}
Slova v, w. Říkáme, že v přímo derivuje w (v gramatice G), což zapisjujeme  $v \Rightarrow w$, jestliže existují slova $z_1, z_2, x, y \in (N \cup T)^*$ taková, že pro $v = z_1 x z_2$ a $w = z_1 y z_2$ existuje $x \to y \in P$.	

Říkáme, že slovo v derivuje w, symbolicky $v \Rightarrow^* w$, právě tehdy když existuje posloupnost $v_1, v_2 \dots v_n$, kde $n \geq 1$ slov nad $(N \cup T)^*$ tak, že $v = v_1 \Rightarrow v_2 \Rightarrow \dots \Rightarrow v_n = w$.

Jazyk generovaný gramatikou G označujeme $L(G) = \{u: u \in T^*, s \Rightarrow^* u\}$.

Každé slovo, které lze odvodit z počátačního symbolu dané gramatiky nazýváme větná forma.

\subsection{Dělení gramatik}

\begin{itemize}
	\item Gramatiky typu 0 -- výše zmíněné
	\item Gramatiky typu 1 (Kontextová gramatika) -- pro každé pravidlo $v \to w$ platí $|v| \leq |w|$
	\item Gramatiky typu 2 (Bezkontextová gramatika) -- pro každé pravidlo z P: $v \to w \Rightarrow v \in N$
	\item Gramatiky typu 3 (Regulární gramatika) -- každé pravidlo tvaru $A \to xB$ nebo $A \to x$, kde $A,B \in N, x \in T^*$
\end{itemize}

Gramatiky typu $i$ generuje jazyk typu $i$.

Bezkontextový jazyk lze definovat vhodným zásobníkovým automatem, regulární jazyk lze definovat vhodným konečným automatem.

Automaty nebo gramatiky názýváme \emph{ekvivalentní}, když definují stejný jazyk.

\section{Konečné automaty}

Lexikální analýza.

\subsection{Nedeterministický konečný automat}
pětice $A = \{Q, T, \delta, s, F\}$
\begin{itemize}
	\item $Q$ abeceda stavů
	\item $T$ abeceda vstupnách symbolů
	\item $\delta$ přechodová funkce ve tvaru $Q \times (T \cup \varepsilon) \to 2^Q$
	\item $s$ počáteční stav $s \in Q$
	\item $F$ množina koncových stavů $F \subseteq Q$
\end{itemize}

\paragraph{Konfigurace automatu}
 $(q,x), q \in Q, x \in T^*$

Buď $(p,x)$ a $(q,y)$ dvě konfigurace automatu, říkáme, že automat přímo přejde z konfigurace $(p,x)$ do konfigurace $(q,y)$, symbolicky $(p,x) \vdash (q,y)$. Relaci $\vdash$ nazýváme takt, nebo přechod.

Jazyk akceptovaný automatem A je $L(A) = \{x: x \in T^*, (s,x) \vdash^* (r, \varepsilon), r \in F\}$.

Graficky lze reprezentovat pomocí stavového diagramu. Lze reprezentovat také tabulkou (řádky = stavy, sloupce = vstupní abeceda, průsečíky = přechod do stavu).

Dva modely pro popis formálních jazyků jsou ekvivalentní, pokud specifikují tentýž jazyk.

\paragraph{Odstranění $\varepsilon$ přechodů}
\emph{Konečný automat bez $\varepsilon$-přechodů} K, pro každé pravidlo $pa \to q$ platí, že $a \in T (a \neq \varepsilon)$.

\paragraph{Odstranění nedeterminismu}
Nechť M je konečný automat bez $\varepsilon$ přechodů. M je \emph{deterministický konečný automat}, pokud pro každé $pa \to q \in \delta$ platí, že množina $\delta - \{pa \to q\}$ neobsahuje žádné pravidlo s levou stranou $pa$.

\paragraph{$\varepsilon$-uzávěr}
Pro každý stav $p \in Q$ je definován $\epsilon$-uzávěr$(p) = \{ q: q \in Q, p \vdash^* q\}$.

\paragraph{Dostupné stavy}
Stav $q \in Q$ je dostupný, pokud existuje $w \in T^*$, pro který platí $sw \vdash^* q$. Jinak je q nedostupný.

\paragraph{Ukončující stavy}
Stav $q \in Q$ je ukončující, pokud existuje řetězec $w \in T^*$, pro který platí $qw \vdash^* f$, $f \in F$. Jinak je stav q neukončující. 


\subsection{Deterministický konečný automat}

pro libovolné $a \in T$, $q \in Q$ existuje nejvýše jeden stav $p \in Q$ tak, že $p \in \delta(q,a)$. Libovolný KO lze převést na deterministický. Jednodušší realizace.

Třída jazyků akceptovaná konečnými automaty je uzavřena vůci sjednocení, zřetězení a iteraci.

\subsection{Úplný DKA}

$M = (Q, \Sigma, R, s, F)$ je DKA. M je úplný, pokud pro libovolné $p \in Q, a \in \Sigma$ existuje právě jedno pravidlo $pa \to q \in R$ pro nějaké $q \in R$. Jinak je M neúplný.

Nemůže se zaseknout. Spočívá v přidání tzv. trap stavu, který je neukončující a kam řetězec \uv{spadne}, pokud nevyhovuje řetězci jazyka.

\subsection{Dobře specifikovaný KO}

KO, který nemá nedostupné stavy a který má max. jeden neukončující stav (trap z minulého bodu).

Pro každý KO existuje ekvivalentní dobře specifikovaný KO.

\paragraph{Rozlišitelné stavy}
Dva stavy jsou rozlišitelné, pokud existuje řetězec $w \in T^*$ takový, že $pw \vdash^* p'$ a $qw \vdash^* q'$, kde $p', q' \in Q$ a $((p' \in F \land q \notin F) \lor (p' \notin F \land q \in F))$. Jinak jsou stavy nerozlišitelné.

\paragraph{Minimální konečný automat}
Nechť M je DSKA. Potom je minimální KO, pokud obsahuje pouze rozlišitelné stavy.



\section{Regulární výrazy}

\subsection{Regulární množiny}
V je abeceda. Regulární množina nad V jedefinována rekurzivně:
\begin{enumerate}
	\item $\emptyset$ je regulární množina nad V
	\item $\{ \varepsilon \}$ je regulární množina nad V
	\item jestliže $a \in V$, pak $\{a\}$ je regulární množina nad V
	\item jestliže $L_1$ a $L_2$ jsou regulární množiny nad V, pak
	\begin{itemize}
		\item $L_1 \cup L_2$
		\item $L_1 L_2$
		\item $L_1^*$
	\end{itemize}
	jsou regulární množiny nad V
	\item Žádná další regulární množina než vytvořené podle předchozích pravidel neexistuje
\end{enumerate}

\subsection{Regulární výrazy}
V je abeceda, Regulární výraz nad V je definován rekurzivně:
\begin{enumerate}
	\item $\emptyset$ je regulární výraz označující regulární množinu $\emptyset$, prázdnou množinu (prázdný jazyk)
	\item $\varepsilon$ je regulární výraz označující množinu $\varepsilon$, jazyk $\{ \varepsilon \}$
	\item jestliže $a \in V$, pak $a$ je regulární výraz označující regulární množinu $\{a\}$, jazyk $\{ a \}$
	\item jestliže $R_1$ a $R_2$ jsou výrazy označující regulární množiny $L_1$ a $L_2$, jazyky $L_1$ a $L_2$, pak
	\begin{itemize}
		\item $(R_1 + R_2)$ je regulární výraz označující regulární množinu na $L_1 \cup L_2$ \\
		$(R_1 + R_2)$ je RV značící jazyk $L_1 \cup L_2$
		\item $(R_1 R_2)$ je regulární výraz označující regulární množinu  $L_1 L_2$ \\
		$(R_1 . R_2)$ je RV značící jazyk $L_1 L_2$
		\item $R_1^*$ je regulární výraz označující regulární množinu $L_1^*$ \\
		$(R_1^*)$ je RV značící jazyk $L_1^*$
	\end{itemize}
	\item Žádné další regulární výrazy, než vytvořené podle předchozích pravidel nad abecedou V neexistují
\end{enumerate}

RV zjednodušíme zavedením priorit ($* > . > +$), ve výrazu $r.s$ lze vynechat znak konkatenace, $rr^*$ a $r^*r$ lze zapsat jako $r^+$

Pro každou regulární množinu lze nalézt odpovídající regulární výraz a naopak.

Jazyk je akceptovaný konečným automatem, právě když jej lze reprezentovat regulárním výrazem.

\paragraph{Regulární jazyk}
Nechť L je jazyk, L je regulární jazyk, pokud existuje regulární výraz r, který tento jazyk značí.

\subsection{Regulární gramatiky}
Pro každou regulární gramatiku G existuje nedeterministický automat A tak, že $L(G) = L(A)$ a naopak. Libovolný nedeterministický konečný automat lze převést na ekvivalentní deterministický.




























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Bezkontextové jazyky a jejich modely} \label{cha:21}

3. semestr, IFJ, opora, 6. přednáška

(zásobníkové automaty, bezkontextové gramatiky)


\section{Bezkontextová gramatika}

BKG je čtveřice $G = \{N, T, P, S\}$, kde
\begin{itemize}
	\item $N$ je abeceda neterminálů
	\item $T$ je abeceda terminálů
	\item $P$ je konečná množina pravidel tvaru $A \to x$, kde $A \in N$, $x \in (N \cup T)^*$
	\item $S$ je počáteční symbol gramatiky
\end{itemize}

\subsection{Derivační strom}

Orientovaný graf (strom), který je názorným prostředkem pro zobrazení struktury derivace v bezkontextové gramatice. Kořen je ohodnocen symbolem S, uzel s alespoň jedním následovníkem je ohodnocen symbolem z N, listy jsou označeny symbolem z T.


\subsection{Derivační krok}
Nechť G je BKG, $u,v \in (N \cup T)^*$ a $p = A \to x \in P$. Potom uAv přímo derivuje uxv za použití p v G, zapsáno $uAv \Rightarrow uxv [p]$, nebo zjednodušeně $uAv \Rightarrow uxv$.

Sekvence derivačních kroků.

Nechť G je BKG. Jazyk generovaný G, $L(G) = \{ w: w \in T^*, S \Rightarrow^* w\}$. Bezkontextový jazyk.

\paragraph{Nejlevější derivace}
Nechť G je BKG, nechť $u \in T^*$, $v \in (N \cup T)^*$, $p = A \to x \in P$ je pravidlo. Pak $uAv$ přímo derivuje $uxv$ za pomocí nejlevější derivace užitím pravidla p v G, zapsáno jako: $uAv \Rightarrow_{lm} uxv [p]$.

\paragraph{Nejpravější derivace}
Nechť G je BKG, nechť $u \in (N \cup T)^*$, $v \in T^*$, $p = A \to x \in P$ je pravidlo. Pak $uAv$ přímo derivuje $uxv$ za pomocí nejpravější derivace užitím pravidla p v G, zapsáno jako: $uAv \Rightarrow_{rm} uxv [p]$.

V každém kroku nahrazujeme nejpravější/nejlevější neterminál.

\subsection{Gramatická nejednoznačnost}

Nechť G je BKG. Pokud existuje řetězec $x \in L(G)$ s více jak jedním derivačním stromem, potom G je nejednoznačná. Jinak je G jednoznačná.

Bezkontextový jazyk L je vnitřně nejednoznačný, pokud není generován žádnou jednoznačnou BKG.

\subsection{Transformace gramatik}

\begin{description}
	\item[Redukovaná BKG] odstraněny zbytečné neterminály.

	\item[Bez $\varepsilon$-pravidel] neobsahuje žádné pravidlo $X \to \varepsilon$, nebo obsahuje jediné pravidlo $S \to \varepsilon$.

	\item[Bez cyklů] není možná derivace $ A \Rightarrow^+ A $.

	\item[Vlastní] bez cyklů a $\varepsilon$-pravidel.

	\item[Chomského normální forma] každé pravidlo v P je v jednom z těchto tvarů: $A \to BC$, $A \to a$, $S \to \varepsilon$ (pro $\varepsilon \in L(G)$), kde $A,B,C \in N$, $a \in T$.
\end{description}

\section{Zásobníkové automaty}

Zásobníkový automat je sedmice $M = (Q, \Sigma, \Gamma, R, s, S, F)$, kde
\begin{itemize}
	\item $Q$ je konečná množina stavů
	\item $\Sigma$ je vstupní abeceda
	\item $\Gamma$ je zásobníková abeceda
	\item $R$ je konečná množina pravidel tvaru $Apa \to wq$ (zásobník, stav, vstup $\to$ zásobník, stav), kde $A \in \Gamma, p,q \in Q, a \in \Sigma \cup \{ \varepsilon \}, w \in \Gamma^*$
	\item $s \in Q$ počáteční symbol
	\item $S \in Gamma$ počáteční symbol na zásobníku
	\item $F \subseteq Q$ je množina koncových stavů
\end{itemize}

\subsection{Konfigurace zásobníkového automatu}

$M = (Q, \Sigma, \Gamma, R, s, S, F)$ je zásobníkový automat. Konfigurace ZA je řetězec $\chi = \Gamma^* Q \Sigma^*$.

\subsection{Přechod zásobníkového automatu}

Nechť $xApay$ a $xwqy$ jsou dvě konfigurace ZA M, kde $x, w \in \Gamma^*$, $A \in \Gamma$, $p, q \in Q$, $a \in \Sigma \cup \{ \varepsilon \}$ a $y \in \Sigma^*$. Nechť $r = Apa \to wq \in R$ je pravidlo. Potom M může provést přechod z $xApay$ do $xwqy$ za použití $r$, zapsáno $xApay \vdash xwqy [r]$, nebo zjednodušeně $xApay \vdash xwqy$.

\paragraph{Sekvence přechodů}

Nechť $\chi$ je konfigurace. M provede nula přechodů z $\chi$ do $\chi$; zapisujeme $\chi \vdash^0 \chi [\varepsilon]$ nebo zjednodušeně $\chi \vdash^0 \chi$

Nechť $\chi_0, \chi_1, \dots, \chi_n$ je sekvence přechodů konfigurací pro $n \geq 1$ a $\chi_{i-1} \vdash \chi_i [r_i]$, $r_1 \in R$ pro všechna $i = 1, \dots, n$, což znamená $\chi_0 \vdash \chi_1 [r_1] \vdash \chi_2 [r_2] \dots \vdash \chi_n [r_n]$

Pak M provede n-přechodů z $\chi_0$ do $\chi_n$; zapisujeme $\chi_0 \vdash^n \chi_n [r_1 \dots r_n]$, nebo zjednodušeně $\chi_0 \vdash^n \chi_n$

\subsection{Přijímané jazyky}

Zásobníkový automat $M = (Q, \Sigma, \Gamma, R, s, S, F)$.

\begin{description}
	\item[Přechodem do koncového stavu] \hfill \\
	$L(M)_f = \{w: w \in \Sigma^*, Ssw \vdash^* zf, z \in \Gamma^*, f \in F  \}$
	
	\item[Vyprázdněním zásobníku] \hfill \\
	$L(M)_{\varepsilon} = \{ w: w \in \Sigma^*, Ssw \vdash^* zd, z = \varepsilon, f \in Q \}$
	
	\item[Přechodem do koncového stavu a vyprázdněním zásobníku] \hfill \\
	$L(M)_{f \varepsilon} = \{ w: w \in \Sigma^*, Ssw \vdash^* zf, z = \varepsilon, f \in F \}$
\end{description}

Existují algoritmy pro převody mezi nimi.

\subsection{Deterministický ZA}

Zásobníkový automat $M = (Q, \Sigma, \Gamma, R, s, S, F)$ je deterministický, pokud por každé pravidlo tvaru $Apa \to wq \in R$ platí, že množina $R - \{ Apa \to wq \}$ neobsahuje žádná pravidlo s levou stranou $Apa$ nebo $Ap$.

ZA jsou silnější než DZA -- například $L = \{ xy: x,y \in \Sigma^*, y = reversal(x) \}$ nelze popsat DZA.

\subsection{Rozšířený ZA -- RZA}

(z vrcholu zásobníku lze číst celý řetězec)

Definovány stejně jako ZA, ale $R$ je konečná množina pravidel tvaru $vpa \to wq$, kde $v,w \in \Gamma^*$, $p,q \in Q$, $a \in \Sigma \cup \{\varepsilon\}$

Tři typy jazyků přijímaných RZA.

Jazyky přijímané RZA a ZA jsou ekvivalentní.

\subsection{ZA a RZA pro syntaktickou analýzu}

\begin{description}
	\item[Shora dolů] Od $S$ směrem ke vstupnímu řetězci
	\begin{itemize}
		\item Porovnávací pravidla pro porovnáni symbolu na vrcholu zásobníku a aktuálního symbolu na vstupní pásce: $asa \to s$ pro každé $a \in \Sigma$
		\item Expanzní pravidla, která simulují gramatická pravidla: $As \to a_n \dots a_1s$ pro každé $A \to a_1 \dots a_n \in P$ v BKG (pozpátku)
	\end{itemize}
	\item[Zdola nahoru] Ze vstupního řetězce směrem k S
	\begin{itemize}
		\item Shiftovací pravidla přesouvají vstupní symboly na zásobník: $sa \to as \in R$, pro každé $a \in \Sigma$
		\item Redukční pravidla simulují aplikaci gramatických pravidel pozpátku: pro každé $A \to x \in P$ v BKG přidej $xs \to As$ do R
		\item Speciální pravidlo pro přechod do koncového stavu: $\#Ss \to f$
	\end{itemize}
\end{description}




























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Struktura překladače a charakteristika fází překladu} \label{cha:22}

3. semestr, IFJ, opora, 1., 5., 7. přednáška

(lexikální analýza, deterministická syntaktická analýza a generování kódu)


\section{Kompilátor}
Program, který na vstupu přijímá zdrojový program zapsaný ve zdrojovém jazyce, aby k němu na výstupu generoval funkčně ekvivalentní cílový program v cílovém jazyce. Proces se nazývá \emph{překlad}.

\begin{description}
	\item[Lexikální analýza] Lexikální analyzátor, Zdrojový program $\to$ Řetězec tokenů. 
	
	Rozpoznání Lexikálních symbolů (Lexémů) ve vstupním řetězci, převod na tokeny (mohou mít atributy)
	\item[Syntaktická analýza] Syntaktický analyzátor, tokeny $\to$ derivační strom (bývá pouze simulovaný)
	
	Na základě derivačních pravidel. Buď shora dolů, nebo zdola nahoru. Řetěz tokenů patřících do jazyka.
	\item[Sémantická analýza] Sémantický analyzátor, Derivační strom $\to$ Abstraktní syntaktický strom (ASS)
	
	význam řetězů -- kontrola typů, implicitní konverze, deklarace proměnných.
	\item[Generování vnitřní formy programu], Abstraktní syntaktický strom $\to$ Vnitřní kód
	
	většinou tříadresný kód 3AK -- jednotnost, jednoduchost optimalizace
	\item[Optimalizace] Vnitřní kód $\to$ Optimalizovaný vnitřní kód
	
	Např. Eliminace mrtvého kódu, šíření konstanty, šíření kopírováním
	\item[Generování cílového programu] Optimalizovaný vnitřní kód $\to$ Cílový program v cílovém jazyce. Většinou strojový kód, asembler.
\end{description}

\section{Lexikální analýza}

\begin{enumerate}
	\item Rozpoznání a klasifikace lexémů -- Deterministický konečný automat (Regulární výraz)
	\item Reprezentace Lexémů pomocí tokenů
	\item Komunikace s tabulkou symbolů (TS)
\end{enumerate}

\subsection{Konečný automat}
Každý koncový stav -- jeden lexém, přeskakování komentářů a přebytečných bílých znaků.

\lstset{language=sh,caption={Algoritmus lexikální analýzy}}
\begin{lstlisting}
while a je dalsi znak zdrojoveho textu
	and M muze udelat prechod se znakem a do:
		precti a;
		udelej prechod pro symbol a;
if M je v koncovem stavu then
	urci lexem
else
	lexikalni chyba
\end{lstlisting}

Atributy Tokenů mohou mít různý typ (ukazatel, celé číslo, nic) -- reprezentace jako ukazatele do tabulek podle typů.

Rozpoznání identifikátoru od klíčového slova pomocí tabulky klíčových slov až po načtení.

\paragraph{Tabulka symbolů}

\begin{itemize}
	\item Proměnná -- jméno, typ, délka
	\item Konstanta -- typ, hodnota
	\item Procedura -- počet a typ parametrů
\end{itemize}

Zásobníková struktura v závislosti na zanoření do podprogramů -- hledání proměnných od vrcholu dolů.

\paragraph{LEX} Převod RV $\to$ Lexikální analyzátor


\section{Syntaktická analýza shora dolů}

\subsection{LL-gramatika bez $\varepsilon$-pravidel}
Výběr pravidla pomocí tabulky $N \times T$

\paragraph{First(X)}
$X \in N \cup T: a \in First(a) \forall a \in T$ \\
if $A \to X_1 X_2 \dots X_n \in P$ then přidej $First(X_1)$ do First(A)

\paragraph{LL-tabulka}
\begin{tabular}{c | c c c}
		& $T_1$	& $T_2$	& $\cdots$ \\ \hline
$N_1$	& 		&		&	\\
$N_2$	& 		&		&	\\
\vdots	& \multicolumn{3}{c}{číslo pravidla, pro které je $T_i \in First(N_j)$}	\\
\end{tabular}

Obecně slabší, než BKG. Některé mohou být převedeny na LL
\begin{itemize}
	\item Faktorizace -- změnit pravidla, která mají stejné First množiny (vytýkání)
	\item Odstranit levou rekurzi ($A \to Ax, A \in N, x \in (T \cup N)$ převodem na pravou rekurzi
\end{itemize}

\subsection{LL-gramatika s $\varepsilon$-pravidly}

Potřebujeme zakončovací znak (\$), použitelné jako gramatika pro aritmetické výrazy.

\begin{description}
	\item[Empty(X)] Obsahuje $\varepsilon$, pokud X derivuje $\varepsilon$
	\item[First(X)] Obsahuje terminály, na které může být neterminál převeden s ohledem na Empty(X)
	\item[Empty($X_1, X_2, \dots X_n$)]
	\item[First($X_1, X_2, \dots X_n$)]
	\item[Follow(A)] Množina terminálů, které se mohou vyskytovat napravo od A ve větné formě
	\item[Predict($A \to X$] Množina terminálů, které mohou být nejlevěji vygenerovány použitím daného pravidla 
\end{description}

\paragraph{LL-tabulka}
\begin{tabular}{c | c c c}
		& $T_1$	& $T_2$	& $\cdots$ \\ \hline
$N_1$	& 		&		&	\\
$N_2$	& 		&		&	\\
\vdots	& \multicolumn{3}{c}{číslo pravidla, pro které je $T_i \in Predict(N_j \to X)$}	\\
\end{tabular}

Nechť $G = (N, T, P, S)$ je BKG. G je LL-gramatika, pokud pro každé $a \in T$ a každé $A \in N$ existuje maximálně jedno pravidlo $A \to X_1 X_2 \dots X_n \in P$ a platí $a \in Predict(A \to X_1 X_2 \dots X_n)$.

\subsection{Implementace}
\begin{description}
	\item[Rekurzivní sestup] Každý neterminál je reprezentován procedurou, která řídí SA a zanořování (zásobník je zásobník volání)
	\item[Prediktivní syntaktická analýza] zásobník explicitní -- příkazy pop, push, záměna levé strany pravidla (A) za pravou v opačném pořadí. Řízené LL tabulkou.
\end{description}

\section{Syntaktická analýza zdola nahoru}

Problém, pokud dvě pravidla mají stejnou pravou stran, nebo pokud používáme nejednoznačné gramatiky

\subsection{Precedenční syntaktická analýza}

Gramatika nesmí obsahovat více pravidel se stejnou pravou stranou a $\varepsilon$-pravidla

\paragraph{Precedenční tabulka}
tabulka $[ a_i, a_j ] = {<, >, =, nic}, a \in T$

Pravý rozbor -- rezervovaná posloupnost pravidel, která je použita v nejpravější derivaci

\lstset{language=pascal,caption={Algoritmus precedenční syntaktické analýzy}}
\begin{lstlisting}
repeat
	a; // znak na vstupu
	b; // terminal nejblize vrcholu na zasobniku
	case tab[b,a] of
		= : push(a) & read next a;
		< : zamen b za b< & push(a) & read next a;
		> : if <y na vrcholu zasobniku and r: A -> y in P then
				zamen <y za A & vypis r;
				else chyba
		nic: chyba
until a = $ and b = $
success
\end{lstlisting}

Konstrukce precedenční tabulky:
\begin{itemize}
	\item Priorita operátorů $ * > +$
	\item Asociativita operátorů $ + > + $
	\item Identifikátory: můžou být hned před/hned za
	\item Závorky $ ( = ) $ atd
	\item Ukončovací řetězce $\$ < op$, $ op > \$$
\end{itemize}

\subsection{LR syntaktický analyzátor}

složitější, pracuje se dvěmi tabulkami -- akční a přechodovou.

\section{Sémantické akce}

Bývají přiřazeny syntaktickým pravidlům (blízké spojení se syntaktickým analyzátorem).


\paragraph{Tříadresný kód}
3AK (operátor, operand1, operand2, výsledek) -- 3 adresy

Možnost generování přímo, nebo přes postfixovou notaci, nebo přes abstraktní syntaktický strom (ASS)

\paragraph{Postfixová notace}
Operátory se vyskytují až za operandy (postorder průchod ASS)

\paragraph{Přechodové gramatiky} převod vstupního řetězce na výstupní.
\begin{itemize}
	\item Dvě gramatiky -- mezivýsledkem je levý rozbor
	\item Jedna gramatika -- pravidla se dvěma pravými stranami
\end{itemize}

\section{Generování cílového kódu}

\begin{description}
	\item[Slepé] pro každou 3AK existuje procedura, které ji převede na výsledný kód (neřeší se kontext, můžou vznikat zbytečná čtení a zápisy do paměti).
	\item[Kontextové] redukce nepotřebných načítání a ukládání proměnných. V tabulce symbolů informace (živá/mrtvá, další použití). Zpětné procházení instrukcí. Dále tabulky registrů, adres.
\end{description}












































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Numerické metody a matematická pravděpodobnost} \label{cha:23}

3. semestr, INM, skripta Matematika 3\\
5. semestr, IMS, slajdy 100 - 111

(numerické řešení algebraických a obyčejných diferenciálních rovnic, rozložení pravděpodobnosti, generování pseudonáhodných čísel)

\section{Numerické řešení soustavy lineárních rovnic}

N lineárních rovnic o N neznámých.


\subsection{Přímé metody}

řešení získáme po konečném počtu kroků. Přesné (mimo zaokrouhlovací chyby).

\paragraph{Crammerovo pravidlo}
Je-li matice doustavy regulární (Determinant $\neq$ 0), pak $x_1 = \frac{D_1}{D}, \dots$, kde D je determinant matice a $D_k$ je determinant s nahrazeným k-tým sloupcem matice vektorem pravých stran soustavy. Řešitelné pro 2 - 3 rovnice.

\paragraph{Gaussova eliminační metoda}
Úprava soustavy na trojúhelníkový tvar odstraněním $x_1$ ze všech rovnic kromě první (odečtením $\frac{a_{i1}}{a_{11}}*$první rovnice od všech ostatních). Stejně tak pokračovat s dalšími rovnicemi.

\paragraph{Eliminace s výběrem hlavního prvku}
Stejná jako Gaussova, ale nejdříve vybereme na uhlopříčku největší koeficient u $x_i$ a změníme pořadí rovnic. Eliminace (zmenšení) zaokrouhlovacích chyb.

\subsection{Iterační metody}
Získáme pouze přibližné řešení. Zvolíme počáteční aproximaci a tu zpřesňujeme

\paragraph{Jacobiho metoda}
Z každé rovnice vyjádříme jedu proměnnou: $x_1 = \frac{1}{a_{11}} \left( b_1 - a_{12}x_2 - \dots - a_{1n}x_n \right)$.

Zvolíme libovolně vektor počáteční aproximace $x^{(0)}$ a dosadíme do pravých stran rovnic a získáme novou aproximaci.

Pokračujeme do předem dané přesnosti (počtu kroků, dostatečně malé změny).

Ne vždy konverguje -- Pro zaručení musí být matice řádkově ostře diagonálně dominantní, nebo sloupcově ostře diagonálně dominantní.

\paragraph{Gauss-Seidelova metoda}
Velmi podobná Jacobiho, používá ale pouze jeden vektor hodnot -- $x_1$ spočítané v jednom kroku používáme při výpočtu $x_2$.

Stejné podmínky konvergence. Konverguje také pokud je pozitivně definitní.

\section{Numerické metody řešení nelineárních rovnic}

\subsection{Řešení jedné rovnice}
$f(x) = 0$ hledáme, kde se rovnice protíná s osou x. Hledáme kořeny rovnice.

\paragraph{Separace kořenů}

Je-li funkce $f(x)$ na intervalu $<a,b>$ spojitá a platí-li $ f(a) \cdot f(b) < 0$, pak v intervalu leží alespoň jeden kořen rovnice $f(x) = 0$. (Funkce má opačná znaménka)

\paragraph{Metoda půlení intervalů}
Máme interval $<a_0,b_0>$ takový, že je v něm funkce spojitá a leží v něm alespoň jeden kořen.

určíme střed $x_0 = \frac{a_0 + b_0}{2}$ a z intervalů $<a_0, x_0>$ a $<x_0, b_0>$ vybereme ten, který obsahuje kořen (opačná znaménka krajních bodů).

Opakujeme dokud $b_k - a_k < 2 \varepsilon$.

Kořen nalezne vždy, přesnost řešení je zaručena, konverguje pomalu.

\paragraph{Metoda regula falsi}
Zužujeme interval, nový bod je bod průsečíku sečny mezi body $[a, f(x)]$ a $[b, f(b)$ a osy x.

$x_k = b_k - \frac{b_k - a_k}{f(b_k) - f(a_k)} f(b_k)$

Kořen nalezne vždy, většinou rychlejší než půlení intervalů. Nezaručí přesnost $|x_k - x_{k-1}| < \varepsilon$.

\paragraph{Metoda sečen}
Hledáme sečny, ale výpočet dalšího intervalu je nezávislý na hodnotě znaménka. Vždy sečna mezi druhým bodem a nově spočítaným.

$x_{k+1} = x_k - \frac{x_k - x_{k-1}}{xf(x_k) - f(x_{k-1})} f(x_k)$

Bývá rychlejší, ale nemusí konvergovat. Nezaručuje přesnost.

\paragraph{Newtonova metoda (tečen)}
funkce musí mít na intervalu derivaci. Určíme počáteční aproximaci $x_0$, bodem $[x_0, f(x_)0]$ vedeme tečnu, průsečík s osou x je nový bod $x_1$, kterým vedeme další tečnu.

$x_{k+1} = x_k - \frac{f(x_k)}{f'(x_k)}$

Nejefektivnější, ale nemusí konvergovat. Konverguje, pokud je splněna \emph{Fourierova podmínka}: $f'(x)$ a $f''(x)$ musí být spojité a neměnit znaménko na intervalu (nemění se růst/klesání, konvexnost/konkávnost) a $f(x_0) \cdot f''(x_0) > 0$.

\paragraph{Metoda prosté iterace}
Rovnici $f(x) = 0$ upravíme na tvar $x = g(x)$ -- iterační funkce.

Zvolíme počáteční aproximaci a počítáme $x_{k+1} = g(x_k)$

\section{Metody řešení soustavy nelineárních rovnic}

$F(x) = o$ N nelineárních rovnic o N neznámých.

\paragraph{Metoda prosté iterace}
upravíme na tvar $x = G(x)$, zvolíme počáteční aproximace a postupně dosazujeme do rovnic a určujeme nové aproximace.

Bývá obtížné najít vhodné iterační funkce.

\paragraph{Newtonova metoda}
V každém kroku řešíme soustavu lineárních rovnic $F'(x^{(k)}) \cdot \delta^{(k)} = -F(x^{(k)})$ a $x^{(k+1)} = x^{(k)} + \delta^{(k)}$ 

\section{Numerické řešení diferenciálních rovnic}
Nehledáme spojitou funkci jako výsledek, ale pouze konečnou množinu tzv. uzlových bodů, síť. $\Delta x$ je krok sítě, označovaný jako $k$.

\subsection{Počáteční úlohy: Jednokrokové metody}

Definované jako diferenciální rovnice prvního řádu s počáteční podmínkou.

\paragraph{Eulerova metoda} prvního řádu. Pravidelná síť s krokem h. Další bod určíme podle derivace v daném bodě.

$y_{i+1} = y_i + n f(x_i, y_i)$, vycházíme z počátečních podmínek $[x_0, y_0]$.

\paragraph{Modifikovaná Eulerova metoda} druhého řádu

$k_1 = f(x_n, y_n)$

$k_2 = f(x_n + \frac{1}{2}h, y_n + \frac{1}{2} k_1 h)$

$y_{n+1} = y_n + k_2 h$

\paragraph{Runge Kuttovy metody} RK4. Obecně mohou mít jiné koeficienty.

$k_1 = f(x_n, y_n)$

$k_2 = f(x_n + \frac{1}{2}h, y_n + \frac{1}{2} k_1 h)$

$k_3 = f(x_n + \frac{1}{2}h, y_n + \frac{1}{2} k_2 h)$

$k_4 = f(x_n + h, y_n + k_3 h)$

$y_{n+1} = y_n + \frac{1}{6} h \left( k_1 + 2k_2 + 2k_3 + k4 \right) h$

\paragraph{Odhad chyby a řízení kroku} poloviční krok

\subsection{Počáteční úlohy: Vícekrokové metody}
Používáme výsledky minulých kroků. Problém startu metody (nemáme historii. Často řešení pomocí nějaké jednokrokové).

\paragraph{Lineární k-kroková metoda} 
\begin{itemize}
	\item Explicitní -- hodnotu v novém bodě vypočítáme dosazením do vzorce
	\item Implicitní -- V každém kroku řešíme soustavu rovnic
\end{itemize}

$y_{n+1} = y_{n-3} + \frac{4}{3} n \left( 2 f_{n-1} - f_{n-1} + 2f_{n} \right)$, kde $f_n = f(x_n, y_n)$

\paragraph{Metody založené na numerické integraci} Adams-Bashforthovy metody, Adams-Moultonova metoda

\paragraph{Prediktor-Korektor}
\begin{enumerate}
	\item Vypočítáme počáteční aproximaci pomocí explicitní vícekrokové metody (Prediktor)
	\item Tuto hodnotu zpřesňujeme pomocí implicitní vícekrokové metody (Korektor)
\end{enumerate}

Většinou volíme metody téhož řádu.

\subsection{Okrajové podmínky}
Hledání sítě na intervalu $<a, b>$, definovány dva body: $y(a) = \alpha$, $y(b) = \beta$

Metoda konečných diferencí, Metoda střelby

\section{Pravděpodobnost}

$\Omega$ množina všech hodnot, kterých dané náhodná veličina X může nabývat. Množina všech možných výsledků.

$A, B \subset \Omega$ náhodné jevy.

$X$ náhodná proměnná, pokud nabývá hodnoty z A, nastal náhodný jev.

$P(A)$ pravděpodobnost jevu A, $0 \leq P(A) \leq 1$

\subsection{Rozdělení pravděpodobností}
\begin{description}
	\item[Klasická pravděpodobnost] Podíl počtu příznivých výsledků ku počtu všech možných výsledků. Množina všech možných výsledků je konečná, všechny jevy jsou stejně pravděpodobné.
	\item[Geometrická pravděpodobnost] Podíl míry příznivých výsledků a míry všech možných výsledků. Míra může být délka, obsah, objem. $\Omega$ je nespočetná a výsledky nastávají se stejnou pravděpodobností.
	\item[Diskrétní pravděpodobnost] $\Omega$ je konečná nebo spočetná, výsledky mohou mít různou pravděpodobnost.
	
	X diskrétní náhodná veličina \\
	$p(x) = P(X=x)$ pravděpodobnostní funkce\\
	$F(X) = P(X < x)$ distribuční funkce
	
	\item[Spojitá pravděpodobnost] $\Omega$ nespočetně konečná (např. reálná čísla). Může nabývat různých pravděpodobností
	
	$f(x)$ funkce hustoty pravděpodobnosti\\
	$F(x) = P(X < x) = \int_{-\infty}^x f(t) dt$ distribuční funkce
\end{description}

\subsection{Empirické charakteristiky rozložení pravděpodobnosti}
získáno z naměřených dat, reprezentováno tabulkou, histogramem četnosti / pravděpodobnosti proměnné X

\begin{description}
	\item[Průměr] $\overline{x} = \frac{1}{n} \sum_{i=1}^n x_i$
	\item[Medián] Prostřední z hodnot uspořádaných podle velikosti
	\item[Modus] Hodnota které se ve vzorku vyskytuje nejčastěji
	\item Odchylka, Absolutní odchylka, Kvadratická odchylka, Průměrná odchylka, ...
\end{description}

\subsection{Teoretické charakteristiky rozložení pravděpodobnosti}

hodnoty určené výpočtem

\paragraph{Diskrétní}
\begin{itemize}
	\item $EX = \sum v_i p(v_i)$ Střední hodnota
	\item $DX = E(E-EX)^2 = EX^2 - (EX)^2$ Rozptyl
	\item $\sqrt(DX)$ Směrodatná odchylka
\end{itemize}

\paragraph{Spojité}
\begin{itemize}
	\item $EX = \int_{-\infty}^{+\infty} x f(x) dx$
	\item $DX, \sqrt{DX}$ stejné
\end{itemize}

\subsection{Konkrétní rozdělení}
\begin{description}
	\item[Binomické rozdělení pravděpodobnosti] p je pravděpodobnost úspěchu, (1-p) je pravděpodobnost neúspěchu, náhodná veličina X udává počet úspěchů při N nezávislých opakování experimentu. Pokud p=0.5, rozdělení je symetrické.
	
	$X \sim Bi(N, p) \qquad P(X = r) = {N \choose r} p^r (1-p)^{n-r}$
	
	\item[Poissonovo a Exponenciální] diskrétní a spojité. Poissonovo určuje počet výskytů události za určitý časový interval, Exponenciální označuje průměrnou dobu mezi příchody náhodných událostí. Proměnná $\lambda$ značí průměrný počet výskytů za jednotku času.
	
	$X \sim Exp(\lambda) \qquad EX = \frac{1}{\lambda} \qquad DX = \frac{1}{\lambda^2}$ 
	
	$Y \sim Po(\lambda) \qquad EY = \lambda \qquad DY = \lambda$
	
	Využíváno v teorii front.
	
	\item[Rovnoměrné a Normální] Rovnoměrné má stejnou pravděpodobnost na celém intervalu. Základem pro ostatní rozložení.
	
	$X \sim Ro(a,b) \qquad f(t) = \left\{ 
   \begin{array}{l l}
     \frac{1}{b-a}  & \quad t \in <a,b>\\
     0  & \quad \text{jinak}\\
   \end{array} \right.$
   
   $Y \sim No(\mu, \sigma^2) \qquad EY = \mu \qquad DY = \sigma^2$
   
   Centrální limitní věta -- Hodně proměnných lze popsat s velkou přesností pomocí normálního rozdělení.
   
   Standardizované normální rozdělení: No(0, 1). Definováno v tabulce $\Phi(u)$
\end{description}

\section{Generování náhodných čísel}

\begin{itemize}
	\item Kongruentní generátory: $x_{n+1} = (a x_n + b) \bmod m$. Konstanty multiplikativní, aditivní, modulu.
	
	Problém určení vhodných hodnot pro splnění podmínek: rovnoměrné rozložení, konečná posloupnost $ix * 69069 + 1 \pmod{ 2^{32} }$
	
	\item Mersene twister -- perioda obrovská
	\item Lienar Congruent generator (LCG): další druhy
\end{itemize}

\paragraph{Transformace na jiné rozložení}
\begin{itemize}
	\item Inverzní transformace
	\item Vylučovací
	\item Kompoziční
	\item Jiné, speciální
\end{itemize}






























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Řešení úloh} \label{cha:24}

4. semestr, IZU, opora (první půlka)

(prohledávání stavového prostoru, rozklad na podúlohy, metody hraní her)

\paragraph{inteligence} složitá kongitivní vlastnost osobnosti, umožňuje poznávat svět a využívat získané poznatky.

\paragraph{Umělá inteligence}

Vlastnost vytvořeného systému, který má schopnost rozpoznávat předměty a jevy, analyzovat vztahy mezi nimi a tak si vytvářet modely světa, rozhodovat, předpovídat důsledky, řešit problémy a objevovat nové zákonitosti.

\section{Metody řešení úloh}

\subsection{UI úloha}
Definována počátečním stavem, množinou cílových stavů a operátorů, které mohou tento stav měnit.
\paragraph{Řešením} je nalezení pořadí aplikace operátorů pro přechod z výchozího stavu do některého cílového.

Prostředí musí být deterministické, statické a diskrétní.

\paragraph{Metody řešení}
\begin{itemize}
	\item Prohledávání stavového prostoru (State Space Search)
	\item S omezujícími podmínkami
	\item Metody založené na rozkladu úloh na podproblémy
	\item Metody hraní her
\end{itemize}

\section{Prohledávání stavového prostoru}

\paragraph{Stavový prostor}
Množiny S (stavy) a O (operátory)

\paragraph{Úloha}
počáteční stav $s_0$, množina cílových stavů $G \in S$

\paragraph{Řešení úlohy}
posloupnost operátorů.

Stavový prostor lze reprezentovat orientovaným grafem/stromem. Uzly jsou stavy, hrany jsou přechody mezi stavy. Řešením je cesta z počátečního stavy do některého cílového.

Úkolem bývá minimalizovat cenu této cesty.

\subsection{Typy úloh}
\begin{description}
	\item[Úloha dvou džbánů] 5litrový, 3litrový, cílem 4 litry vody. Operace naplnění, vyprázdnění, přelití.
	\item[Hlavolam 8, Hlavolam 15] Posun prázdného políčka pro sestavení daného rozmístění (Množina stavů obsahuje dva disjunktní stavové prostory).
	\item[Úloha N dam] Rozmístění N dam na šachovnici NxN, $N \geq 4$.
	\item[Nalezení nejkratší cesty] mezi dvěma různými místy
	\item[Úloha obchodního cestujícího, TSP]
\end{description}

Je potřeba vhodně definovat úlohu (primárně zvolit operátory).

\subsection{Hodnotící kritéria}
\begin{itemize}
	\item Úplnost -- nalezne vždy řešení, pokud existuje
	\item Časová a paměťová složitost
	\item Optimálnost -- nalezne nejlepší řešení
\end{itemize}

\subsection{Metody}
\begin{description}
	\item[Neinformované (Slepé)] nemají informace, kterými by mohly hodnotit jednotlivé stavy
	\begin{description}
		\item[BFS] Breadth First Search -- prohledávání do šířky -- fronta -- úplná, optimální, exponenciální paměťová a časová složitost
		\begin{enumerate}
			\item fronta OPEN (uzly k expanzi), do ní se vloží počáteční uzel
			\item vyber první uzel
			\item je-li cílový, úspěch
			\item expanze všech následovníků na konec fronty OPEN
		\end{enumerate}
		Problém s opakovaným generováním již expandovaných stavů -- fronta CLOSED (v~bodě 3 přidej, v~bodě 5 kontroluj)
		
		\item[UCS] Uniform Cost Search -- uvažuje navíc ceny přechodů -- úplná, optimální, exponenciální paměťová a časová složitost
		\begin{enumerate}
			\item seznamy OPEN, CLOSED, do OPEN počáteční stav
			\item Je-li seznam OPEN prázdný, neúspěch
			\item Vyber z OPEN stav s nejmenším ohodnocením, umísti do CLOSED
			\item Je-li vybraný cílový, úspěch
			\item Expanduj uzel, přidej následovníky, kteří nejsou v CLOSED, pokud jsou v OPEN, nech pouze s menším ohodnocením
		\end{enumerate}
		
		\item[DFS] Depht First Search -- zásobník -- neúplná, neoptimální, složitost časová exponenciální, paměťová lineární
		
		Použit zásobník místo fronty -- může jednoduše cyklit. Optimalizace -- vkládat pouze ty stavy, které nejsou předky aktuálního.
		
		\item[DLS] Depth Limited Search -- podobné DFS, ale omezené hloubka hledání (např. počet stavů~-~1)
		
		\item[IDS] Iterative Deeping Search -- úplný, optimální, časová a paměťová složitost exponenciální
		
		\item[Backtracking] neúplná, neoptimální, časová složitost exponenciální, paměťová extrémně nízká
		\begin{enumerate}
			\item zásobník OPEN, umísti počáteční stav
			\item je-li zásobník prázdný, úloha nemá řešení
			\item jde-li na prvek v zásobníku aplikovat další/první operátor, aplikuj. Jinak uzel odstraň
			\item Je-li nově generovaný prvek cílový, úspěch, jinak vlož na vrchol zásobníku
		\end{enumerate}
		Modifikace -- prvek vkládat pouze, pokud není v OPEN (předchůdce)
		
		\item[BS] Bidirectional Search -- úplná, optimální, časově exponenciální, paměťově poloviční BFS
		
		Použitelné u úloh s inverzními operátory -- lze jít hledat "naproti" od cílového uzlu
	\end{description}
	\item[Informované] stavy lze ohodnotit heuristickou funkcí
	\begin{description}
		\item[Best First Search] Velmi podobné UCS, přidána heuristika, pro určení zbývající ceny do cílového uzlu: $f(x) = g(x) + h(x)$, $h(x)$ je heuristika, $g(x)$ je cena cesty z počátečního uzlu.
		
		\begin{description}
			\item[Greedy Search] $g(x) = 0$, obecně neúplná a neoptimální, heuristika může vylepšit
			
			\item[A*] Heuristika spodním odhadem skutečné ceny -- úplná, pro dobrou heuristiku optimální
			
			Příklad heuristiky pro Hlavolam 8: Počet kamenů na nesprávných pozicích, vzdálenost kamenů od správných pozic
		\end{description}
		\item[Lokální prohledávání] Nezajímá nás cesta, ale pouze cílový stav. Minimální paměťová složitost, přijatelné řešení v rozsáhlých (spojitých, nekonečných) stavových prostorech
		\begin{description}
			\item[Hill Climbing] používá pouze heuristiku $h(n)$ jako Greedy Search a ohodnocuje kvalitu řešení.
			\begin{enumerate}
				\item Vytvoř uzel Current, přiřaď mu počáteční stav
				\item Expanduj uzel, ohodnoť bezprostřední následníky a vyber nejlépe hodnoceného jako Next
				\item Je-li Current > Next ukonči a vrať Current
				\item Ulož Next do Current a pokračuj od 2
			\end{enumerate}
			Problém lokálních extrémů -- Beams -- několik uzlů Current
			
			\item[Simulované žíhání] s cílem překonat lokální extrémy
		\end{description}
	\end{description}
\end{description}

\section{Úlohy s omezujícími podmínkami} Constraint Satisfaction Problems (CSP)

Potřeba zkoumat vnitřní strukturu stavů. Definovány proměnné, jejich domény, podmínky pro splnění úlohy a operátory přiřazující hodnoty proměnným.

Řešením je legální stav, ve kterém všechny proměnné mají hodnoty. V počátečním stavu jsou proměnné bez hodnot.

Například úloha N dam, kryptoaritmetické hlavolamy.

Řešit lze pomocí předchozích jmenovaných, nebo specializovaných.
\begin{description}
	\item[Backtracking for CSP] v každém kroku přiřazuje hodnotu proměnné. Pokud stav legální, zanořujeme do dalšího, jinak návrat a zkoušíme jinou hodnotu.
	
	\item[Forward checking] Rekurzivní, kontrola domén po přiřazení hodnoty proměnné. Pokud některá doména prázdná, návrat.
	
	\item[Min-conflict] Lokální algoritmus. Vychází z libovolného úplného stavu a snaží se zmenšovat počet konfliktů.
	
	Např. Konflikt = počet ohrožení dámy na dané pozici. Pokud více stejných, změna
\end{description}

\section{Rozklad úlohy na podúlohy}

\subsection{AO algoritmus} může být do hloubky, nebo do šířky (FRONTA nebo ZÁSOBNÍK).

(AND možnosti jsou spojeny čárou jako úhel)

\begin{enumerate}
	\item Prázdné seznamy OPEN, CLOSED, do OPEN přidej počáteční uzel
	\item Vyjmi uzel X zleva seznamu OPEN
	\item
	\begin{enumerate}
		\item Je-li uzel X řešitelný, přenes informaci o řešitelnosti jeho předchůdcům. Je-li počáteční, úspěch.
		\item Není-li uzel řešitelný a nelze jej rozložit na podproblémy, přenos informace o neřešitelnosti jeho předchůdcům
		\item Expanduj uzel X (rozlož uzel na podproblémy) a všechny následovníky ulož do OPEN
	\end{enumerate}
	\item Ulož X do CLOSED
	\item Je-li OPEN prázdný, neúspěch, jinak 2
\end{enumerate}

\subsection{AO* algoritmus}
Informovaný, heuristická funkce hodnotí problémy -- 0 triviální, FUTILITY neřešitelný

\section{Metody hraní her}

hry se dvěma hráči, kteří se pravidelně střídají po tazích, oba mají přehled o hře a oba si přejí vyhrát.

\paragraph{Pro hráče A (na tahu)} je stav řešitelný, když alespoň jeden z jeho tahů vede k výhře (OR problém). V dalším tahu musí být stav pro B neřešitelný (ve všech možnostech -- AND problém).

\subsection{Jednoduché hry}

Lze v reálném čase prohledat celý AND/OR graf až ke úspěchu/neúspěchu. Řešení AO algoritmem.

\paragraph{Hra se zápalkami}

vyhrává ten kdo vezme poslední zápalku

\subsection{Složité hry}

neřešitelné prohledávat celý graf. Omezíme hloubku a ohodnotíme stavy: vítězství/prohra: -127 \dots +127. Hráč A hledá maximální ohodnocení, hráč B hledá minimální ohodnocení.

\paragraph{MiniMax} pro počáteční stav vrací ohodnocení uzlu a nejvýhodnější stav
\begin{enumerate}
	\item Uzel X
	\item Je-li X list (konečný stav, nebo maximální zanoření), vrať ohodnocení
	\item Je-li na tahu A, tak pro všechny následovníky volej MiniMax a vrať maximální z nalezených hodnot.
	\item Je-li na tahu B, tak pro všechny následovníky volej MiniMax a vrať minimální z nalezených hodnot.
\end{enumerate}

Například Tic-Tac-Toe -- hodnocení -- počet trojic, které může hráč A udělat - počet trojic, které může udělat hráč B.

Některé uzly jsou vyšetřovány zbytečně:

\paragraph{Alfa a Beta řezy}
Přidáme ohodnocení $\alpha$ pro hráče A (maximum) a $\beta$ pro hráče B (minimum). Vycházíme z $\pm \infty$ a expandujeme dokud $ \alpha < \beta$.

Dolů se $\alpha, \beta$ kopíruje, nahoru se kopíruje do opačné proměnné.

\section{Hry s neurčitostí}

Hráč na tahu právě hodil kostkou a hledá nejlepší tah.

$expectimin(C_i) = \sum_k P( h_k) * min(D_{ijk})$

pravděpodobnost daného výsledku hodu, ohodnocení výsledku daného hodu

$expectimax(D_j) = \sum_k P( h_k) * min(C_{jki})$

\begin{enumerate}
	\item Vstupní uzel X
	\item Na tahu hráč A: pro všechny následovníky volej ExpectiMiniMax a vrať maximální hodnotu z hodnot \emph{expectimin}
	\item Na tahu hráč B: pro všechny následovníky volej ExpectiMiniMax a vrať minimální hodnotu z hodnot \emph{expectimax}
\end{enumerate}



























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Principy modelování a simulace systémů} \label{cha:25}

5. semestr, IMS, slajdy

(systémy, modely, simulace, algoritmy řízení simulace)

\subsection{Modelování}
vytváření modelů systémů

\subsection{Simulace} metoda získávání nových znalostí o systému experimentováním s jeho modelem.

Realita -- Znalosti -- Abstraktní model -- Simulační model -- Znalosti (experimentováním)

Výhody: Cena, rychlost, bezpečnost

Problémy: Validita modelů, náročnost tvorby a na výkon

\section{Systém}
Soubor elementárních částí (prvků systému), které mají mezi sebou určité vazby.

Reálné $\times$ Fiktivní (nereálné)

\paragraph{Definice}
$S = (U, R)$ Universum U -- konečná množina prvků systému: $U = \{u_1, u_2, \dots \}$

Prvek systému $u_i = (X_i, Y_i)$ X vstupní proměnné, Y výstupní proměnné.

R -- charakteristika systému $R = \bigcup^N_{i,j = 1} R_{ij}, R_{ij} \subseteq Y_i \times X_i$ propojení prvků $u_i$ a $u_j$

\emph{Vazby}: sériové, paralelní, zpětná vazba.

\paragraph{Čas}
\begin{itemize}
	\item Reálný -- čas ve kterém probíhá skutečný děj
	\item Modelový -- časová osa modelu (např. proměnná T)
	\item Strojový -- čas spotřebovaný procesorem
\end{itemize}

\paragraph{Časová množina}
Diskrétní -- Spojitá (na číslicových počítačích se diskretizuje).

Množina všech časových okamžiků, na které jsou definovány hodnoty vstupních, stavových a výstupních proměnných.

\paragraph{Chování systému}
každému časovému průběhu vstupní veličiny přiřazuje časový průběh výstupní veličiny

\paragraph{Ekvivalence chování systémů} stejné podněty vyvolají stejnou reakci

\paragraph{Izomorfní systémy} 1:1 lze přiřadit prvky univerza U1 a U2. R1 a R2 mezi odpovídající dvojici U1 a U2

\paragraph{Homomorfní systémy} prvkům U1 je možné přiřadit jednoznačně prvky U2 (N:1). Podobně s R. Princip modelování.

\paragraph{Okolí systému} Co má na systém vliv a není v systému: Otevřený -- Uzavřený

\paragraph{Klasifikace prvků systémů} Spojité -- Diskrétní -- Kombinované

Deterministické -- Nedeterministické (Stochastické)

\paragraph{Typy simulace} Spojitá -- Diskrétní -- Kombinovaná

Kvalitativní -- Kvantitativní

\paragraph{Verifikace} ověření korespondence AM a SM

\paragraph{Validace} snaha dokázat, že pracujeme s modelem adekvátním modelovanému systému



\section{Model}
napodobenina systému jiným systémem (reprezentace znalostí)

\subsection{Abstraktní model}
Konečný automat, Petriho síť, Turingův stroj, Algebraické rovnice, Diferenciální rovnice, Defirenční rovnice, Markovské procesy

Formulace zjednodušeného modelu abstraujícího se od všech nedůležitých skutečností vzhledem k cíli a účely

MS $\to$ AS homomorfní stav

\subsection{Cíle a účely modelů}
Studium chování systémů pro určitá specifická kritéria, povahy, závislosti mezi parametry a odezvou

Analýza citlivosti -- určení faktorů, které jsou pro činnost systému nejvýraznější

Optimalizace -- nalezení kombinace parametrů, která vede k nejlepší odezvě systému.

\subsection{Simulační model}

Abstraktní model popsaný formou programu. Izomorfní vztah k abstraktnímu modelu

Spojité -- Diskrétní -- Kombinované
\begin{description}
	\item[Konceptuální] komponenty zatím nebyly přesně popsány v teorii systémů (text, obrázky)
	\item[Deklarativní] popis přechodů mezi stavy systému, stavu + události, diskrétní chování (KA, Petriho sítě)
	\item[Funkcionální] grafy zobrazující funkce a proměnné (SHO, bloková schémata, grafy signálových toků)
	\item[Popsané rovnicemi] Algebraické, diferenciální, elektrické schémata (například dravec-kořist)
	\item[Prostorové (spatial)] rozdělení systému na podprostorově menší podsystémy -- parciální diferenciální rovnice, hra Life
	\item[Multimodely] heterogenní modely složené z ostatních. Kombinované, fuzzy, HLA (=High Level Architecture)
\end{description}

\subsection{Simulační nástroje}
\begin{itemize}
	\item Obecné jazyky -- C, C++, Java
	\item Simulační knihovny pro obecné jazyky -- SIMLIB/C++
	\item Simulační jazyky -- Simula67, Modelica
	\item Simulační systémy -- Dymola
	\item propojení různých nástrojů -- HLA -- standard pro distribuovanou simulaci
\end{itemize}
výhodné použít OOP

\section{Modelování náhodných procesů}

Některé procesy nedokážeme popsat jinak, protože jsou příliš složité, ale vykazují jistou pravidelnost.

Změříme dostatečný vzorek, aproximujeme pomocí vhodného rozložení, pseudonáhodný proces modelujeme generátorem pseudonáhodných čísel.

\paragraph{Náhodná proměnná}
veličina, které jako výsledek může nabývat nějakou hodnotu. Spojitá -- Diskrétní. Označujeme X, možnosti $x_1, x_2 \dots$

\subsection{Diskrétní}

\paragraph{Diskrétní rozložení pravděpodobnosti}
vztah mezi možnými hodnotami náhodné veličiny $x_i$ a jim příslušejícím pravděpodobnostem $p_i = P(X = x_i)$, $\sum_{i = 1}^\infty p_i = 1$. Reprezentace tabulkou pro všechny možné hodnoty.

\paragraph{Diskrétní distribuční funkce}
$F(x) = P(X \leq x_i) = \sum_{x_i < x}$

\subsection{Spojité}

\paragraph{Spojitá distribuční funkce}
$F(x) = P(X \leq x) = \int^x_{-\infty} f(x) dx$

funkce hustoty pravděpodobnosti: $f(x) = \frac{dF(x)}{dx}$

\paragraph{Histogram}
Roztřídění souboru hodnot do k tříd podle vhodných intervalů -- blíží se funkci hustoty pravděpodobnosti.

Charakteristiky: POlohy, Variability, Šikmosti a Špičatosti. Určuje se pomocí tzv. momentů.

\subsection{Známá rozložení}
\begin{description}
	\item[Diskértní] \hfill
	\begin{description}
		\item[Poisonovo] počet událostí za jednotku času
		\item[Binomické] gaussovo/normální v diskrétním prostoru
	\end{description}
	\item[Spojitá] \hfill
	\begin{description}
		\item[Rovnoměrné] $f(x) = \frac{1}{b-a}$ pro $x \in <a,b>$
		\item[Exponenciální]
		\item[Normální/Gaussovo]
		\item[Pearsonovo]
	\end{description}
\end{description}

Generátor rovnoměrného rozložení, transformace na jiné rozložení.

Fyzikální -- Algoritmické -- Kongruentní generátory: $x_{n+1} = (ax_n+b)\pmod m$

\paragraph{Transforamce}
\begin{itemize}
	\item Inverzní transforamce -- inverzní distribuční funkce
	\item Vylučovací -- nevhodná pro neomezené. Určí náhodný bod a pokud je pod křivkou, vrátí výsledné X
	\item Kompoziční -- složení pravděpodobnosti na různých intervalech
\end{itemize}

\subsection{Monte Carlo}

experimentální numerická simulační metoda. Řeší úlohy experimentováním, pseudonáhodná čísla, není příliš přesná. Chyba: $err = \frac{1}{\sqrt{N}}$, kde $N$ je počet pokusů.

Např. Vícerozměrné integrály, Directelova úloha -- náhodná procházka.

\section{Diskrétní simulace}

program, petriho sítě, automaty, $\pi$-kalkul

\begin{description}
	\item[Proces] posloupnost událostí
	\item[Paralelní procesy] procesy prováděné souběžně
	\item[Kvaziparalelismus] současné provádění procesů na jednoprocesorovém systému
\end{description}

\subsection{Petriho síť P/T}
$\Sigma = (P, T, F, W, C, N_0)$, kde
\begin{itemize}
	\item $P$ množina míst
	\item $T$ množina přechodů 
	\item $F \subseteq (P \times T) \cup (T \times P)$ incidenční funkce -- orientované hrany mezi stavy a přechody a naopak
	\item $W : F \to \{1, 2, \dots \}$ Váhová funkce
	\item $C : P \to N$ Kapacity míst
	\item $N_0: P \to N$ Počáteční značení míst
\end{itemize}

$N$ značí stav Petriho sítě.

Přechod je proveditelný, když ve vstupních místech čeká dostatek procesů a současně ve výstupních místech je dostatečná volná kapacita

\paragraph{Stochastické PN (SPN)} Mohou modelovat paralelizmus, komunikaci procesů, synchronizaci a nedeterminismus (priority, pravděpodobnosti, doby přechodů. Okamžitý přechod má prioritu před časovaným).

\subsection{SHO -- Systémy hromadné obsluhy}

systémy obsahující zařízení s frontami, ve kterých čekají transakce.

transakce a popis jejich příchodu do systémy

obslužné linky a popis jejich obsluhy.

Cílem optimalizovat výkon, odhalit zdržení. 

Stochastický proces příchodů -- intenzita příchodů požadavků -- Poissonovo rozdělení. Doba mezi příchody -- Exponenciální.

\paragraph{Fronty} řazení, výběr procesu, maximální délka (FIFO, LIFO, SIRO), Možnost netrpělivých požadavků (time-out).

Prioritní fronty
\begin{itemize}
	\item Slabá priorita -- započatá obsluha
	\item Silná priorita -- obsluha se přeruší (porucha)
	\item Požadavek si vybere frontu
	\item Společná fronta pro více obslužných linek
\end{itemize}

Obslužná síť -- několik obslužných linek. Otevřená -- otevřená -- smíšená.

Kendallova klasifikace SHO: X/Y/c
\begin{itemize}
	\item X -- typ stochastického procesu příchodu
	\item Y -- zákon rozložení délky obsluhy
	\item c -- počet dostupných linek
\end{itemize}

Typy obslužných linek: Sklad $>$ 1, Zařízení = 1

\subsection{Algoritmus diskrétní simulace}

Kalendář: uspořádaná datová struktura obsahující aktivační záznamy budoucích událostí (aktivační čas, priorita, událost

\begin{enumerate}
	\item Inicializace
	\item dokud kalendář není prázdný
	\begin{enumerate}
		\item Vyjmi první záznam z kalendáře
		\item if aktivační čas události $>$ čas konce then Ukonči simulaci
		\item Nastav čas na aktivační čas události
		\item Proveď popis chování události
	\end{enumerate}
\end{enumerate}

\section{Spojitá simulace}

Elektrické obvody, automatizace, fyzika, chemie

Popis: Soustavy rovnic, bloková schémata, elektrická schémata.

Rovnice vyšších řádů je třeba převést na nižší:
\begin{itemize}
	\item Snižování řádu derivace -- blokové schéma, počáteční podmínky
	\item Postupná integrace
\end{itemize}

\subsection{Numerické metody}

Řešení diferenciální rovnice prvního řádu: $y' = f(x,y)$ ve tvaru $y(T) = y_0 + \int_0^T f(t,y)dt$

Integrační krok: $h$

Metody: Jednokrokové $\times$ Vícekrokové (používají historii stavů), Explicitní $\times$ Implicitní
\begin{description}
	\item[Jednokrokové] \hfill
	\begin{description}
		\item[Eulerova metoda] = RK1
		
		$y(t+h) = y(t) + h f(x, y(t) )$
		\item[Runge Kutta 2. řádu] \hfill

		$k_1 = hf(t, y(t))$\\
		$k_2 = hf(t + h/2, y(t) + k_1/2)$\\
		$y(t+h) = y(t) + k_2$
	\end{description}
	\item[Vícekrokové metody] Uchovávají hodnoty z minulých kroků pro výpočet dalšího (Problém start metod)
	\begin{description}
		\item[Adams-Bashforth] prediktor, korektor. Vážený průměr minulých
	\end{description}
\end{description}

\paragraph{Chyba}
Lokální (zaokrouhlovací + aproximační) $\times$ Akumulovaná

Stabilita, vliv velikosti kroku na přesnost, nespojitosti snižují efektivitu

\emph{Tuhé systémy} -- velmi rozdílné časové konstanty

Nejlepší bývá nějaká z RK, záleží na aplikaci.

\subsection{Algoritmus spojité simulace}
\begin{enumerate}
	\item Inicializace
	\item Dokud není konec simulace
	\begin{enumerate}
		\item Pokud vhodný čas, výstup
		\item Vyhodnocení derivací a výpočet nového stavu
		\item Posun modelovaného času
	\end{enumerate}
	\item Ukončení, výstup
\end{enumerate}

Funkční bloky by měly být v kódu řazeny pomocí topologického řazení.

Rychlé smyčky v grafu je třeba rozpojit a řešit iteračně algebraické rovnice.

Nástroje: Matlab, Dymola, Modelica

\section{Kombinovaná simulace}
spojitá + diskrétní + propojení

\subsection{Stavové podmínky}
Při dosažení zadané hodnoty spojité veličiny je vyvolána stavová událost -- hledání např. pomocí regula falsi, nebo Newtonovy metody -- např. dopad míčku na zem.

\subsection{Algoritmus}
\lstset{caption={Algoritmus kombinované simulace}}
\begin{lstlisting}
Inicializace stavu a podminek
while cas < konec  do
	uloz stav a cas
	krok numericke integrace a posun casu
	vyhodnoceni podminek
	if podminka zmenena then
		if krok <= minimalni krok then
			potvrd zmenu podminek
			stavova udalost
			krok = bezna delka kroku
		else
			obnova stavu a casu
			krok = krok / 2
			if krok < minimalni krok then
				krok = minimalni_krok
\end{lstlisting}
Umístit do algoritmu pro diskrétní simulaci místo Time = čas další události.

\section{Simulace číslicových obvodů}

Úrovně popisu: Elektrická, Logická, Meziregistrové přenosy, Systémová sběrnice

Specializované jazyky pro popis a simulaci (VHDL, Verilog)

\emph{Modely signálů} -- Dvouhodnotové, Tříhodnotové (X), Pětihodnotové (Rise, Fall). Dále může být Z = Vysoké impedance, statický a dynamický hazard

\emph{Zpoždění} 0, 1, přiřaditelné, přesné.

\subsection{Algoritmus}

\lstset{caption={Algoritmus číslicových obvodů}}
\begin{lstlisting}
inicializace, planovani udalosti pro novy vstup
while( planovana udalost ) do
	nastav hodnotu modeloveho casu na T
	for (u in vsechny planovane udalosti na cas T) do
		vyber zaznam udalosti z kalendare
		aktualizuj hodnoty signalu
		pridej vsechny pripojene prvky do mnoziny M
	for (p in M) do
		vyhodnoceni prvku p
		if (zmena jeho vystupu) then
			planovani nove udalosti
\end{lstlisting}

Simulace poruch: trvalá 1, trvalá 0, zkrat.





























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{chapter}{26}
\chapter{Vyhledávání a řazení} \label{cha:27}

3. semestr, IAL, 7. - 11. přednáška

\section{Vyhledávání}

přístupová doba, minimální/maximální doba vyhledání, doba úspěšného/neúspěšného vyhledání.

Klasifikace: Tabulka s přímým přístupem $\times$ tabulka se sekvenčním přístupem.

\subsection{Sekvenční vyhledávání v neseřazeném poli}

Nad prvkem klíč relace rovnosti.

\begin{itemize}
	\item Vkládání: Přepsání prvku se stejným klíčem, nebo vložení na konec
	\item Odstranění: přepsání poslední prvkem a zkrácení pole.
\end{itemize}

\subsection{Vyhledávání se zarážkou}

Hledaný prvek umístěn na konec pole, vynechán test na konec pole. Vyšší rychlost vyhledání. Pokud najdeme zarážku, prvek neexistuje.

\subsection{Sekvenční vyhledávání v seřazeném poli}

Nad prvkem klíč musí být definována relace uspořádání. Urychluje čas neúspěšného vyhledání. Operace insert a delete musí posouvat všechny prvky vpravo od vkládaného/odstraňovaného.

\subsection{Vyhledávání v poli seřazeném podle četnosti vyhledávání}

Občasné seřazení podle počítadla vyhledání. Nebo adaptivní (pokud je prvek vyhledán a není první, vyměň jej s jeho levým sousedem).

\subsection{Binární vyhledávání}

Nad seřazeným polem, půlení intervalů. Logaritmická časová složitost

\subsection{Dijkstrova varianta binárního vyhledávání (pro účely řazení)}

V poli může být více položek se stejným klíčem, je potřeba nálézt například poslední.
\lstset{caption={},language=Pascal}
\begin{lstlisting}
while right <> (left+1) do begin
	middle := (left + right) div 2;
	if Tab[middle].Klic <= K then
		left := middle
	else
		right := middle;
	end
Search := K = Tab[left].Klic;
\end{lstlisting}

\subsection{Uniformní binární vyhledávání a Fibonacciho metoda}

určení hranic intervalu odchylkou od středu -- vyhneme se dělení. Na dané úrovni uniformní, můžeme předpočítat. Různé odchylky pro různý počet prvků

\paragraph{Sharova metoda}
První vyhledání na největší celé mocnině dvou menší než N, pokud v levé části, pokračujeme, jinak zvolíme transformaci na stejnou velikost pravé části.

\paragraph{Fibonacciho metoda}
založená na binárním vyhledávacím stromu, uzel řádu [0]: levý podstrom 0, pravý 1. Jinak uzel řádu [n]: levý podstrom řádu n-1 a pravý řádu n-2.

\subsection{Binární vyhledávací strom (BVS)}
kořenový strom, pro jehož každý uzel platí, že n-tice kořenů je uspořádaná. Pro každý uzel platí, že levý podstrom obsahuje uzly s menší hodnotou a pravý podstrom obsahuje uzly s vyšší hodnotou (nebo jsou prázdné).

Inorder průchod -- seřazená posloupnost.

\begin{itemize}
	\item Vyhledávání: Podobné binárnímu -- uzel = hledaný $\to$ úspěch, menší $\to$ levý podstrom, větší $\to$ pravý podstrom, prázdný podstrom $\to$ neúspěch.
	\item Vkládání: Aktualizační sémantika -- pokud uzel existuje, přepíše hodnotu. Jinak vkládat se zachováním sémantiky
	\item Odstranění: List smazat, Jeden syn: přemostit. Dva synové:
	\begin{itemize}
		\item Levý podstrom připojíme na nejlevější podstrom pravého podstromu nebo naopak
		\item Hodnotu přepíšeme nejpravějším uzlem levého podstromu a ten odstraníme (nebo obráceně)
	\end{itemize}
\end{itemize}

\subsection{Binární vyhledávání se zarážkou}

Pomocný uzel, do kterého vedou všechny ukazatele (místo Nil).

\subsection{BVS se zpětnými ukazateli}
Lze provést inorder průchod bez zásobníku nebo rekurze.

levý syn ukazuje na otce, pravý syn dědí ukazatel od otce. Kořen ukazuje na nil. Při odstranění uzlu je potřeba oprava uzlů na pravé diagonále levého podstromu.

\subsection{AVL stromy}
Výškově vyvážené binární stromy, výška každého je stejná nebo o 1 různá pro každý uzel podstromu.

Při odstranění nebo vkládání do nejvzdálenějšího uzlu od kořene je porušena rovnováha. Řešení je Rotace: LL, nebo DLR.

\subsection{Tabulky s přímým přístupem}

Množina klíčů tabulky jednoznačně mapována na množinu sousedních míst v paměti. Časová složitost vyhledání je 1. Problémem je nalezení vhodné mapovací funkce.

\paragraph{Mapovací funkce}

Dva klíč jsou mapovány do stejného místa paměti (=synonyma). Vzniká kolize. Je třeba zvolit takovou s minimem kolizí a dobrou rychlostí.

Dvě etapy -- převod klíče na přirozené číslo, modulo velikostí tabulky (mělo by být prvočíslo). $h(K) = K \bmod Max + 1$

\paragraph{Zřetězení}
\begin{itemize}
	\item Explicitní -- prvek obsahuje adresu následovníka (zřetězené seznamy)
	\item Implicitní -- adresa je funkcí adresy předchůdce (konstantní nebo proměnný krok)
\end{itemize}

\paragraph{TRP -- Tabulka s rozptýlenými položkami}
mapovací prostor je pole + seznam synonym (zřetězený). Indexsekvenční vyhledávání (index do pole a sekvenční průchod zřetězeným seznamem).

Implicitní řazení synonym -- druhá kolizní funkce. Například kvadratická metoda, která zvětšuje krok o 1 s každým krokem.

\paragraph{TRP s dvojí rozptylovací funkcí}
krok určen programem, pole 0..Max
\begin{itemize}
	\item 1. rozptylová funkce: hodnota do pole: 0..Max
	\item 2. rozptylová funkce: krok: 1..Max
\end{itemize}

Vyhledání, Insert, kapacita o 1 menší, 1 prvek musí být jako zarážka vyhledávání.

Implicitní zřetězení s používá v systémech, kde se nepoužívá delete.

\paragraph{Brentova varianta}
TRP se dvěma rozptylovými funkcemi. Při vkládání probíhá rekonfigurace pro lepší dobu vyhledávání.


\section{Řazení}
řazení prováděné tříděním -- nejdříve roztřídit podle sloupce s nejnižší prioritou, postupně až nejvyšší. Potom seřazeno.

\begin{description}
	\item[Uspořádání podle klíčů] seřazení podle uspořádané množiny klíčů
	\item[Řazení] uspořádání podle relace lineárního uspořádání nad klíči
	\item[Slučování] Vytváření souboru položek položek sjednocením několika souborů stejného typu
	\item[Setřídění] Vytvoření souboru setříděných položek sjednocením několika seřazených souborů položek téhož typu
	\item[Sekvenční řazení] sekvenční přístup k prvkům
\end{description}

\paragraph{Vlastnosti metod}
\begin{itemize}
	\item Přirozenost: doba seřazení náhodně uspořádaného je větší než doba seřazení uspořádaného souboru a menší než doba seřazení opačně uspořádaného souboru.
	\item Stabilita: zachování relativního pořadí klíčů se stejnou hodnotou. Důležité pro řazení podle více klíčů v několika průchodech (třeba tříděním)
\end{itemize}

\subsection{Řazení podle více klíčů}
\begin{itemize}
	\item Složené relace uspořádání (porovnávat v jednom kroku více klíčů)
	\item Řadit postupně podle narůstající priority klíčů (stabilní metoda)
	\item Aglomerovaný klíč, například string, na kterém je definována relace uspořádání.
\end{itemize}

\subsection{Řazení polí bez přesunu položek}
K poli je potřeba vytvořit pořadník (inicializovat hodnotami s indexem), výsledkem je seřazený pořadník.

Výsledek lze převést do cílového pole, nebo zřetězit.

\paragraph{MacLarenův algoritmus}
uspořádání pole na místě (seřazené bez přesunu).

První prvek se vymění s prvkem, který má být na indexu 1, opraví se ukazatele pro prvek, který na něj ukazuje.

\begin{lstlisting}
i := 1;
Pom := Prvni;
while i < Max do begin
	while Pom < i do Pom := Pole[Pom].Uk;
	Pole[i] :=: Pole[Pom];
	Pole[i].Uk :=: Pom;
	i := i + 1;
	end
\end{lstlisting}

\subsection{Klasifikace metod}
\begin{description}
	\item[Podle přístupu k paměti] \hfill
	\begin{description}
		\item[Vnitřní] Pole, náhodný přístup
		\item[Vnější] Soubory, sekvenční přístup
	\end{description}
	\item[Podle procesoru] \hfill
	\begin{description}
		\item[Sériové] Jeden procesor
		\item[Paralelní] Více procesorů
	\end{description}
	\item[Podle principu] \hfill
	\begin{description}
		\item[Výběr] Určení extrému a umístění
		\item[Vkládání] Prvek v neseřazené posloupnosti zařazujeme do seřazené
		\item[Rozdělování] Rozdělujeme problém na podproblémy, často dělíme množinu na podmnožiny
		\item[Slučování] Setřiďují setříděné podmnožiny
	\end{description}
\end{description}

\subsection{Select sort}
Vyhledání minimálního prvku v posloupnosti a výměna s prvkem na začátku neseřazené posloupnosti, dokud není celé setříděno.

Nestabilní, Nepřirozené, Kvadratická časová složitost $O(n^2)$

\subsection{Bubble sort}
Porovnává se každá sousední dvojice v celém poli a pokud je špatně seřazena, prvky se vymění. Tím se dostane největší prvek na konec. Opakuje se dokud není celá posloupnost setříděná.

\begin{description}
	\item[Ripple sort] Pamatuje si index první výměny, od kterého má smysl v další iteraci pokračovat
	\item[Shaker sort] Střídá směr prohledávání
	\item[Shuttle sort] Pří výměně zavádí menší prvek do seřazené posloupnosti.
\end{description}

Stabilní, přirozený, kvadratická časová složitost.

\subsection{Heap sort}

Binární strom, implementován polem (otec i, synové 2i, 2i+1), relace uspořádání k synům (otec menší než oba synové) platí pro všechny uzly.

Sift down -- znovuustavení hromady, prosetí.

Nestabilní, nepřirozený, Linearitmetická časová složitost.

\subsection{Insert sort}
Zařaď aktuální prvek do seřazené posloupnosti (Najdi pozici, posuň všechny až do konce neseřazené posloupnosti, vlož aktuální na danou pozici).

Stabilní, přirozený, kvadratická časová složitost.

\subsection{Bubble-Insert sort}
Postupné zařazování prvku na pozici i do setříděné posloupnosti vlevo. V cyklu kombinuje hledání pozice a posouvání vpravo.

Stabilní, přirozený, kvadratická časová složitost.

\subsection{Vkládání s binárním vyhledáváním}

Insert sort s použitím binárního vyhledávání v setříděné části.

Stabilní, přirozený, kvadratická časová složitost, na místě.

\subsection{Quicksort}

Rozděl na dvě části, podle hodnoty středového prvku (měl by být medián, ale ten nelze získat rychle a tak stačí pseudomedián -- číslo ve středu) podle velikosti. Toto pravidlo rekurzivně aplikuj na obě části, dokud tato část obsahuje více než jeden prvek.

\begin{lstlisting}
procedure QuickSort(var A:TArr; left, right:integer);
(* Pri volani ma left hodnotu 1 a right hodnotu N *)
var i,j:integer;
begin
	Partition(A,left,right,i,j);
	if left<j then QuickSort(A, left, j); (* Rekurze doleva *)
	if i<right then QuickSort(A, i, right); (* Rekurze doprava *)
end;
\end{lstlisting}

Nejrychlejší, nestabilní, nepřirozený, linearitmická časové složitost ($O(n \log{n})$).

\subsection{Shell sort}

Opakované průchody podobné bublinkovému řazení s pevným krokem. Opakuje se od \verb|N div 2|, snižuje se \verb|krok := krok div 2| až po krok 1 (bubble sort).

Nestabilní, přirozený, na místě, bez rekurze a zásobníku, pomalejší než Quicksort.

\subsection{Merge sort}

Postupujeme v poli zleva a zprava, hledáme neklesající posloupnosti a tyto slučujeme do druhého pole. Tzv. houpačkový mechanismus.

Potenciálně stabilní a přirozený, není na místě, asymptotická (linearitmická) časová složitost.

\subsection{List-Merge sort} setřiďování seznamů bez přesunu položek (Dále lze zpracovat MacLarenovým algoritmem). Postupné setřiďování dvojic neklesajících posloupností.

Potenciálně stabilní, přirozený, linearitmetická časová složitost.

\subsection{Radix sort}

Řazení tříděním podle základu. Podobně řazení děrných štítků. Třídění podle nejnižšího řádu, poté dáme dohromady a pokračujeme s dalším řádem.

Stabilní, Nepřirozená, Lineární časová složitost $O(n)$.

\subsection{Přímé setřiďování souborů}

Distribuce n-tic od 1 do N a jejich setřiďování.

Stabilní, Nepřirozený, $log_2 N$ setřiďovacích fází.

\subsection{Přirozené setřiďování}

Distribuce neklesajících posloupností a jejich setřiďování, dokud není jen jedna neklesající posloupnost.

Stabilní, Přirozený, $log_2 n$ setřiďovacích fází, kde n je počet neklesajících posloupností.

\subsection{Přirozená čtyřpásková metoda}

Ušetření fáze distribuce za cenu další pásky (2 pásky vstupní, 2 pásky výstupní).

\subsection{Mnohacestné vyvážené setřiďování}

Generalizace předchozí metody pro 2k pásek.

\subsection{Polyfázové setřiďování}

Ušetření pásek s výkonem srovnatelným s minulou metodou. Pouze k+1 pásek, vždy jedna výstupní, počet neklesajících posloupností by měl být rozdělen mezi vstupní pásky v poměru fibbonacciho posloupnosti k-tého řádu, ve chvíli kdy se jedna páska vyprázdní, stane se z ní výstupní.

























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{chapter}{29}
\chapter{Životní cyklus softwaru} \label{cha:30}

1. semestr, IUS, přednášky

(charakteristika etap a základních modelů)

\subsection{Softwarové inženýrství}
Systematický přístup k vývoji, nasazení a údržbě software.

Disciplína zabývající se praktickými problémy vývoje rozsáhlejších SW projektů.

Důvodem je zlepšení vlastností SW (SW je všudypřítomný), zlepšení spolehlivosti, bezpečnosti, použitelnosti.

\paragraph{Kvalita} Čas $\times$ Cena $\times$ Splnění požadavků

\subsection{Vývoj}
\paragraph{60. léta} Strukturované programování, neúnosné prodlužování projektů.

\paragraph{70. léta} Metoda shora dolů (rozklad problémů na podproblémy), programování v týmech, metodologie (analýza a návrh důležitější), ADT

\paragraph{80. léta} Vývojová prostředí, IDE, objektová orientace, důležitější nasazení a údržba SW

\paragraph{90. léta} Prototypování, znovupoužitelnost, OOP, Java, OO specifikace a návrh, opensource, využití internetu, distribuovaný vývoj i využití SW

UML, formální techniky pro analýzu a verifikaci systémů, důraz na podporu zákazníků, servis a údržbu. Metody návrhu založené na modelech.

\subsection{Cíle}
\paragraph{Management projektu} řízení životního cyklu , efektivní práce s časem a zdroji.

\paragraph{Techniky} Analýza, návrh, programování, testování

\paragraph{Vlastnosti SW inženýra} Báze znalostí, schopnost je aplikovat, schopnost získávat nové.

\subsection{SW}
\begin{description}
	\item[Generický] Libovolný zájemce, dobře otestované (opravy drahé), krabicový SW
	\item[Zákaznické] Na objednávku, specializované aplikace, většinou vyšší cena
\end{description}

\subsection{Vlastnosti SW}
\begin{description}
	\item[Použití] \hfill
	\begin{description}
		\item[Správnost] splnění specifikace
		\item[Spolehlivost] pravděpodobnost, že SW bude v daném čase vykonávat zamýšlenou funkci
		\item[Efektivnost] využití zdrojů, využití nákladů na vývoj
		\item[Použitelnost] úsilí, které je potřeba vynaložit na to, aby se dal používat
		\item[Bezpečnost] míra odolnosti proti neoprávněným zásahům do systému
	\end{description}
	\item[Přenos] \hfill
	\begin{description}
		\item[Přenositelnost] úsilí, které je potřeba vynaložit pro přenos na jinou platformu
		\item[Znovupoužitelnost] jednotlivých částí
		\item[Interoperabilita] úsilí pro zajištění spolupráce s jinými systémy
	\end{description}
	\item[Změny] \hfill
	\begin{description}
		\item[Udržovatelnost] úsilí, které je potřeba vynaložit na další vývoj, podle měnících se potřeb
		\item[Testovatelnost] úsilí nutní pro testování
		\item[Dokumentovanost] míra, do které jsou všechna rozhodnutí při vývoji dokumentována
	\end{description}
\end{description}

\subsection{Problémy vývoje SW} Nevyhnutelné: Složitost, Přizpůsobivost, Nestálost

\paragraph{Problémy, které se nemusí projevit vždy}
\begin{itemize}
	\item Specifikace požadavků (nejasná, neúplná, plánování)
	\item Náchylnost SW k chybám
	\item Práce v týmu -- organizace, plánování, komunikace, výkonost
	\item Nízká znovupoužitelnost
	\item Tvorba dokumentace -- konzistence, úplnost
	\item Stárnutí SW -- přidávání nové funkcionality degraduje struktury (a přidává další chyby).
\end{itemize}

\paragraph{Validace} ověření, zda model/specifikace odpovídá skutečným potřebám
\paragraph{Metodologie} zabývá se tvorbou a aplikací metod
\paragraph{Metodika} souhrn doporučených praktik a postupů (automatizované SW inženýrství, modelování procesů, datové modelování, modelovací jazyky, \emph{proces vývoje software}, řízení

\section{Proces vývoje software}

Potřeby uživatele $\Rightarrow$ Požadavky na SW $\Rightarrow$ Návrh $\Rightarrow$ Implementace $\Rightarrow$ Testování $\Rightarrow$ Předání uživateli

Určení kdo co kdy a jak bude dělat.

\paragraph{Životní cyklus} rozděluje proces vývoje SW na, za sebou jdoucí, etapy s cílem. Existují různé metodické přístupy.

\subsection{Analýza a specifikace požadavků}
Identifikace požadavků uživatele na systém, transformace neformálních do strukturovaných, studium vhodnosti, identifikace a analýza rizik, plánování akceptačního testování.

\subsection{Architektonický návrh}
Koncepce systému, dekompozice, vztahy, funkcionalita a ohraničení podsystémů (nezávislý vývoj, pozornost pouze na část problému), plánování testování a nasazení systému (rozhraní podsystému).

\subsection{Podrobná návrh}
Podrobná specifikace SW součástí, algoritmů, rozhraní, způsobu ošetření chybových a neočekávaných stavů. Plán prací při implementaci, plán testování, návrh testovacích dat. Specifikace požadavků na lidské zdroje

\subsection{Implementace a testování součástí}
Programová realizace SW součástí, dokumentace, testování součástí, začátek zaškolování uživatelů.

\subsection{Implementace a testování systému}
Spojení součástí do podsystémů, integrace podsystémů do systému, testování, opravy, návraty k implementaci součástí.

\subsection{Akceptační testování systému} Testování uživatelem, přebírání, školení uživatelů, nasazení.

\subsection{Provoz a údržba}
Zabezpečení provozu SW, řešení problémů s nasazením a používáním, opravy, rozšiřování, přizpůsobení SW podle požadavků

\subsection{Role}
\begin{description}
	\item[Zákazník] Sponzoruje vývoj, specifikuje požadavky
	\item[Dodavatel] Vyvíjí systém, komunikuje s uživatelem, má závazky vůči zákazníkovi
	\item[Uživatel] Používá systém, testuje, upřesňuje požadavky
\end{description}

\section{Modely životního cyklu SW}
Určují etapy, časovou následnost, činnost, vstupy a výstupy etap

\subsection{Lineární (sekvenční) modely} Postupně od první etapy po poslední

\paragraph{Vodopádový model} následující etapa začíná až po dokončení předchozí, existuje možnost návratu k předchozí etapě.

Lineární, oblíbený v 70. letech. Dobré výsledky, struktura pro stálé požadavky. Uživatel se účastní pouze definice požadavků a nasazení systému.

\paragraph{V-model} větší důraz na testování. Každá etapa je v jiné etapě otestována.

\subsection{Iterativní modely}
Sekvence etap (vodopád) se v cyklu opakuje. Více iterací, v každé iteraci vzniká reálný výsledek, který může zákazník validovat. Náročnější na řízení, potenciálně horší struktura se změnami požadavků.

\subsection{Prototypování} bývá součástí jiných modelů a metodik. Částečná implementace, většinou vnějšího rozhraní, kterou může zákazník schválit.

\subsection{Inkrementální model}
Kombinace lineárního a iterativního. Stanovení ucelených částí, pro každou se aplikuje vodopád, postupné předávání uživateli, jednodušší změny během vývoje. Důležitost dobře specifikovaných rozhraní podsystémů.

\subsection{Spirálový model}
Prototypování a analýza rizik, jednotlivé kroky se opakují na vyšší úrovni zvládnuté problematiky. Vyžaduje stálou spolupráci zákazníka.

\subsection{RAD -- Rapid application development}

Rychlý iterativní vývoj prototypů. Co nejdříve nějaká funkční verze, intenzivní zapojení zákazníka.

Priorita plnění business požadavků, inženýrské a technologické kvality mají nižší priritu.

\subsection{RUP -- Rational Unified Process}

\paragraph{6 základních praktik}
\begin{itemize}
	\item Využívání existujících komponent
	\item Verze, Iterační způsob vývoje
	\item Model systému vizualizován -- UML
	\item Průběžná kontrola kvality kódu -- objektivní měření, metriky
	\item Správa požadavků na systém -- umění získat od zákazníka
	\item Řízen změn v systému -- sledovatelnost, přijatelnost
\end{itemize}

Jednotlivé etapy vývoje se překrývají.

Další metodiky jsou modfifikované verze vodopádu, nebo agilní metodiky.

\subsection{Role}
\begin{description}
	\item[Programátor] návrh technického řešení, implementace, ladění, předem daný cíl
	\item[Analytik] vytvářejí cíle projektu, zpracovávají specifikační dokumenty, diplomatické vztahy se zákazníkem.
\end{description}

\section{Analýza a specifikace požadavků (8\% času)}

\emph{Cíl}: Stanovení služeb, které zákazník od systému požaduje a vymezení podmínek jeho vývoje a provozu.

\paragraph{Požadavky}
\begin{itemize}
	\item Funkcionální
	\item Na provoz systému -- statické (počet uživatelů), dynamické (požadovaná odezva)
	\item Na výsledný systém -- počítačové, programové vybavení
	\item Vývojový proces -- normy, odevzdání
	\item Rozhraní -- uživatelské, s jinými systémy
	\item Externí -- legislativa
\end{itemize}

Požadavek -- Přijatý -- Zrušený / Akceptovaný -- Řešený -- Ukončený.

Specifikace musí být detailní -- pro SW vývojáře.

\paragraph{metody získávání informací}
interview, dotazníky, studium dokumentů, pozorování prací u zákazníka, přímá účast na pracích u zákazníka, analýza existujícího SW.

\paragraph{Problémy} různorodost požadavů, komunikace se zákazníkem, přirozený jazyk nejednoznačný

\section{Implementace SW}

Transformace návrhu jednotlivých podsystémů a jejich vzájemných vazeb do programové realizace.

Kritéria: srozumitelnost, čitelnost, udržovatelnost, efektivnost (aplikace, procesu vývoje), přenositelnost.

Důležité jsou jasné cíle.

S 4GL (jazyky 4. generace -- oop) se časový podíl implementace snižuje (IDE, vizuální programování).

\paragraph{Správa verzí} inteligentní sdílení, zálohování -- SVN, CVS, GIT

\subsection{Strategie}
\begin{description}
	\item[Zdola nahoru] systém lze předvádět až po úplném dokončení, testování samostatných částí je jednodušší, chyby v logice systému se odhalí až nakonec.
	\item[Shora dolů] možnost demonstrovat již brzy, potřeba simulovat podsystémy pro testování.
\end{description}
Používá se kombinace obou přístupů.

\subsection{Dokumentace}
\begin{description}
	\item[Interní] Slouží k opravě chyb, údržbě
	\item[Externí] Popisy problémů, algoritmy, oprostěná od programu
	\item[Hlavičky souborů]
	\item[Komentáře v kódu] nestandardní, neočekávané obraty, algoritmy.
\end{description}

\section{Validace a verifikace programu}

Validace = správný výrobek?, verifikace = správně udělaný?

Má odhalit chyby během vývoje a prokázat požadované vlastnosti.

\begin{description}
	\item[Statické] Není potřeba běh programu, formální nebo neformální, matematická verifikace
	\item[Dynamické] vybrat vstupy u kterých je pravděpodobné, že by mohly mít chybné výstupy
\end{description}

\section{Agilní metodiky}

\paragraph{Metodika} disciplinovaný proces nad vývojem SW s cílem zajistit tento vývoj více predikovatelná a efektivní

Problém heavyweight metod je příliš mnoho byrokracie (předepsané aktivity a dokumentace). Agilní metodiky přináší kompromis pro menší projekty a týmy (decentralizace, vyšší orientace na lidi).

U většiny projektů lze těžko predikovat proces vývoje, protože nejsou fixní požadavky. Agilní metodiky používají iterativní přístup, který umožňuje plán přizpůsobit a zpřesňovat.

\begin{description}
	\item[Process-oriented] lidé jsou zdroje (nahraditelné, pevné role), dokumentace je komunikační prostředek.
	
	Fixní funkcionalita a kvalita $\Rightarrow$ Variabilní cena a čas
	\item[People-oriented] důležitá je kvalita lidí (těžko nahraditelní), osobní rozvoj, role se může měnit. Hlavní komunikační prostředek je osobní komunikace.
	
	Fixní cena a čas $\Rightarrow$ Variabilní funkcionalita a kvalita.
	
	Rychle vyvinout a na základě zpětné vazby upravovat.
\end{description}

\subsection{Extreme programming (XP)}
\begin{description}
	\item[Komunikace] programátoři, manažeři, zákazník
	\item[Zpětná vazba] snaha mít co nejdříve nejdůležitější části v provozu
	\item[Jednoduchost] jednoduché věci dělat jednoduše (dají se rozšířit)
	\item[Odvaha] zahodit kód, zkosit namáhavé, zásadní změny
	\item[(Malé) přírustkové změny] uvolnění malých verzí systému často
	\item[Testování] Automatizované, ke každé funkci, psané dříve než kód
	\item[Párové programování] jeden píše, druhý sleduje, přemýšlí o kódu, u jednoho PC
	\item[Refaktorizace] zjednodušení, změna architektury
\end{description}

Jednotlivé iterace mají 1-4 týdny. V první se definují základy v dalších se rozšiřují.

\subsection{Crystal}
Základní principy XP, není tak přísně disciplinovaný (použitelný pro více lidí).

\subsection{Scrum}
Iterace má 30 dní, na začátku se stanoví požadavky, každý den 15 minut setkání a zhodnocení co se udělalo, co se má udělat a jaké problémy nastaly.

Může se kombinovat s praktikami XP.

\subsection{RUP}
Lze použít i jako agilní metodiku.

\section{Analýza a návrh}

\subsection{Strukturovaná}
Modely konceptuální, logické a fyzické

Funkční modelování, minispecifikace. Datové modelování: ERD, STD

\subsection{Objektový}
Kolekce vzájemně komunikujících objektů.

Analýza a návrh zahrnuje prostředky + metodiky. Obecně vyšší stabilita pro měnící se požadavky.

Zapouzdření Data -- Metody -- Protokol.

Abstrakce, zapouzdření, polymorfizmus, dědičnost.

Třídní přístup -- objekty klasifikovány do tříd. Operace s objekty jsou implementovány metodami.

Identita a shoda objektů.



































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Jazyk UML} \label{cha:31}

1. semestr, IUS, zbývající přednášky

\section{UML}
Unified Modelling language -- základ od RUP, inspirován existujícími analytickými jazyky a modely. Základem je \emph{diagram tříd}.

\begin{description}
	\item[Statický model (struktura)] \hfill
	\begin{itemize}
		\item Diagram tříd
		\item Diagram komponent
		\item Diagram nasazení
	\end{itemize}
	\item[Dynamický model (chování)] \hfill
	\begin{itemize}
		\item Objektový diagram
		\item Diagram případů užití (1) Požadavky
		\item Sekvenční diagram
		\item Diagram spolupráce
		\item Stavový diagram (3) Návrh
		\item Diagram aktivit (2) Analýza
	\end{itemize}
\end{description}

\subsection{Analýza}

\paragraph{Analytické třídy}
mapují problémové domény na abstraktní entity modelu. Jen nejpodstatnější atributy, operace, množiny odpovědnosti a vazby.

\paragraph{Objektové diagramy}
objekty a jejich relace v určitém čase (dynamické)

\paragraph{Analytické balíčky}
seskupení sémantiky souvisejících elementů, zapouzdření prostoru jmen.

Obsahují: Use Case, Analytické třídy, Realizace případů užití a další.

\paragraph{Diagram interakce: Diagram spolupráce}
Strukturální relace mezi objekty a spolupráce při plnění úkolu.

\paragraph{Diagram interakce: Sekvenční diagramy}
interakce objektů vzhledem k času. Každý objekt má vlastní časovou osu a předává řízení jiným objektům. Mohou být omezení.

\subsection{Návrh}
Upřesňování analytických diagramů, realizace případů užití.

\paragraph{Návrhové třídy}
lze je přímo implementovat, využití tříd doménového řešení (GUI, knihovny). Upřesnění analytických tříd.

\paragraph{Stavové diagramy}
Stavové automaty (diagramy aktivit). Modelují životní cyklus jednoho reaktivního objektu (řada stavů, přechodů a událostí). Stavy mohou být složené, obsahovat události, podmínky ...


\section{Diagram tříd}
Zobrazení tříd a statických vztahů mezi nimi.

Přepisování (overwriting) -- dědičnost, náhrada metody v podřazené třídě\\
Přetěžování (overriding) -- vícenásobná definice operace (např. různé parametry).

\subsection{Vztahy}
\begin{description}
	\item[Asociace] zachycuje vztah tříd z různých perspektiv (násobnosti, název). Může být povýšena na asociační třídu.
	\begin{description}
		\item[Agregace] seskupení, celek je složen z více částí (stejná třída)
		\item[Kompozice] seskupení, celek je složen z více částí (různé třídu). Implicitní násobnost 1
		\item[Závislost] pomocí stereotypů, nebo speciální. Např. \verb|<<use>>|
	\end{description}
	\item[Realizace] vztah mezi třídou a nadtřídou (generalizace/specifikace)
\end{description}

Dědičnost -- implementace třídy pomocí nějaké jiné, předefinování metod\\
Skládání -- složení z existujících objektů.

\section{Diagram případu užití}
Zobrazuje účastníky + případy užití + hranice systému. Funkce, které systém vykonává ve prospěch, nebo jménem konkrétních účastníků.

\section{Detail případů užití}
Konkretizace případu užití -- většinou tabulka. Obsahuje název, identifikátor, specifikaci (vstupní podmínky, účastníci, tok událostí, alternativní toky, následné podmínky).

Umožňuje zobecnit účastníka, zobecnit případu užití, vazby \verb|<<include>>|, \verb|<<extend>>|. Účelem je jednoduchost a čitelnost pro uživatele.

\section{Data Flow diagram (DFD)}
Strukturovaná analýza a návrh pro specifikaci chování. Hierarchický, obsahuje informace o datových skladech. Doplněn minispecifikacemi. Popisuje funkce.

\section{ER diagram}
Zobrazuje data a vztahu mezi nimi v klidu.

\begin{description}
	\item[Entita] věc reálného světa
	\item[Entitní množina] množina entit téhož typu
	\item[Atribut] vlastnost entity
	\begin{itemize}
		\item Jednoduché x Složené
		\item Jednohodnotové x vícehodnotové, prázdné, odvozené (věk)
	\end{itemize}
	\item[Vztah] asociace mezi několika entitami
	\begin{description}
		\item[Jméno] vztahové množiny, role
		\item[Stupeň] počet entitních množin, které spojuje
		\item[Kardinalita] maximální počet vztahů daného typy 1 nebo N
		\item[Členství/Účast] minimální počet vztahů daného typu 0 nebo 1 (volitelně/povinně)
		\item[Atributy] vztah povýšený na entitu
	\end{description}
	\item[Vztahová množina] Množina vztahů téhož typu, které sdílí tytéž vlastnosti
\end{description}

Zobrazuje pouze data, atribut pouze jednou. Data pro účely databáze a ne tiskové sestavy. Systém by neměl být zahrnut v ERD.

Slabé entitní množiny, převod N:M na dva dvě vazby 1:N.

\section{Stavový diagram (STD)}
Zobrazuje chování systému v závislosti na čase. Obsahuje stavy (počáteční, koncové), Změny/Přechody -- monou být podmíněné. Každá změna může vyvolat akci (zaslanou okolí systému /výpočet).


\section{OCL = Object Constraint Language}
formální jazyk pro UML -- umožňuje definovat omezení a podmínky (zpřesnění modelu). Přináší přesnější modelování kódu (podmínky pro vykonání metod, invarianty, počáteční hodnoty atributů, těla operací, precondition, postcondition).


































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Konceptuální modelování a návrh relační databáze.} \label{cha:32}

4. semestr, IDS, přednášky

Fáze datové, popřípadě objektové analýzy využívající modelů založených na objektech aplikační domény.

\paragraph{Strukturovaný návrh}
Východiskem pro konceptuální modelování je \emph{ER Diagram (UML)} $\Rightarrow$Modifikace na základě funkčních požadavků $\Rightarrow$ Převod datového modelu na logické schéma databáze.

\paragraph{Objektový návrh}
Východiskem diagram tříd. Zanedbáváme metody, modelujeme perzistentní data.

Máme tedy entitní množiny, které transformujeme na prvotní schéma a následně \emph{normalizujeme}.

\begin{description}
	\item[Atribut] vlastnost entity, která nás v kontextu daného problému zajímá.
	\begin{itemize}
		\item Jednoduché $\times$ Složené
		\item Jednohodnotové $\times$ Vícehodnotové
		\item Povolující prázdnou hodnotu (NULL)
		\item Odvozené (věk z data narození)
	\end{itemize}
	\item[Doména atributu] obor hodnot atributu
	\item[Identifikátor (Primární klíč)] (entitní nebo vztahová množiny). Atribut, jehož hodnota je v rámci celé množiny jednoznačná a neredukovatelná (v případě složeného klíče)
	\item[Vztah] \hfill
	\begin{itemize}
		\item Jméno
		\item stupeň (počet spojujících entit)
		\item Kardinalita (1, N)
		\item Členství (min. kardinalita: 0, 1)
	\end{itemize}
	\item[Slabá entitní množina] závislá na jiné dominantní entitní množině
	\item[Dědičnost (Generalizace/Specifikace)] Stejný identifikátor, různé možnosti implementace
	\item[Náhrada vztahů N:M] za vztahy 1:N
\end{description}

\paragraph{Špatný návrh}
\begin{itemize}
	\item Opakující se informace
	\item Nemožnost reprezentovat určitou informaci
	\item Složitá kontrola integritních omezení
\end{itemize}

\section{Postup převodu ERD na návrh databáze}
\begin{description}
	\item[Odstranění složených atributů] Další entitní množina, nebo pevný počet opakování
	\item[Odstranění vícehodnotových atributů] Několik jednoduchých atributů
	\item[Reprezentace silné entitní množiny] TE(a1, a2, \dots, an)
	\item[Reprezentace vztahů] \hfill
	\begin{description}
		\item[1:1] Atributy vztahu umístit k jedné z nich
		\item[1:N] Atributy vztahu umístit k množině s N opakováním
		\item[M:N] Atributy jsou umístěny v nové entitní množině
	\end{description}
	\item[Reprezentace slabé entitní množiny] jako silná + vztah 1:M k dominantní
	\item[Reprezentace ternárních vztahů] nová entitní množina
	\item[Generalizace/Specifikace] Různé možnosti
	\begin{itemize}
		\item Tabulka pro nadtyp a tabulky podtypu s PK nadtypu
		\item Pouze tabulky podtypů i s atributy nadtypů
		\item Všechno v jedné tabulce, rozlišení pomoc diskriminátoru nebo podle prázdných hodnot
	\end{itemize}
\end{description}

\section{Transformace objektového návrhu}
\begin{itemize}
	\item Neuvažujeme operace
	\item Identifikace pomocí OID (nepoužitelné). Pokud není identifikátor, nějaký vytvořit
	\item Řešení vztahů generalizace/specifikace, agregace, kompozice (složitější)
\end{itemize}

\section{Normalizace schématu}
Založena na 3 typech závislostí mezi atributy relace
\begin{description}
	\item[Funkční závislost] $X \to Y$ hodnota atributu relace určuje jednoznačně hodnotu jiného atributu téže relace (Y je funkčně závislé na X)
	\begin{description}
		\item[Plná funkční závislost] funkčně závislý na celém složeném atributu
		\item[Tranzitivní závislost] atribut je plně funkčně závislý na jiném funkčně závislém atributu
	\end{description}
	\item[Vícehodnotové závislosti]
	\item[Závislosti na spojení]
\end{description}

Podmínka: Společný atribut musí být kandidátním klíčem alespoň jedné z tabulek.

\subsection{Normální formy}
Požadavek na vlastnosti schématu relace z pohledu závislostí mezi atributy.

\begin{description}
	\item[1NF] Všechny jednoduché domény obsahují pouze atomické hodnoty
	\item[2NF] Každý neklíčový atribut je plně funkčně závislý na každém kandidátním klíči.
	\item[3NF] Neexistuje žádný neklíčová atribut, který je tranzitivně závislý na některém kandidátním klíči.
	\item[BCNF] (Boyce-Coddova normální forma) Může existovat více kandidátních klíčů, mohou být složené, mohou se překrývat.
	
	Pro každou netriviální funkční závislost $X \to Y$ je X superklíčem (nadmnožinou kandidátního klíče).
	
	Není vždy splnitelné.
	
	\item[4NF] Vlastnosti pro atributy relace s ohledem na vícehodnotové závislosti
	\item[5NF] Vlastnosti pro atributy relace s ohledem na závislosti na spojení
\end{description}

Databáze je v n-té normální formě, pokud všechny její relace splňují alespoň n-tou NF.
























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Relační datový model a jazyk SQL.} \label{cha:33}

4. semestr, IDS, přednášky

\section{Historie}
\begin{description}
	\item[50. léta] vše v programu
	\item[60. léta] systém pro ovládání souborů (hromadné zpracování dat). Problémy s redundancí, konzistencí, bezpečností, integritou.
	\item[pol. 60. let] Databázové technologie, SŘBD -- datová nezávislost.
	\item[70. léta] snaha o standardizaci
\end{description}

\section{Slovník pojmů aneb nevím jak to už pojmenovat}
\begin{description}
	\item[Databáze] perzistentní data
	\item[Perzistentní data] data s dobou života přesahující běh programu i vypnutí počítače.
	
	Data mohou být sdílená, jsou bezpečná a splňují integritní omezení.
	\item[Konzistence dat] nerozporuplnost
	\item[SŘBD] programová vrstva řídící operace nad databází -- odstiňuje uživatele od technických detailů
	\item[Úrovně pohledu na data]
	\begin{description}
		\item[Fyzická] jak jsou uložena na disku/v souborech
		\item[Konceptuální/Logická] jaká jsou to data, vztahy mezi nimi
		\item[Externí] Jak data vnímají jednotliví uživatelé (pohledy)
	\end{description}
\end{description}

\paragraph{Datové modely}
kolekce konceptuálních nástrojů pro popis objektů reality, sémantika, vztahy, reprezentovaná data, integritní omezení.

\subsection{Podle úrovně modelování}
\begin{description}
	\item[Logické modely] Konceptuální, pohledy
	\begin{itemize}
		\item Modely pro modelování objektů reálného světa
		\item Databázové modely definující logickou organizaci dat v databázi
	\end{itemize}
	\item[Fyzické modely]
\end{description}

\subsection{Podle druhů vazeb}
\begin{description}
	\item[Hierarchický] strom, navigační programování
	\item[Síťový] množina záznamů + pojmenované vazby, stále navigační manipulace
	\item[Relační] Na logické úrovni tabulky, atomické hodnoty, výběr, vložení, úprava tabulky po řádcích.
	
	Jednoduchá struktura, jednoduché operace, informace rozptýlena po tabulkách.
	
	Schéma databáze je v systémovém katalogu.
	
	\item[Objektově orientované, objektově-relační] (postrelační)
\end{description}

\subsection{Datová nezávislost}
možnost modifikovat schéma bez vlivu na vyšší úrovně
\begin{description}
	\item[Fyzická] modifikace fyzického schématu (uložení na disku) bez nutnosti zasahovat do aplikace
	\item[Logická] schopnost modifikovat logické schéma bez nutnosti zasahovat do aplikace aplikace (přidat sloupec)
\end{description}

\subsection{Databázové dotazovací jazyky}

\begin{description}
	\item[DDL] Data Definition Language -- definice dat, aktualizace systémového katalogu
	\item[DML] Data Manipulation Language -- Vyhledávání, vkládání, aktualizace, rušení
	\item[DCL] Data Controll Language -- kontrola přístupu k datům, definice integritních omezení
	\item[ostatní] Transakce
\end{description}

\section{Relační model dat}
Oddělení logické struktury dat od implementace, matematická podpora (E.F.Codd).

\begin{description}
	\item[Doména] Pojmenovaná množina skalárních hodnot téhož typu
	\item[Skalární hodnota] atomická, nejmenší sémantická jednotka dat
	\item[Složená doména] z několika domén
	\item[Relace] na doménách $D_1, D_2, \dots D_n$ je dvojice $R = (R, R^*)$, kde $R = R(A_1:D_1, A_2:D_2, \dots, A_n:D_n)$ je schéma relace a $R^* \subseteq D_1 \times D_2 \times \dots \times D_n$ je tělo relace. Počet atributů n = řád (stupeň) relace.
\end{description}

tabulka = znázornění relace

\paragraph{Integritní pravidla} omezení plynoucí z reality. Mohou být
\begin{itemize}
	\item Speciální pro konkrétní aplikaci
	\item Obecná pro každou databázi
\end{itemize}

\paragraph{Primární klíč} jednoznačně identifikuje n-tici v relaci. Nesmí být prázdný (NULL). Jeden z kandidátních klíčů (jednoznačný, minimální)

\paragraph{Cizí klíč} atribut FK bázové relace R2. Každá hodnota musí být plně zadaná nebo nezadaná. Musí existovat odpovídající kandidátní klíč v R1.

\paragraph{Referenční integrita} relace nesmí obsahovat žádnou nesouhlasnou hodnotu cizího klíče.

\section{Relační algebra}
$RA = (R,O)$, kde R jsou Relace a O jsou operace:

\begin{description}
	\item[Sjednocení] $R_1 = R( R, R_1^*)$, $R_2 = R( R, R_2^*)$
	
	$R_1 \text{ union } R_2 = (R, R_1^* \cup R_2^*)$
	
	\item[Průnik] $R_1 \text{ intersect } R_2 = (R, R_1^* \cup R_2^*)$
	\item[Rozdíl] podobně
	\item[Kartézský součin] $R_1 = R( R_1, R_1^*)$, $R_2 = R( R_1, R_2^*)$
	
	$R_1 \text{ times } = ( (R_1, R_2), R_1^* \times R_2^*)$
	
	\item[Projekce] $R = (R, R^*)$ na atributy X, Y, \dots, Z je relace R[X, Y, \dots, Z] se schématem (X,Y,Z) a tělem zahrnujícím všechny n-tice t = (x,y, \dots, z) takové, že v $R^*$ existuje n-tice $t'$ s hodnotou atributu X rovnou x, Y = y, \dots
	\item[Selekce] (restrikce) relace $R = (R, R^*)$ na atributech X, Y a s operátorem $\theta$ je relace $R \text{ where } X \theta Y$, která má stejné schéma a obsahuje všechny n-tice pro které platí $x \theta y$, kde x je hodnota atributu X a y je hodnota atributu Y.
	\item[Spojení] $R_1(X_1, X_2, \dots, X_m, Y_1, Y_2, \dots, Y_n) \quad R_2(Y_1, Y_2, \dots, Y_n, Z_1, Z_2, \dots, Z_k)$ a atributy x, y, z: $R_1 join R_2$ je relace se schématem $(X, Y, Z)$ a tělem zahrnujícím všechny n-tice  s hodnout X a Y v $R_1^*$ a Y a Z v $R_2^*$.
\end{description}

Dále pak přiřazení, přejmenování a agregace

Základ pro optimalizaci dotazů. Implementace jazyka SQL je relačně úplná, pokud je aspoň tak mocná, jako relační algebra.

\section{Jazyk SQL}

od roku 1975 řada dialektů, standardizace SQL/92, později SQL/99. Různé úrovně implementace (Entry).

\subsection{Kontexty použití SQL}
\begin{description}
	\item[Přímý (direct)]
	\item[Hostitelská verze (embedded)]
	\item[Jazyk modulů] (vyšší programovací jazyk)
\end{description}

\subsection{Kategorie příkazů}
\begin{description}
	\item[Definice dat] DDL -- Data Definition Language
	
	CREATE, DROP, ALTER TABLE sloupce, integritní omezení (CHECK, PRIMARY KEY). Sloupec: jméno, typ, výchozí hodnota, io
	
	Datové typy: CHARACTER, NUMERIC, DATE, TIME, od SQL/99 BOOLEAN, BLOB, zkratky VARCHAR, literály
	
	události ONUPDATE, ONDELETE -- co se stane s odkazovanými tabulkami
	
	CREATE SYNONYM -- přístup k tabulce jiných uživatelů
	
	CREATE SEQUENCE -- sekvence primárních klíčů
	\item[Manipulace s daty] DML -- Data Manipulation Language
	
	SELECT, UPDATE, DELETE -- operandy: bázové tabulky, výsledkem je opět tabulka
	
	SELECT ALL/DISTINCT položka AS alias FROM tabulka AS alias WHERE podminka GROUP BY sloupce pro seskupení HAVING podminka po agregaci ORDER BY sloupce pro řazení
	
	Spojení: JOIN: Vnější (outer) $\times$ Vnitřní (inner) (obecné/rovnost, přirozené)
	
	podmínky WHERE -- NOT, AND, OR, IS NULL, BETWEEN, EXISTS (korelovaný poddotaz), LIKE (podřetězec), IN tabulkový výraz
	
	UNION, EXCEPT, INTERSECT -- sjednocení, rozdíl, průnik (ALL -- neodstraňuje duplicity)
	
	DELETE FROM table WHERE, UPDATE TABLE SET fields WHERE
	
	\item[Pohledy] virtuální tabulky
	CREATE VIEW pohled (sloupce) AS tabulkový výraz
	
	DROP VIEW pohled
	
	SŘBD umožňuje aktualizovatelnost pohledů (nový řádek, úprava hodnoty). Některé pouze pro čtení.
	
	Materializované pohledy -- fyzicky uložené v databázi
	
	\item[Přístup k systémovému katalogu] aplikačně závisle. SHOW TABLES, DESCRIBE table
	
	\item[autorizace, integrita dat, řízení transakcí]
\end{description}

\paragraph{Chybějící hodnota} označení NULL, Vzniká tříhodnotová logika porovnávání -- true, false, unknown -- porovnávání: IS NULL

SQL/92 není výpočetně úplný. Hostitelská verze bývá obecně mocnější.

\subsection{Architektura}
Třívrstvá architektura: Prezentační služby/logika, logika aplikace/dat, Datové služby/ovládání souborů

Přímo v DB mohou být uložené procedury/funkce

\paragraph{Databázové triggery} kód spouštěný jako reakce na událost tabulky: AFTER/BEFORE, INSERT, DELETE, UPDATE, popřípadě další podmínka WHEN

Mohou řešit integritní, bezpečnosti omezení, audit přístupu, výpočty odvozených hodnot.

\subsection{Bezpečnost}
\begin{itemize}
	\item Důvěrnost -- nepřístupné neautorizovaným
	\item Integrita
	\item Dostupnost -- autorizovaným není bráněno v přístupu
\end{itemize}

\paragraph{Bezpečnostní politika + mechanismy}

\begin{itemize}
	\item Většinou přístupová práva uživatel $\times$ databázový objekt (nepovinné), SQL implementuje.
	\item Bezpečnostní třídy, stupně utajení objektů, stupně pověření subjektů. (povinné) Není běžné.
\end{itemize}

CREATE USER, GRANT TO, REVOKE FROM

dále šifrování dat, přenosu jména a hesla po síti, záznamy o manipulacích (audit).

\subsection{Fyzická úroveň}

Struktura souborů -- pevná/proměnná délka, neuspořádaný/sekvenční/hashovaný.

Snaha o minimalizaci přístupů na disk: Vyrovnávací paměť -- výměna bloků (LRU, MRU), vynucený zápis.

\paragraph{B+ Strom} indexová struktura v databázových systémech. Víceúrovňový index, vyvážený n-nární strom, kde n - maximální počet následovníků. Listy tvoří jednosměrný uspořádaný seznam. Uzel je typicky velikosti diskového bloku.

\paragraph{Hashování}
Hodnota vyhledávacího klíče je typicky adresa sektoru se záznamem. Požadavkem je rovnoměrné a náhodné rozložení.

\paragraph{Shlukování} Clustering. Umístění záznamů se stejnými vlastnostmi fyzicky blízko sebe. 

\paragraph{Bitmapové indexy} ve kterých záznamech se vyskytuje daná hodnota vyhledávacího klíče (očíslování řádků tabulky, málo různých hodnot, jednoduché operace hledání (bitový AND, OR)).

\paragraph{Výběr indexu}
Použití klíče ve klauzulích WHERE, JOIN. Pro porovnání je lepší hashování, pro rozsahové dotazy B+ stromy.

\subsection{Optimalizace}
prováděná SŘBD.
\begin{itemize}
	\item Převod do Relační algebry (vnitřní reprezentace)
	\item Efektivnější výraz (může využít sémantické optimalizace -- klíče)
	\item Výběr kandidátů pro implementaci operací
	\item Generování plánu vyhodnocení (podle cenových funkcí).
\end{itemize}

Dále může využívat statistiky -- počet n-tic v relaci, velikost n-tice relace, počet různých hodnot atributu X v relaci $\Rightarrow$ Odhad ceny dotazu

Cílem je minimalizovat odezvu systému a maximalizovat propustnost systému.

\subsection{Transakční zpracování}

\paragraph{Transakce} jednotka provádění programu, která zpřístupňuje případně modifikuje data v databázi.

\paragraph{ACID vlastnosti}
\begin{itemize}
	\item Atomicita -- transakce se vykoná celá, nebo se nevykoná ani její část.
	\item Konzistence -- izolovaná transakce zanechává konzistenci databáze
	\item Izolace -- i při souběžném běhu jsou transakce zpracovány za sebou
	\item Trvalost -- po ukončení jsou změny trvalého charakteru
\end{itemize}

Stavy transakce:
\begin{verbatim}
A -- PC -- C
  \f |f
   \ |
     F -- AB
\end{verbatim}
\begin{itemize}
	\item A -- Počáteční stav
	\item PC -- Poslední příkaz
	\item C -- OK, úspěch, potvrzení
	\item F -- Chyba
	\item AB -- Transakce zrušená (rollback)
\end{itemize}

SQL příkazy jsou atomické. Zahájení transakce je implicitní, nelze zanořovat, lze použít SAVEPOINT, COMMIT, ROLLBACK

\subsection{Zotavení po chybách a poruchách}
Před modifikací databáze uložit do stabilní paměti informace o modifikaci (Žurnál, logfile): číslo transakce, akce (start, změny, commit, abort. Akce undo(), pokud žurnál obsahuje start transakce, ale ne její commit. Akce redo(), pokud oboje.

\paragraph{Kontrolní body}
Snížení režie při výpadku -- periodické ukládání
\begin{enumerate}
	\item Uložení žurnálu z hlavní paměti
	\item Uložení modifikovaných bloků databáze na disk
	\item Uložení záznamu checkpoint do žurnálu (stabilní paměť)
\end{enumerate}

WAL -- Write-ahead Loging -- záznam do logu před zápisem do databáze.

\subsection{Řízení souběžného přístupu}
Sériový plán -- instrukce jedné transakce jsou prováděny bezprostředně za sebou -- zachování konzistence.

Problémy: Ztráta aktualizace/Závislost na potvrzení jinou transakcí/Přepis nepotvrzené hodnoty.

Instrukce jsou \emph{konfliktní}, pokud přistupují ke stejnému databázovému objektu a alespoň jednou z nich je write.

Plánování, zamykání, časová razítka.

Uzamykací protokol -- pravidla 2PL -- dvě fáze: růst (zamykání) a zmenšování (pouze odemykání).

Lze řešit granularitu: tabulka, řádek.

Řešení deadlock: Jiný protokol, timeout.


















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Principy a struktury správy souborů a správy paměti} \label{cha:34}

2. semestr, IOS, 4. a 7. přednáška

\section{Pevný disk}

kruhové plotny. Data v jednotlivých kruhových stopách, čtecí hlavy.

Dělení do sektorů, typicky 512b.

Cylindr - stopa, která se nachází na všech plotnách nad sebou.

\subsection{Adresace}
\begin{description}
	\item[CHS] Cylinder -- Head -- Sector
	\item[LBA] Logical Block Addressing
\end{description}

Prokládání -- používalo se dříve. Řešení pomalého řadiče.

Typy rozhraní: ATA (IDE), SATA, SCSI, SAS, USB, FireWire, Fibre. Liší se rychlostí, maximálním počtem zařízení, maximální délkou kabelu.

Hierarchie pamětí (viz \ref{cha:4}):
\begin{description}
	\item[Primární] RAM (nad tím jsou ještě registry a cache)
	\item[Sekundární] Pevné disky
	\item[Terciální] Pásky, CD, DVD
\end{description}

Přístupová doba = vystavení hlav + rotační zpoždění

Kapacita, otáčky, rychlost přenosu.

SSD - nevolatilní typ paměti NAND, rychlejší, tišší, odolnější, dražší, omezený počet přepisů.

Zabezpečení -- ECC - Error correction code - redundantní data pro opravu chyb

S.M.A.R.T. -- monitoring, statistiky disku

\subsection{Disková pole RAID}
 = Redundant Array of Inexpensive Disks

\begin{description}
	\item[RAID 0] Rozmístění bloků na více discích - vyšší výkonnost
	\item[RAID 1] Zrcadlení (všechna data na dvou discích) - záloha a výkonnost
	\item[RAID 2] Data rozdělena po bitech, \emph{zabezpečení} hummingovým kódem (3 zabezpečení, 4 datové)
	\item[RAID 3] Po bajtech na různé disky, jeden disk pro paritu
	\item[RAID 4] Bloky na různých discích, parita na zvláštním (příliš vytížený)
	\item[RAID 5] Bloky po discích, parita se střídá na všech discích - rovnoměrné vytížení
	\item[RAID 6] Parita je na dvou discích (vyrovná se se ztrátou dvou disků).
\end{description}

\subsection{Uložení souboru na disk}

Alokační blok -- $2^n$ sektorů -- nejmenší jednotka diskového prostoru, se kterou OS umožňuje uživatelům pracovat. Většinou 4KB.

\subsection{Fragmentace}
\begin{description}
	\item[Externí fragmentace] Související sektory nenásledují za sebou, mohou být promíchány. Mohou vznikat příliš malá, nevyužitá místa.
	\item[Interní fragmentace] OS alokuje místo na disku, které zůstává nevyužité. Místo na konci posledního alokačního bloku.
\end{description}

Plánování přístupu na disk -- výtahový algoritmus.

Logický disk -- MBR -- 1-4 primárních diskových oblastí.

\subsection{Souborové systémy}
\begin{itemize}
	\item FS, ext3, FAT, NTFS
	\item VFS -- virtuální, transparentní práce se souborovým systémem nezávisle na architekruře nebo lokalitě připojení.
	\item NFS -- síťový souborový systém (RPC)
	\item tmpfs -- prostor v RAM pro dočasná data
\end{itemize} 

\subsection{Žurnálování}

Záznam dat před jejich zápisem na disk. Cyklicky přepisovaný buffer.

Operace s diskem musí být atomické, aby byl stále v konzistentním stavu.

Alternativou: COPY-ON-WRITE (COW) -- Nejprve se zapíší data, potom se zpřístupní. Několik verzí stromů a záznamů.

\subsection{FS - UNIXový filesystem}
Logický disk: Boot block, Super block, Tabulka i-uzlů, datové bloky. Tabulka pro lepší výkonnost bývá rozdělena na více částí (lepší lokalita).

\paragraph{i-uzel}

Obsahuje metadata, 10 přímých odkazů, 1 nepřímý první úrovně (odkaz na tabulku odkazů), 1 nepřímý druhé úrovně, 1 nepřímý třetí úrovně.

Teoretický limit velikosti souboru: $(10 D + N D + N^2 D + N^3 D)$, kde D je velikost bloku v bajtech (4096 B) a N je D/4 počet odkazů (4B) v bloku.

Snaha o minimalizaci režie při:
\begin{itemize}
	\item Průchodu souboru, zvětšení, zmenšení.
	\item Vyhledání prvního bloku souboru
	\item Přidání/ubrání dalšího bloku
	\item Snadnost alokace/dealokace
\end{itemize}

Většinou výhodné pro malé soubory (například data přímo v i-uzlu -- fast symlinks)

Kontinuální uložení -- nepoužívá se.

Zřetězené seznamy bloků -- při rozpojení hrozí ztráta velkého množství dat.

FAT -- tabulka integerů, položka pro každý blok -- označení o zřetězení, volné nebo chybné.

\subsection{B+ stromy}

Při vkládání může nastat rozštěpení uzlu, při odstranění sloučení. Jsou zřetězené a lze je jednoduše přecházet.

podobné jsou stromu extentů (ext3, ext4) a AVL stromy.

\subsection{Reprezentace adresáře}

Soubor obsahující seznam dvojic -- \uv{hard links} (jméno, číslo uzlu).

Přístupová práva -- Access Controll List (ACL), Speciální soubory (blokový, znakový), Pojmenovaná roura, socket.

\subsection{Vstup/Výstup soubory v UNIXu}

I/O Buffering -- minimalizace počtu poamlých diskových operací.

Buffer pool -- vyrovnávací paměť.

\paragraph{Čtení}
\begin{enumerate}
	\item Přidělení VP, načtení bloku
	\item Kopie požadovaných dat procesu
\end{enumerate}
Při dalším čtení pouze 2.

\paragraph{Zápis}
\begin{enumerate}
	\item Přidělení VP, načtení bloku
	\item Zápis do VP, nastavení dirty bit -- příznak modifikace
	\item Zpožděný zápis na disk (lze vynutit okamžitý)
\end{enumerate}

\subsection{Otevření souboru}

\begin{itemize}
	\item Vyhodnocení cesty a nalezení i-uzlu
	\item V systémové tabulce i-uzlů vytvoří novou položku, načte i-uzel, vznikne rozšířený v-uzel
	\item Systémová tabulka otevřených souborů
	\item Pole deskriptorů souborů procesu
\end{itemize}

Disk -- V-node table, -- open-file table -- file descriptor table

\paragraph{Spooling} vyrovnávací paměť pro zařízení (tiskárna), které neumožňují prokládané zpracování dat více procesů.


\section{Správa paměti}

Aby program mohl být proveden, musí nad ním bát vytvořen proces, musí mu být přidělen procesor a musí mu být předělena paměť (+ další zdroje).

\subsection{LAP}
Logický adresový prostor -- virtuální, pro každý proces vlastní. Pracuje s ním procesor při provádění kódu.

\subsection{FAP}
Fyzický adresový prostor -- fyzické adresy, společný pro všechny procesy.

\subsection{MMU}
Memory Management Unit. překlad logických adres na fyzické (dnes součást čipu procesoru).

\subsection{Přidělování paměti}
Na nejnižší úrovni: přidělení FAP pro mapování do LAP, konzistentní se způsobem překladu LAP na FAP. Spojité bloky, segmenty, stránky a kombinace všeho.

Na vyšší úrovni: Přidělování LAP pro pro potřeby procesů uživatele (malloc a jeho alternativy).

\subsection{Contignous Memory Allocation}

Přiděleny spojité bloky. Projevuje se externí fragmentace, nemusí způsobovat interní. Jednoduchá implementace.

CPU -- LA -- kontrola limitu -- realokační registr -- FA -- Paměť

\subsection{Segmentace paměti}

LAP rozděle na segmenty, ty jsou přidělovány částem procesu. Každý segment má číslo a velikost.

Logická adresa je složena z čísla segmentu a posunu v něm.

Segmenty mohou být jen pročtení, sdílené. Jednoduchá implementace. Zmírnění dopadu externí fragmentace.

\subsection{Stránkování}

LAP je rozdělen na stránky (pages). FAP rozdělen na rámce (frames).

Paměť přidělována po rámcích, neviditelné pro procesy, minimalizována externí fragmentace, jemná kontrola odkládání, přístupu, ochrany. Složitější implementace, interní fragmentace.

\paragraph{Jednoúrovňové tabulky stránek}
LA = číslo stránky + posuv

Tabulka stránek pro každý proces v RAM. Obsahuje mapování LAT do FAP, příznaky, přístup.

Každý odkaz na data/instrukci v paměti vyžaduje dva přístupy do paměti. Speciální registr obsahuje adresu začátku tabulky stránek pro aktuální proces (CR3 u x86).

Urychlení pomocí TLB (Translation Look-aside Buffer).

\subsection{TLB: Translation Look-aside Buffer}

Obsahuje číslo stránky, číslo rámce + příznaky.

\paragraph{TLB miss}
tabulka neobsahuje záznam pro danou stránku. Hledá se paralelně. Může nastat i několikrát během vykonávání instrukce (instrukce, operandy). Násobně větší režie.

Efektivita stránkování závisí na úspěšnosti TLB: efektivní přístupová doba: $(\tau + \varepsilon)\alpha + (2\tau + \varepsilon)(1-\alpha)$, kde $\tau$ je vybavovací doba RAM, $\varepsilon$ je vybavovací doba TLB, $\alpha$ je TLB hit ratio.

Tabulky stránek rozsáhlé, proto jsou často hierarchické.

\subsection{Hierarchické tabulky stránek}

Tabulky tabulek stránek. 386: 2 úrovně, x86-64: 4 úrovně.
\begin{itemize}
	\item 10bit -- Page directory
	\item 10bit -- Page tables
	\item 12bit -- Offset
\end{itemize}

Možno pracovat s různými velikostmi stránek pomocí příznaků v adrese.

\subsection{Hashové tabulky stránek}

Každý proces má hash tabulku

\subsection{Invertovaná tabulka stránek}

Jediná tabulka. Udává pro každý rámec, který proces má do něj namapovánu kterou stránku.

Problematické sdílení stránek. Používá se v kombinaci s hashováním.

\subsection{Virtualizace paměti}

Využitý adresový prosto nemusí být ve fyzické paměti (odkládá se na disk).

\subsection{Stránkování na žádost}

Stránky jsou zaváděny, jsou-li zapotřebí. Pokud není stránce přiřazena rámec -- \emph{page fault} -- přerušení MMU.

Obsluha page fault
\begin{enumerate}
	\item Kontrola zda jsme v přiděleném rámci
	\item Alokace rámce -- pokud není volný, uvolnění
	\item Inicializace stránky
	\begin{itemize}
		\item Kód, konstantní data -- načtení z programu
		\item Ostatní -- poprvé vynulovat (bezpečnost). Jinak načíst uložené z disku
	\end{itemize}
	\item Úprava tabulek stránek
	\item Opakování instrukce
\end{enumerate}

\subsection{Výkonnost}

Efektivní doba přístupu do paměti: $(1-p)T + pD$, kde p = page fault rate, T je doba přístupu bez výpadku, D  je doba přístupu s výpadkem.

Výpadek pro instrukci, operandy i více úrovní stránek. 

\subsection{Odkládání stránek}

\begin{itemize}
	\item Lokální -- v rámci procesu
	\item Globální -- jakýkoliv proces
\end{itemize}

V případě že počet volných rámců klesne pod určitou mez, spustí se Page Daemon (zloděj stránek).

\subsection{Algoritmy výběru}

\begin{description}
	\item[FIFO] odkládá stránky na začátek fronty, odebírá z konce oběti.
	\item[LRU] odkládá nejdéle nepoužitou stránku, problematická implementace. Používají se aproximace.
	\item[Aproximace LRU pomocí omezeného historie referenčního bitu stránek] Historie přístupů, posouvá se doprava po určitém čase. Při přístupu se nastavuje na 1. Oběť je vybrána jako stránka s nejmenší číselnou hodnotou.
	\item[Aproximace LRU algoritmem druhé šance (Clock algoritmus)] Rotuje seznam stránek a nuluje referenční bit. Ta která již referenční bit má v 0 je oběť. Modifikace: Upřednostňování nemodifikovaných stránek, dva ukazatele v nějakém rozsahu (jeden nuluje, druhý uvolňuje).
\end{description}

Thrashing -- Systém tráví více času hledáním volných stránek než užitečným výpočtem (od určité úrovně zaplnění paměti). Lze pozastavit, nebo zabít celé procesy.

Prepageing

Zamykání stránek -- zabraňujeme odložení -- IO, jádro, soft realtime

Sdílení stránek -- IPC, sdílené knihovny.

Fork -- copy-on-write -- paměť se kopíruje až při změně, ne ihned při forku.

























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Plánování a synchronizace procesů, transakce)} \label{cha:35}

2. semestr, IOS, 5. a 6. přednáška

\section{Správa procesů}

\begin{description}
	\item[Plánovač (Scheduler)]přiděluje procesor
	\item[Správa paměti] přidělení paměti
	\item[Podpora meziprocesorové komunikace IPC] - signály, RPC
\end{description}

\subsection{Proces}
Běžící program (program -- statická entita, které obsahuje předpis pro provedení určité činnosti).

Definován v OS pomocí:
\begin{itemize}
	\item PID
	\item stav plánování:
	\begin{itemize}
		\item New (čeká na přidělení zdrojů)
		\item Ready (čeká na přidělení procesoru)
		\item Running (běžící, lze přerušit)
		\item Waiting (čekající na IO událost, nebo jinou, poté zpět do ready)
		\item Terminated (ukončený)
		\item Suspended (Linux, SIGSTOP, SIGCONT)
	\end{itemize}

	\item obsah registrů
	\item data v zásobníku
	\item dalšími objekty v OS (např. otevřené soubory)
\end{itemize}

Proces v OS reprezentován pomocí \emph{PCB} -- Process Controll Block. Obsahuje identifikaci, stav plánování, obsah registrů, plánovací informace (priorita), informace o paměti (tabulky stránek), účtování (spotřeba procesoru), využití IO.

\subsection{Části procesu v UNIXu}

\begin{itemize}
	\item Uživatelský adresový prostor (kód, data, zásobník, soukromá data sdílených knihoven, sdílené knihovny, sdílená paměť.
	\item Uživatelská oblast přístupná pouze jádru -- část PCB, která je potřeba při běhu procesu
	\item Záznam v tabulce procesů -- informace z PCB, které jsou potřeba i když proces neběží
	\item Tabulka paměťových regionů procesu
\end{itemize}

\subsection{Kontext procesu v UNIXu}
Stav -- uživatelský, registrový, a systémový kontext.

\begin{description}
	\item[PID] Identifikace procesu
	\item[PPID] Identifikace předka procesu
	\item[UID, GUID] Identifikace uživatele a skupiny, který proces spustil
	\item[EUID, EGID] Efektivní uživatel
	\item[uložená EUID a EGID] snížená oprávnění
	\item[FSUID, FSGID] pro přístup k souborům se zvýšenými privilegii
	\item[PGID, SID] Identifikace skupiny procesů a sezení
\end{description}

\subsection{Systémová volání nad procesy v UNIXu}

\paragraph{Vytvoření procesu: fork}

potomek: pid = 0\\
chyba: pid = -1\\
rodič: jinak (pid - PID potomka)

Hierarchie procesů: INIT pid=0 -- po skončení procesu vzniká zombie a čeká až rodič převezme návratový kód (wait)

\paragraph{Změna programu: exec}

\verb|$ exec("/bin/ls", "ls", "-l", NULL)|

\subsection{Start systému}
\begin{enumerate}
	\item BIOS - základní testování a inicializace HW
	\item zavaděč - MBR a další části disku
	\item inicializační funkce jádra
	\item Vytvoření procesu Swapper (inicializace procesu INIT a swapování)
	\item Init načítá konfigurace a spouští démony a procesy.
	\begin{itemize}
		\item V jednu chvíli také GDM/KDM - přihlášneí
		\item getty -- login -- shell -- gettty (po ukončení)
	\end{itemize}
\end{enumerate}

\subsection{Úrovně běhu}
\begin{itemize}
	\item 0: halt
	\item 1 -- 5: single user, bez grafického rozhraní atd. (záleží na distribuci)
	\item 6: reboot
\end{itemize}

V \verb|/etc/rcX.d| konfigurace pro příslušné úrovně.

\section{Plánování procesů}

Plánovač rozhoduje o tom, který proces poběží a případně jak dlouho.

\subsection{Preemptivní plánování}

Ke změně běžícího procesu může dojít bez přičinění procesu (typicky přerušení časovače)

\subsection{Nepreemptivní plánování}

Ke změně může dojít pouze pokud proces předá řízení jádru (žádost o IO operaci, vzdání se procesu -- volání \verb|yield|).

O vlastní přepnutí kontextu se stará dispečer (plánovač pouze rozhoduje, nemusí běžet v režimu jádra). Přepínání kontextu může být ovlivněno swapováním (přidělení paměti) a systémem spouštění nových procesů.

\begin{description}
	\item[Střednědobé plánování] Rozhodování o procesech, které mají být odstraněny z paměti, nebo navráceny zpět
	\item[Dlouhodobé plánován] Rozhodování o spuštění nových procesů (jestli ihned, nebo se zpožděním)
\end{description}

\subsection{Přepnutí kontextu}

Dispečer odebere procesor procesu A a přidělí jej procesu B. Uschová stav procesu A do \emph{PCB} a obnoví stav procesu B.

Trvá několik stovek až tisíc instrukcí! Stačí ale uložit ukazatele na tabulku stránek, není potřena celý obsah.

\section{Plánovací algoritmy}

\subsection{FCFC}
First come, first server -- procesy čekají na přidělení procesoru ve FIFO frontě. Nové procesy se zařazují na konec fronty, procesor se přiděluje procesům na začátku fronty.

Nepreemptivní -- přepnutí kontextu nastane pouze na žádost procesu. Jednoduchá implementace.

\subsection{Round Robin}

Preemptivní FCFS -- každý proces má přiděleno časové kvantum, po jehož vypršení je procesor odebrána  proces zařazen na konec fronty.

\subsection{SJF}

Shortest Job First -- přiděluje procesor procesu, který požaduje nejkratší čas.

Nepreemptivní -- nepřerušuje běžící procesy.

Využívané ve speciálních dávkovách systémech, kde je známá předpokládaná délka trvání procesu. Zvyšuje propustnost systému, ale hrozí riziko hladovění.

\subsection{SRT}

Shortest Remaining Time -- obdoba SJF, ale spouštíme podle zbývajícího času.

\subsection{Víceúrovňové plánování}

Procesy rozděleny do skupin (většinou podle priority). V rámci každé skupiny se může použít jiný plánovací algoritmus. Dále obsahuje algoritmus výběru skupiny, ze které se má proces spustit (často pouze priorita).

Hrozí vyhladovění nízko-prioritních procesů.

\subsection{Víceúrovňové plánování se zpětnou vazbou}

Nový proces je zažazen do nejvyšší priority a ta postupně klesá. Na nejnižší prioritě plánování pomocí Round Robin.

Variantou je, že priorita může stoupat, pokud proces spotřebovává málo času a klesá když spotřebovává více času.

Umožňuje rychlou reakci interaktivních procesů.

\subsection{Linux 2.6}

100 statických úrovní, 1-99 pro realtime, plánováno pomocí FCFS nebo Round Robin. 0 pro běžné procesy, plánované pomocí O(1) nebo CFS.

Dynamické úrovně -20 až +19 -- ovlivnitelné pomocí nice, renice. Snižování/zvyšování na základě spotřeby CPU.

\subsection{O(1) plánovač}
Víceúrovňové plánování se zpětnou vazbou (starší jádra v 2.6). Statické priority modifikovatelné pomocí spotřeby CPU, časová kvanta ovlivněna prioritou pro každý proces. 2 sady plánovacích front (předcházení hladovění) -- aktivní a expirovaná.

Round Robin na dané úrovni, potom postup do nižší úrovně. Po vypršení časového kvanta přesun do expirované fronty. Až jsou aktivní prázdné, výměna a znovu.

\subsection{CFS}

Completely Fair Scheduler -- jednodušší implementace (novější jádra 2.6).

Každému procesu přiděleno odpovídající procento strojového času. U každého procesu tento údaj sleduje. Minimální čas dává novým procesům.

Vybírá proces s nejmenším časem ke spuštění, nechává běžet po dobu přiděleného kvanta na základě priorit.

Má podporu pro skupinové plánování.

\subsection{Windows NT a novější}

32 úrovní --\\
0: nulování volných stránek
1 -- 15: Běžné procesy
16 -- 31: Realtime procesy

Dynamicky je priorita ovlivňována: Okno na popředí, okno se vstupními zprávami, procesy, které byly právě uvolněny z čekání. Snižuje se po každém vyčerpání kvanta.

\section{Problém inverze priorit}

\begin{itemize}
	\item Nízko prioritní proces alokuje zdroj
	\item Vysoce prioritní jej potřebují a tak jsou zablokovány
	\item Středně prioritní procesy získají maximální prioritu
\end{itemize}

Může být problém, pokud jsou blokovány procesy reálného času. Zvyšuje se odezva systému.

\subsection{Řešení}
\begin{description}
	\item[Priority Ceiling] Procesy v kritické sekci získávají maximální prioritu
	\item[Priority Inheritance] Proces v kritické sekci blokující prioritnější proces získává jeho prioritu
	\item[Zákaz přerušení v průběhu vykonávání kritické sekce] (absolutně nejvyšší priorita)
\end{description}

\section{Další termíny}
\begin{description}
	\item[Vlákno] LWP -- Light Weight Process. Několik vláken sdílí data, kód a soubory. Mají vlastní registry, zásobník. Vyšší rychlost spouštění a přepínání procesů
	\item[Úloha (job)] V BASHi, skupina paralelně běžících procesů, spuštěných jedním příkazem a napojených do kolony (pipe)
	\item[Skupina procesů] Množina procesů, se kterou lze pracovat pohromadě (poslat signál, čekat na dokončení). Může mít vedoucího. \verb|getpgit|, \verb|setpgid|
	\item[Session] Skupina procesů v jednom sezení. Můžou mít vedoucího. \verb|sessid|
\end{description}

\subsection{Komunikace procesů}
IPC -- Inter-Process Communication
\begin{description}
	\item[Signály] kill, signal
	\item[Roury] pipe, mknod
	\item[Zprávy] msgget, msgset, msgrecv, mvgcnt
	\item[Sdílená paměť] shmget, shmad
	\item[Sockety] socket
	\item[RPC] Remote Procedure Call
\end{description}

\subsection{Signály}

Číslo (int) zaslané procesu přes speciální rozhraní. Při chybách, externích událostech, na žádost procesu. Asynchronní, pečlivě zvažovat obsluhu.

Implicitní zpracování obsahuje ukončení, ignorování nebo pozastavení. Lze předefinovat mimo SIGKILL a SIGSTOP.

Signály lze blokovat (mimo SIGKILL, SIGSTOP, SIGCONT). Nastavení se dědí do potomků procesů!

Zaslání signálu: \verb|kill(pid, sig)| -- kladní číslo PID, záporné číslo GID, 0: všem procesům mimo INIT. Posílání pouze procesům, ke kterým má proces oprávnění (souhlasí UID, EUID, saved EUID), nebo pokud má EUID=0 nebo CAP\_KILL (privilegia). 

\section{Synchronizace procesů}

Současný přístup několika procesů ke sdíleným zdrojům. Může vznikat časově závislá chyba (různé pořadí provedení akcí). Je potřeba synchronizace.

\begin{description}
	\item[Kritická sekce] Úseky programu, jejichž provádění jedním procesem vylučuje provádění současně procesem jiným. Je třeba zajistit vzájemné vyloučení a dostupnost kritické sekce, pokud je volná
	\item[Uváznutí (deadlock)] Každý ze skupiny procesů je pozastaven a čeká na uvolnění zdroje vlastněného jiným procesem.
	\item[Blokování (blocking)] Žádá o vstup do kkritické sekce, ale musí čekat i přestože je KS volná a nikdo o ni nežádá
	\item[Stárnutí (hladovění, starvation)] Čekání na podmínku, která nemusí nastat
	\item[Livelock] Procesy skupiny běží, ale provádějí pouze část kódu, ve které žádají o zdroj, který vlastní někdo jiný, kdo jej nemůže uvolnit
\end{description}

\subsection{Petersonův algoritmus}

\lstset{caption={Petersonův algoritmus},language=C}
\begin{lstlisting}
bool flag[2] = {false, false}; // priznaky zadosti
int turn = 0;

do { // process i
	flag[i] = true; // mam zajem o vstup
	turn = 1-i; // dam prednost druhemu procesu
	while(flag[1-i] && turn !=i); // aktivni cekani
	// KS
	flag[i] = false;
} while(1);
\end{lstlisting}

\subsection{Bakery algoritmus}

Proces získá lístek, přednost má proces s nejmenším číslem a PID.

\subsection{Podpora Hardware}

\paragraph{Atomická instrukce TestAndSet} (LOCK BITS)

\lstset{caption={TestAndSet}}
\begin{lstlisting}
bool TestAndSet( bool & target ){
	bool rv = target;
	target = true;
	return rv;
}

bool lock = false;
while( TestAndSet(lock) );
// KS
lock = false;
\end{lstlisting}

\paragraph{Swap -- atomická instrukace} (LOCK XCHG)

\lstset{caption={Swap}}
\begin{lstlisting}
void Swap( bool & a, bool & b ){
	bool temp = a;
	a = b;
	b = temp;
}

bool lock = false;
bool key = true;
while(key  == true )
	swap(lock, key);
// KS
lock = false;
\end{lstlisting}

\subsection{Aktivní čekání}
spinlock. Výše uvedené. Použitelné na krátkých kritických sekcích bez preempce.

Problematický opakovaný zápis paměťového místa (zajištění konzistence cache v multiprocesorových systémech -- řešení -- lze číst).

\lstset{caption={}}
\begin{lstlisting}
while(TestAndSet(lock))
	while(lock);
\end{lstlisting}
Nevylučuje možnost stárnutí, ale bývá tolerováno.

\section{Semafory}

Celočíselná proměnná, přístupná dvěma operacemi:
\begin{description}
	\item[lock] nebo také P, down
	\item[unlock] nebo také V, up
\end{description}

\begin{description}
	\item[S $>$ 0] odemknuto, obecně lze do kritické sekce propustit více procesů
	\item[S $\leq$ 0] zamknuto, někdy stále v nule, někdy jde do záporných (počet procesů ve frontě)
\end{description}

\lstset{caption={}}
\begin{lstlisting}
semaphore mutex;
init(mutex, 1);
lock(mutex);
// KS
unlock(mutex);

typedef struct{
	int value;
	process_queue *queue;
} semaphore;

void lock(S){
	S.value--;
	if( S.value < 0 ){
		C = get(ready_queue);
		append(S.queue, C);
		switch(); // vzdani se procesoru
	}
}

void unlock(S){
	S.value++;
	if( S.value == 0 ){
		P = get(S.queue);
		append(ready_queue);
	}
}
\end{lstlisting}

Tělo těchto funkcí je také kritickou sekcí -- lze řešit zákazem přerušení, nebo vzájemným vyloučení atomickou instrukcí (čeká se pouze na vstup do funkce, která se vykoná rychle).

Podobné: RW zámky -- možné vícenásobné zamčení pro čtení, mutexy -- binární, optimalizované.


\subsection{Implementace semaforů}

\paragraph{POSIX}
\begin{description}
	\item[System V] semget, smop, semctl 
	\item[novější] sem\_init, sem\_open, sem\_post, sem\_wait, sem\_getvalue, sem\_close, sem\_unlink, sem\_destroy
	\item[POSIX vlákna] pthread\_mutex\_lock, pthread\_mutex\_unlock
\end{description}

\subsection{Linux -- futex}

Fast User-space locks -- sdílená celočíselná hodnota inkrementována/dekrementována atomicky na úrovni asembleru. Při detekci konfliktu voláno jádro. Při malém počtu konfliktů vyšší rychlost.

\section{Monitory}

Vysokoúrovňové synchronizační prostředky. Zapouzdřená data, jen jeden proces může provádět operaci nad chráněnými daty.

Uvnitř monitoru podmínky, nad kterými je možní provádět operace -- wait (decrement) a signal nebo notify (increment).

Implementace možná pomocí semaforů. Java: klíčové slovo synchronized. POSIX: pthread\_cond\_t.

\section{Synchronizační problémy}

\subsection{Producent a konzument}

\lstset{caption={Producent a konzument}}
\begin{lstlisting}
semaphore full, empty, mutex;
init(full, 0);
init(empty, N);
init(mutex, 1);

// producent
do{
	// produce
	lock(empty); // mame misto ve sklade?
	lock(mutex);
	// zapis do KS
	unlock(mutex);
	unlock(full); // oznameni konzumentovi o nove polozce
} while(1);

// konzument
do {
	lock(full); // mame co konzumovat?
	lock(mutex);
	// cteni z KS
	unlock(mutex);
	unlock(empty); // oznameni producentovi o novem miste ve sklade
	// consume
} while(1);
\end{lstlisting}

\subsection{Čtenáři a písaři}

\lstset{caption={Čtenáři a písaři}}
\begin{lstlisting}
int readcount;
semaphore mutex, wrt;
readcount = 0;
init(mutex, 1);
init(wrt, 1);

// pisar
do{
	lock(wrt);
	// write
	unlock(mutex);
} while(1);

// ctenar
do {
	lock(mutex);
	readcount++;
	if( readcount == 1 ) lock(wrt);
	unlock(mutex);
	// read
	lock(mutex);
	readcount--;
	if( readcount == 0) unlock(wrt);
	unlock(mutex);
} while(1);
\end{lstlisting}

Hrozí vyhladovění písařů. Potřeba přidat prioritu zápisu, pokud má nějaký písař zájem zapisovat.

\subsection{Problém večeřících filozofů}

\lstset{caption={Problém večeřících filozofů}}
\begin{lstlisting}
semaphore chopstick[5];
for( int i = 0; i < 5; i++)
	init(chopstick[i], 1);


// philosopher i
do{
	lock(chopstick[i]);
	lock(chopstick[(i+1)%5]);
	// eat
	unlock(chopstick[i]);
	unlock(chopstick[(i+1)%5]);
	// think
} while(1);

\end{lstlisting}

Hrozí uváznutí, pokud si každý vezme levou a bude čekat na pravou. Řešením je vzít obě hůlky zároveň, nebo získávat hůlky asymetricky.

\section{Modelování -- Petriho sítě}

Bipartitní graf -- místa $\bigcirc$ (stavy procesů a proměnných) a přechody $\mid$ (možné akce z daného stavu), tečky $\odot$ (stavy procesů a proměnných).

Provedení přechodu -- přesun značek ze všech vstupních do všech výstupních míst.

\section{Uváznutí}
dva sdílené zdroje zamykané v jiném pořadí

Podmínky pro vznik uváznutí:
\begin{itemize}
	\item Vzájemné vyloučení při použití sdílených prostředků
	\item Vlastnictví alespoň jednoho zdroje a čekání na další
	\item Prostředky nemohou být odebrány
	\item Cyklická závislost na sebe čekajících procesů
\end{itemize}

Řešení: Prevence a vyhýbání se uváznutí, detekce a zotavení.

\begin{description}
	\item[Prevence uváznutí] zrušení alespoň jedné z podmínek.
	\begin{itemize}
		\item Nepoužívat sdílené prostředky, nebo se vyhnout vzájemnému vyloučení
		\item Povolení žádat o zdroje, pouze pokud žádné nevlastní
		\item Pokud nemůže získat všechny zdroje které potřebuje, ostatní jsou odebrány
		\item Prostředky lze získávat pouze v přesně daném pořadí
	\end{itemize}

	\item[Vyhýbání se uváznutí] procesy předem deklarují zájem o sdílené požadavky. Rozhodování o tom, které zdroje přidělíme a které odmítneme. Nesmí vzniknout cyklus (graf aokace zdrojů).
	\item[Detekce uváznutí a zotavení] Graf čekání procesů na zdroje. Pokud vznikne cyklus -- deadlock. Zotavení: Ukončení všech/zablokovaných procesů skupiny nebo odebrání zdrojů některým procesů a pozastavení. Pokračují později. Rollback, nebo akceptování částečné nekonzistence.
\end{description}

Hladovění -- procesy čekají na podmínku, u níž není zaručeno, že nastane.

\section{Formální verifikace}
Umožňuje nejen odhalit chybu, ale také dokázat správnost systému s ohledem na zadaná kritéria.

Postup:
\begin{enumerate}
	\item Vytvoření modelu (pokud nepracujeme přímo se systémem).
	\item Specifikace vlastností, které chceme ověřit (generické, specifické).
	\item Automatická kontrola.
\end{enumerate}

\subsection{Metody}
\begin{description}
	\item[Theorem proving] poloautomatický dokazovací prostředek (vyžaduje vedení experta).
	\item[Model checking] Generuje a prohledává všechny možné stavy procesu (stavový prostor).
	\item[Static Analysis] Ověření vlastnost na základě popisu modelu či systému bez~provádění.
\end{description}





































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{chapter}{35}
\chapter{Objektová orientace} \label{cha:36}

4. semestr, IPP

(základní koncepty, třídně a prototypově orientované jazyky, OO přístup k tvorbě SW)

\section{OO návrh}

OO Analýza $ \to $ OO Návrh $ \to $ OO Implementace

Principy: Identifikace objektů, tříd a instancí. Rozdělení zodpovědnosti mezi objekty.

\begin{description}
	\item[Modelování] tvorba abstrakce reálného systému
	\item[Abstrakce] Black-Box -- míra skrývání vnitřní struktury
	\item[Objekty] data-centrické modelování
\end{description}


Kritéria dobrého návrhu:
\begin{itemize}
	\item Trasovatelnost vlastností
	\item Robusnost a udržovatelnost
	\item Splnění funkčních požadavků
	\item Kvalita služeb
\end{itemize}

\subsection{UML}
vizuální jazyk vhodný pro OO modelování. Diagramy, strukturální a behaviorální pohledy.

Spoječný jazyk zákazníka, návrháře a programátora. Použitelné pro validaci a verifikaci.

\begin{description}
	\item[Diagram tříd/objektů] instance, dědičnost, násobnost vztahů mezi entitami (agregace, kompozice, závislost, dědičnost, ...)
	\item[Sekvenční diagram] Procesy/objekty a jejich vzájemná komunikace v závislosti na čase
	\item[Diagram případů užití] nejjednodušší reprezentace uživatelské interakce se systémem
\end{description}

Výhody/Nevýhody:
\begin{itemize}
	\item Jednoduché na pochopení (skutečný objekt $\to$ SW objekt)
	\item Praktické ve skutečných aplikacích
	\item Zlepšení produktivity (pro velké aplikace) -- znovupoužitelnost, SW inženýrství.
	\item Stabilita (většinou lokální změny na úrovni objektu, třídy)
	\item Delší učící křivka
	\item Pomalejší kód (objektová režie)
\end{itemize}

\section{Objektová orientace}

Položky (member fields):
\begin{description}
	\item[Atributy] Data (datové položky)
	\item[Metody] Operace (členské funkce)
\end{description}

Objektový systém -- kolekce komunikujících objektů (zasílání zpráv).

\subsection{Modely OOJ}
pravidla pro tvorbu a propojování objektového systému, model výpočtu.

\begin{description}
	\item[Statické modely] překládané (C++), statická VMT, rychlejší
	\item[Dynamické modely] interpretované (Java), jednoduchost a reflektivita
\end{description}

Každý jazyk má svůj model výpočtu.

\subsection{Formální báze}

\paragraph{UML}
OO analýza, návrh a modelování.

\subsection{$\varsigma$-kalkul}
Minimální model OOP. Program je jediný výraz, lze dokázat korektnost.
\begin{description}
	\item[Proměnná] $x$
	\item[Objekt] $[l_1 = \varsigma(x_1)e_1, l_2 = \varsigma(x_2)e_2]$ návěští, binder, hostující objekt, tělo metody
	\item[Invokace metody] $e.l$
	\item[Modifikace metody] $e.l \Leftarrow \varsigma(x)e'$
	\item[Závorky]
\end{description}

Model výpočtu -- $\varsigma$-výraz pro invokaci nebo modifikaci metody redukuji ($\hookrightarrow$).

\paragraph{Redukce}
validní substituce = textová náhrada tak, že se žádná volná proměnná nestane vázanou.

\paragraph{Vázaná proměnná}
každý výskyt proměnné x, kteří je v metodě se $\varsigma$-parametrem x.

\section{Syntaxe a sémantika složitějších OOJ}

Syntaxe: (E)BNF, gramatiky, texty, příklady

Sémantika: texty, příklady, diagramy

Pouze pár nových klíčových slov, mnoho nových významových kombinací. Víceúrovňový popis.

\section{OO Paradigmata, koncepty}

Umožňují tvořit generická řešení (znovupoužitelnost).

\subsection{Abstrakce} Objekt -- autonomní výpočetně úplná entita, nezávislá na architektuře

\subsection{Zapouzdření}
Modifikátory viditelnosti, přístup z venku přes veřejný protokol. Příjemce rozhoduje o odpovědi na zprávu. Může být invokace, nebo chyba.

Při zaslání zprávy sám sobě, přístup přes interní protokol, rozšířený o přístup k atributům/vlastnostem.

\subsection{Polymorfismus -- Mnohotvárnost}

Stejnou zprávu lze zaslat různým objektům (může být omezeno typovým systémem). Individuální reakce na zprávu.

\begin{description}
	\item[Brzká vazba] Určení reakce objektu v době překladu
	\item[Pozdní vazba] Určení reakce za běhu
\end{description}

Některé jazyky umožňují typ vazby změnit (C++ virtual, Java -- implicitní pozdní vazba neměnná).

\subsection{Dědičnost}

Sdílení a znovupoužití metod + předefinování specializovaných -- generalizace a specializace.

\subsection{Vytváření nových objektů}
\begin{description}
	\item[Klonováním] prototypy. Nutnost existence praobjektu
	\item[Podle šablony] Šablona = Třída. Vytvoření podle šablony a vyplnění atributů.
\end{description}

\begin{description}
	\item[Třída = Class] Šablona pro vytváření nových objektů, tzv. instancí. Obsahuje seznam atributů v instancích, implementaci metod (sdílené instancemi).
	\item[Instanciace] Vytvoření objektu + volání konstruktoru.
	\item[Instance] Identita + Reference na třídu + data atributů
	\item[Třídní model OOP] každý objekt má svoji třídu, třída je také objekt. Existují instantční a třídní položky.
\end{description}

\section{Klasifikace OOJ}
\begin{description}
	\item[Dle přístupu k vytváření objektů] \hfill
	\begin{description}
		\item[Beztřídní OOJ] prototype-based, class-less
		\item[Třídní OOJ] class-based
	\end{description}
	\item[Dle čistoty objektového modelu] \hfill
	\begin{description}
		\item[Čisté] vše je objekt
		\item[Hybridní] míchání s jinými paradigmaty
	\end{description}
	\item[Dle platformy pro běh OO programů] \hfill
	\begin{description}
		\item[Překládané] efektivita
		\item[Interpretované] pomalejší, flexibilnější
		\item[Částečně interpretované] mezikód, virtuální stroj (Java)
	\end{description}
	\item[Dle dědičnosti] \hfill
	\begin{description}
		\item[Jednoduchá a Vícenásobná] Vícenásobná problematická a často zbytečná
		\item[Dle předmětu dědění] \hfill
		\begin{description}
			\item[Dědičnost implementace] Třídní (nadtřída/podtřída), Delegace
			\item[Dědičnost rozhraní]
		\end{description}
	\end{description}
	(nejen OOJ:)
	\item[Dle způsobu určení typu] Beztypové, netypované a typované
	\item[Dle důslednosti kontrol typů] \hfill
	\begin{description}
		\item[Silně typované] type-safe
		\item[Slabě typované] implicitní konverze
	\end{description}
	\item[Dle doby kontroly typů] \hfill
	\begin{description}
		\item[Staticky] v době překladu
		\item[dynamicky] v době běhu
	\end{description}
	
	
\end{description}

\section{Třídní OOJ}

\paragraph{Extent} kolekce všech instancí dané třídy

\subsection{Podtřída / subclass} přímý potomek -- replikace a přidaní nových položek, redefinice zděděných metod.

\paragraph{Relace dědičností} částečné uspořádání na množině tříd

Objekt nebo třída musí být popsán před prvním použitím. 

\subsection{Operace nad instancemi}
Objekt jako chytrá datová struktura.
\begin{itemize}
	\item přístup k atributům
	\item zaslání zprávy instanci (získání třídy, hledání metody ve třídě a nadtřídách -- super/base, invokace metody (skrytý self parametr -- chytrá funkce), návrat hodnoty výsledku odesílateli)
	\item modifikátory přístupu (konfigurace zapouzdření) -- private, protected, internal, public
\end{itemize}

\subsection{Operace nad třídami}
\begin{itemize}
	\item Třída jako objekt první kategorie: Třída je objekt = analogický postup.
	\item Třída jako speciální entita jazyk:
	\begin{itemize}
		\item Statické atributy -- deklarace a definice ve třídě
		\item Statické metody -- typicky bez self parametru, klasická funkce ve jmenném prostory třídy.
	\end{itemize}
\end{itemize}

Pro invokaci metody je potřeba hlídat kontext (self/this, super/base), zásobník kontextů.

Implementace třídních OOJ:
\begin{itemize}
	\item Požadavky $\times$ Skutečnost
	\item Objektová paměť (asociativní, heterogenní) $\times$ Počítačová (lineární, homogenní)
	\item Model výpočtu: Zasílání zpráv $\times$ instrukce CALL, zásobník volání
	\item Uložení instancí a přístup ke zděděným položkám
	\item Vícenásobná dědičnost
	\item Přístup k položkám instance -- nultý skrytý parametr
	\item Rušení instancí objektů
	\begin{description}
		\item[Implicitní] Garbage collector
		\item[Explicitní] Destruktur -- finalizační metoda
	\end{description}
	\item Třída jako typ: B podtřída A $\land$ $\beta$ instanceOf(B) $ \Rightarrow \beta $ instanceOf(A). Instanci lze využít všude, kde je vyžadována nadtřída A. 
	\item Běhová prostředí
	\begin{description}
		\item[Kompilované] OS, CPU, Binární kód
		\item[Interpretované] opakuje front-end analýzu zdroje
		\item[Částečně interpretované] VM, Bajtkód, virtuální stroj
	\end{description}
\end{itemize}

\subsection{Překladač}
Modulární OOJ, složitější o kontrolo dodržování ABI (rozhraní mezi programem a OS), lokální tabulky symbolů.

\emph{Lexikální a syntaktická analýza} podobná strukturovaným jazykům.

\emph{Sémantická} je velmi náročná. Často více průchodů, komplikovanější typový systém (Explicitní přetypování).

\emph{Interpret} mezikód a interpretace. Často existuje interaktivní konzole -- workplace -- mizí rozdíl mezi vývojovým a běhovým prostředím. Obsahuje čistý OO model, objektovou paměť, vnitřně může probíhat nějaká optimalizace.

\subsection{Typy $\times$ Třídy}

\emph{Typ} je množina validních hodnot a operací nad nimi (obecnější).

\emph{Třída} je množina vnitřních stavů a operací nad nimi. Často určuje typ.

Typ může být:
\begin{itemize}
	\item Daný jménem -- Vyžádaná dědičnost (např. dědičnost)
	\item Daný výčtem položek -- skutečný (pod)typ
	\item Kombinace -- např. vícenásobná dědičnost tříd nebo rozhraní (staticky), systémy s rolemi (dynamicky)
\end{itemize}

\subsection{Vícenásobná dědičnost (třídní)}

Problémové, často není potřeba pro dobrý návrh. Většinou lze nahradit rozhraními.

Problémy:
\begin{itemize}
	\item Obsahují stejně pojmenované položky stejného typu
	\begin{itemize}
		\item Metody -- Zakázat, skrýt, povinná redefinice
		\item Atributy -- Zakázat, skrýt, sloučit
	\end{itemize}
	\item Obsahují stejně pojmenované položky různého typu
	\begin{itemize}
		\item Metody -- Zakázat, souběžná existence (další zátěž překladače)
		\item Atributy -- Zakázat
	\end{itemize}
	\item Pořadí volání konstruktorů
	\begin{itemize}
		\item Implicitní -- pořadí zápisu a zanoření do nadtříd pomocí DFS -- acyklické pořadí
		\item Explicitní -- nebezpečí uváznutí, nebo vynechání některého konstruktoru
	\end{itemize}
	\item Uložení instancí do paměťi -- za sebou?
\end{itemize}

\subsection{Rozhraní}

Schéma deklarující seznam metod, které je třeba implementaovat. Často vícenásobné -- jednodušší. Využitelné pro polymorfismus (stačí vyžadovat rozhraní).

\paragraph{Abstraktní třída}
obsahuje minimálně jednu abstraktní metodu, kterou je třeba implementovat. Rozhraní s imlementací.

\paragraph{Protokol}
Množina všech zpráv, kterým objekt rozumí (postup hledání reakce na zprávu).

\subsection{Systémy s rolemi}
vícetypový objekt, více rolí, které může získávat a pozbývat (bind/unbind). Využití v OO databázích -- ACID vlastnosti. Interpretované systémy s objekty s dlouhou dobou života.

\paragraph{Persistentní objekt}
Přežívá dobu běhu aplikace. Po dalším spuštění je zase k dispozici. Není ukládání a načítání na aplikační úrovni! K slovo persistent -- buď jen hodnoty, nebo i ostatní položky (i třídy pro role). 

\paragraph{Transcendentní (dynamický) objekt}
Neperzistentní.

\section{Beztřídní OOJ}

Vytváření objektů klonováním prototypů. SELF, Slate, Lua, Javascript.

\paragraph{Delegace} sdílení položek mezi objekty. Může být dynamická -- možnost měnit rodiče za běhu.

Většinou interpretované systémy

\subsection{SELF}

Objekt je seznam položek, tzv. sloty.

\paragraph{Slot} Jméno + odkaz na data/metody/rodičovský objekt.

\begin{description}
	\item[Data] seznam slotů bez kódu
	\item[Metoda] Objekt metody s jejím kódem.
	
	Při invokaci se klonuje a vzniká aktivační objekt. Tvoří jmenný prostor (kontext). Sloty reprezentují parametry metody. Chybí klíčové slovo self, ale objekt obsahuje sloty pro delegaci
	\item[Třída (rys)] objekt pouze se sdílenými metodami a rodičovskými sloty pro delegaci
\end{description}

\paragraph{Prototyp}
Datové sloty pro atributy a jejich implicitní hodnoty. Deleguje na rysy (sdílené instanční metody).

\paragraph{Instanciace -- vytvoření instance}
Mělká kopie prototypu.


\section{Ostatní (nejen) OOP koncepty}

\subsection{Výjimky}
Způsob ošetření neočekávaných chybových stavů mimo produkční kód. Objekt propagující informace o vzniklé chybě (kategorizace pomocí hierarchie tříd). Vyvolání throw/rise -- změna modelu výpočtu. Ošetření try -- catch -- finaly

\subsection{Generický polymorfismus a šablony}
\begin{description} 
	\item[Statický] typový parametr, hodnotou typ. Šablony textové, Genericky řízeno implicitním přetypováním
	\item[Dynamický] polymorfní metody, pozdní vazba
	\item[Ad-Hoc] přetěžování operátorů
\end{description}





























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Programování v jazyku symbolických instrukcí} \label{cha:37}

1. semestr, IAS, celý rozsah

(činnost počítače, strojový jazyk, symbolický jazyk, asembler)

\section{Symbolický jazyk}

Zápis algoritmu pomocí symbolických instrukcí čitelných pro lidi

\section{Strojový jazyk}

Přeložený symbolický jazyk do kódu, který může procesor přímo provádět

\subsection{Programování v jazyky symbolických instrukcí}
\begin{itemize}
	\item Podrobně analyzovat zadaný problém
	\item Naznačit řešení v notaci vyššího prog. jazyka
	\item Strukturovat program (procedury, makra)
	\item Podrobně komentovat
\end{itemize}

\subsection{Model počítače}
CPU (Registry, řadič, ALU),Paměť a IO propojeny sběrnicí (Address, Controll, Data).

Registry: Akumulátor A, Instrukční registr IR, Registr ukazatele instrukcí IP.

Paměť -- nelze určit význam obsahu -- znak, číslo, instrukce. Musí znát program, CPU.

Instrukce -- Operační kód (jednoznačné určení operace), adresy operandů, operandy

\subsection{Typy instrukcí}
Celočíselné:
\begin{description}
	\item[přenosové] MOV, XCHG, PUSH, POP, IN, OUT
	\item[aritmetické] ADD, ADC, SUB, SBB
	\item[logické] AND, OR, XOR, TEST, NOT
	\item[posuvy a rotace] SAR, SHR, SHL, SAL, RL, ROR, RCL, RCR
	\item[skokové instrukce] JMP, JCC, JCXZ, LLOP, CALL, RET, IRET
	\item[řetězové] předponty REP, REPE, REPL, REPNE, REPNZ
\end{description}
FPU instrukce, MMX, systémové

\subsection{Činnost počítače}
\begin{enumerate}
	\item Do IR se uloží obsah pěmati adresované registrem IP
	\item Nastaví se IP na další instrukci
	\item Dekódování obsahu IR
	\item Provedení operace
	\item Pokud nebyla instrukce HALT, skok na 1.
\end{enumerate}

\section{Intel}

Registry 8 bit: AL, AH: byte\\
Registry 16bit: AX: word\\
Registry 32bit: EAX: double word

Formát instrukce:

\begin{tabular}{ *{5}{ | c} |}
	\hline
	prefixes 	& opcode	& r/w	& displ. & imm. op. \\
	0-4 B		& 1-2 B	& 0-1 B & 0-2 B & 0-2 B \\
	\hline
\end{tabular}

\subsection{Efektivní adresa EA}

(v 16bit základním režimu)

EA = báze + index + displacement

fyzická adresa = segmentová adresa * 16 + offset

instrukce: (Code segment) CS:IP (instruction pointer)
zásobník: (Stack segment) SS:SP (stack pointer)

\subsection{Výjimky, přerušení}

Pro ošetření výjimečné situace (dělení nulou), nebo požadavek vnějšího zařízení.

\begin{enumerate}
	\item Vykonává se program
	\item Požadavek na přerušení
	\item Dokončí se instrukce, IP a Flags se umístí na zásobník
	\item Z tabulky přerušení se přečte adresa ISR, umístí se do IP
	\item Provádí se ISR
	\item Po dokončení se načte IP a Flags ze zásbníku
	\item Pokračuje původní program
\end{enumerate}

\subsection{Překlad}

example.asm $=>$ nams.exe $=>$ example.obj, example.lst, example.com\\
 (, protokol o překladu, spustitelný soubor)

\subsection{Sestavení}

example.obj $=>$ link.exe $=>$ example.map, example.com\\
 (protokol o uložení, spustitelný soubor)






























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Služby aplikační vrstvy} \label{cha:38}

5. semestr, ISA, 8., 11., 12. přednáška\\
4. semestr, IPK, 2. přednáška

(email, DNS, IP telefonie, správa SNMP, Netflow)

\subsection{Architektury}
\begin{itemize}
	\item Klient/server
	\begin{itemize}
		\item Server -- pevná adresa (IP, DNS), zátěž možno rozložit na více strojů
		\item Klient -- komunikace se serverem, připojení/odpojení. Nekomunikují mezi sebou, proměnná adresa. Iniciuje komunikaci
	\end{itemize}
	\item Peer-to-peer -- žádný vyhrazený server po dobu provozu. Vysoce škálovatelné, ale náročné na správu
	\item Hybridní -- kombinace výše uvedeného (Skype, IM)
\end{itemize}

\paragraph{Adresování} IP adresa určuje počítač v síti, číslo portu určuje běžící proces.

\subsection{Aplikační protokol}
Proprietální $\times$ Public domain
\begin{itemize}
	\item Typy zpráv, které se vyměňují (např. dotaz/odpověď)
	\item Syntax typů zpráv -- struktura zprávy, její položky
	\item Sémantika jednotlivých položek
	\item Pravidla kdy a jak se posílají zprávy
\end{itemize}

\paragraph{Požadavky na transportní vrstvu} Ztrátovost, propustnost, bezpečnost, zpoždění. TCP $\times$ UDP -- viz kapitola č. \ref{cha:39}

\section{Web/HTTP}
\begin{itemize}
	\item klient/server
	\item dotaz -- odpověď
	\item TCP 80
	\item nestavový ($\to$ cookies)
\end{itemize}

1.0 bez stálého spojení (nonpersistent)

1.1 persistent -- přenos více objektů přes jedno spojení

\section{FTP}
přenos souborů, přistup do vzdáleného souborového systému

\begin{itemize}
	\item klient/server
	\item TCP 21 řídící, 20 datové (aktivní a pasivní mód)
	\item nestavový ($\to$ cookies)
\end{itemize}

\section{DNS}

Mapuje doménová jména na adresy IP a obráceně. Distribuovaná databáze všech doménových jmen a adres IP.

\paragraph{Architektura}
Distribuovaná, hierarchie mnoha jmenných serverů rozdělených do zón (decentralizace).

\paragraph{Aplikační protokol}
Formát zpráv pro rezoluci DNS záznamu -- hierarchicky uspořádané záznamy.

Dotaz a odpověď má stejná formát.

\begin{itemize}
	\item Kořen -- root -- ""
	\item Doména -- podstrom v grafu
	\item Doménové jméno -- cesta mezi vrcholem domény a kořenem (oddělené tečkami)
	\item Listy stromu -- konkrétní síťová zařízení
\end{itemize}

\paragraph{Reverzní mapování}
Záznamy DNS jsou indexovány podle IP adres, pod stromem ".arpa.in-addr"

\paragraph{Registrátoři domén} ICANN, CZ-NIC, IP-RIPE NCC.

\subsection{Druhy DNS serverů}
\begin{description}
	\item[Primární] úplné (autoritativní) záznamy o doménách, které spravuje. Provádí aktualizace
	\item[Sekundární] Autoritativní kopie dat z primárního serveru
	\item[Záložní] caching only -- přeposílá dotazy, vyrovnávací paměť, neautoritativní odpovědi.
	\item[Kořenové NS] kontaktovány lokálními, pokud nevědí jak provést rezoluci
\end{description}

\paragraph{Resolver}
klientský program, který získává informace od DNS serverů

\paragraph{Rezoluce}
Proces vyhledání odpovědi v DNS systému (stromová struktura).
\begin{itemize}
	\item Rekurzivní dotaz -- pokud server nezná odpověď, ptá se dále.
	\item Iterativní dotaz -- server odpoví kde hledat dále.
\end{itemize}

Každý záznam má \emph{dobu platnosti}, po kterou je udržován v cache. Aktualizace po vypršení, nebo po explicitním DNSUPDATE.

\subsection{Záznam}

\verb|name   ttl   class (IN)   type   data|

\paragraph{Typy záznamů}
A, AAAA, CNAME, DNSKEY, DS, KEY, MX, NAPTR (sip), NS (autoritativní), NSEC, PTR (reverzní mapování), RRSIG, SOA (detaily zóny), SRV (lokalizace, rozložení zátěže), TXT

\subsection{Bezpečnostní rizika}
\begin{itemize}
	\item Podvržení DNS odpovědi -- hádání 16bit. ID
	\item Podvržení do cache -- zneužití sekce additionals v odpověďi cache serveru
	\item DDos
\end{itemize}


\section{Email}

\paragraph{Klient (UA -- User Agent)} vytváření a čtení zpráv. Protokoly SMTP, POP3, IMAP.

\paragraph{Server (MTA -- Message Transfer Agent)} přenos zpráv ze zdrojového počítače na cílový (na pozadí, obálka). Protokol SMTP.

\subsection{SMTP} Simple Mail Transfer Protokol

Multimédia (přílohy, nestandardní kódování) popsána standardem MIME (SMTP standard pro 7bit. kódování).

\paragraph{Struktura zprávy}
\begin{itemize}
	\item Obálka (po uložení na severu odstraněna)
	\item Adresa odesílatele
	\item Adresa příjemce / příjemců
	\item Priorita
\end{itemize}

\paragraph{Zpráva}
\begin{itemize}
	\item Hlavička (Date, From, Sender (kdo skutečně), Message-ID, Cc, Bcc, Subject, In-Reply-To)
	\item Tělo
\end{itemize}

\paragraph{MIME} reprezentace netextové informace v textovém protokolu. Kódování, možnost šifrování.
\begin{itemize}
	\item base64 -- převod 3 x 8 bitů na 4 x 6 bitů
	\item quoted-printable -- převod znaků z horní poloviny ASCII na =xx, kde xx je jejich hodnota
\end{itemize}

25, textový, identifikace (HELO), přenos (MAIL FROM, DATA, CRLF.CRLF), ukončení (QUIT).

\subsection{Čtení zpráv}

manipulace, zobrazení, uložení na serveru. Formát daný aplikací, vhodný pro čtení, vyhledávání, přesouvání, mazání

\paragraph{POPv3}
TCP 110, jednoduchý, snadná implementace, načtená data kopíruje na lokální počítač, vyžaduje výlučný přístup ke schránce.

Autorizace -- Transakce -- Ukončení (aktualizace).

\paragraph{IMAPv4}
TCP 143, práce s více schránkami, náročnější na implementaci a výkon.

Umožňuje práci offline a následnou synchronizaci zpráv.


\section{Hlasové služby}

\paragraph{Voice over IP} integrace datových a hlasových služeb, rozšířené vlastnosti telefonů a ústředen VoIP, centrální správa systému, snížení nákladů za hovory, mobilita, integrace s PSTN (klasické telefonní sítě -- spolehlivé, kvalita zvuku, nezávislé napájení).

\paragraph{PSTN} Edge device, lokální smyčka, PBX switch, Centrall Office, páteřní spoje. Signalizace kontrolní, adresová a informační. Lokální a síťová.

\subsection{Funkce IP telefonie}
\begin{itemize}
	\item Převod hlasu na IP datagramy (IP telefon)
	\item Řízení komunikace (ústředna) -- adresování, registrace, směrování
	\item Připojení do klasické telefonní sítě (brána)
	\item MCU -- Řízení komunikace více bodů zároveň -- konference
\end{itemize}

\paragraph{Protokoly}
\begin{itemize}
	\item Signalizační -- H.323, SIP
	\item Transportní -- RTP, RTCP
\end{itemize}

\subsection{Digitalizace signálu}

Vzorkování, kvantifikace, vzorků, kódování, komprese -- kodeky: např. G.712 (ITU), PCM, 64kb/s

\emph{Zapouzdření} Ethernet (18B), IP (20B), UDP (8B), RTP (12 B), DATA (třeba 160 B).

\paragraph{Kvalita} ozvěna, zpoždění, rozptyl (jitter), ztrátovost, kodek.

\emph{Hodnocení kvality}
\begin{itemize}
	\item ACR -- stupnice MOS 1-5 subjektivní, nebo objektivní
	\item E-mode -- R-faktor 0-100 podrobnější hodnocení (šum, pokles, zkreslení)
\end{itemize}

\subsection{SIP}
Sessoin Initiation Protocol -- textový protokol, vytváří a udržuje relaci, adresace, registrace, směrování hovorů.

\paragraph{UAS -- User Agent server}
\begin{itemize}
	\item Proxy -- analýza zpráv a směrování
	\item Lokalizační -- umístění klientů
	\item Směrování -- Další bod spojení u alternativních SIP serverů
	\item Registrační -- přijímá žádosti a aktualizuje lokalizační servery
\end{itemize}

\paragraph{UAC -- User Agent Client}
SIP telefon, PC s klientem.

\paragraph{Struktura}
Struktura UAC a UAS tvoří na L7 vlastní síť.
\begin{itemize}
	\item Adresování: \verb|sip:user@domain|
	\item Směrování: Hlavičky SIP paketů -- Via, Route, Record-Route. Provádějí SIP servery na cestě.
\end{itemize}

\paragraph{Příkazy}
\begin{itemize}
	\item REGISTER: registr podobný autoritativnímu DNS server. UAC překládá ID zařízení na adresu zařízení. Register server $\to$ Localization Database
	\item INVITE: Volající pošle volanému zprávu, pokud je připraven odpoví, potvrzení ACK a začátek komunikace.\\
		Směrování: žádost (Route), odpověď (Via).\\
		Komunikace nejdříve přes Proxy, po výměně kontaktů přímo.
	\item ACK, CANCEL, BYE, OPTIONS (zjišťování možností přenosu)
	\item INFO, MESSAGE, SUBSCRIBE, NOTIFY, PUBLISH
\end{itemize}

lokalizace NAPTR, SRV, A (DNS záznamy)

\subsection{H.323}
ITU-T, více protokolů

terminál, brána, ústředna, MCU

\begin{description}
	\item[Signalizace volání] H.225.0 CS
	\item[RAS] Registrace, Administrace, Správa: H.225.0 RAS
	\item[Řídící kanál] H.245
\end{description}

Dva způsoby komunikace -- přímá, nebo s využitím ústředny.

\paragraph{Fáze spojení}
\begin{itemize}
	\item Registrace
	\item Kanál pro signalizaci
	\item Řídící kanál
	\item RTP kanál
	\item ukončení spojení
\end{itemize}

\subsection{Bezpečnost}

Odposlechy, Viry, DDoS, neautorizované užití linky.

\paragraph{Zabezpečení}
Přístup k síťovému médiu 802.1x autorizovat, oddělení hlasového provozu pomocí VLAN, zabezpečení IPSec, Secure RTP.

\section{Správa počítačové sítě -- SNMP}

\begin{itemize}
	\item Monitorování \hfill
	\begin{description}
		\item[Aktivní] pravidelné testování přístupnosti prvků (ICMP, SNMP)
		\item[Pasivní] syslog, SNMP traps, data NetFlow
	\end{description}
	\item Analýza provozu \hfill
	\begin{description}
		\item[Sledování v reálném čase] Wireshark na síťovém rozhraní
		\item[Dlouhodobé statistiky] stavy linek, nejvíce komunikující uzly, protokoly.
	\end{description}
\end{itemize}

\subsection{Na úrovni IP}
ICMP -- Ping, Traceroute. Hrozí prohledávání sítě, podvržení implicitní brány (některé někdy blokovat)

\subsection{Na úrovni L3 -- L7}
Monitorování dostupnosti, odezvy, sledování služeb, aplikací, topologie.

IETF -- SNMP 1989

\begin{description}
	\item[Organizační model] \hfill
	\begin{description}
		\item[Manager] (NMS) Aplikace běžící na centrálním serveru, sbírá data od agentů, analyzuje a prezentuje data
		\item[Agent] software běžící na monitorovaném zařízení, ukládá do lokální databáze, sleduje monitorované objekty a komunikuje s NMS
		\item[Proxy agent] je u zařízení nepodporující SNMP, sbírá z něj data
		\item[Sonda RMON] sbírá lokální statistiky, NMS je pravidelně čte
	\end{description}
	\item[Informační model] \hfill
	\begin{description}
		\item[Databáze MIB] Managment Information Base -- stromová struktura podle firmy, tématu
		\item[struktura a sémantika SMI] Structure of Managment Information, datové typy ANS.1, identifikace OID, kódování BER (Basic encoding rules -- Type, Length, Value).
	\end{description}
	\item[Komunikační model] komunikace přes IP, příkazy getRequest, SetRequest, getResponse, Trap. Formátování dat.
	
	Polling: UDP 161, Traps: UDP 162
	
	\item[Funkční model] Vychází z OSI FCAPS -- Fail, Configuring, Accounting, Performance, Security.
	
	Umožňuje ověřit každou zprávu, zda nebyla změna, ověřit identitu uživatele, ochrana proti DoS
\end{description}

častá SNMP komunikace může ovlivnit výkon sítě.

\subsection{Rozšíření RMON}
Remote monitoring -- distibuované LAN, MIB-II, Token Ring. Získávám komplexní pohled na síť, ne jen na část.

Možné nepřímé (offline) zpracování, potom teprve předat managerovi.

\paragraph{Proaktivní logování} nepřetržitá diagnostika

\section{NetFlow}
měření provozu na síti. Wireshark měří data, NetFlow metadata (kolik a jakých typů, od koho, nezajímá nás obsah) = síťový tok.

\subsection{Síťový tok}
posloupnost paketů mající společnou vlastnost  a procházející bodem pozorování v určitý časový interval.
\begin{itemize}
	\item Zdrojová a cílová IP
	\item Zdrojový a cílový port
	\item Název logického rozhraní
	\item Typ protokolu L3
	\item Hodnota ToS
\end{itemize}
Pokud se shodují ve všem, je to jeden síťový tok.

\subsection{Prvky}
\begin{description}
	\item[Exportér] sonda/router (SW/HW) pro získávání statistik -- Flow Records $\to$ Vytváří/nahrazuje záznamy ve Flow Cache
	\item[Komunikační protokol NetFlow]
	\item[Kolektor] (SW) Ukládání záznamů o tocích, agregace
	\item[Nástroje pro reprezentaci dat] grafy, statistiky
\end{description}

\subsection{Export}
\begin{itemize}
	\item Detekce konce toku: FIN/RST u TCP
	\item Neaktivita toku: neaktivní timer
	\item Příliš dlouhý tok: aktivní timer
	\item Zaplnění Flow Cache
\end{itemize}

\paragraph{Vzorkování}
umožňuje snížit nároky na HW, může být u kolektoru i exportéru, deterministické/náhodné.

Umožňuje zobrazení nextHop routeru pro kontrolu směrování, počet paketů/bajtů pro účtování, zákonné ukládání poskytovatelem, sledování aplikací a uživatelů, účtování, SLA






























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{TCP/IP komunikace} \label{cha:39}

4. semestr, IPK, 2. přednáška

(model klient-server, protokoly TCP, UDP a IP, řízení a správa toku TCP)

Internet -- miliony propojených počítačů.
\begin{itemize}
	\item Hosté: koncové systémy, servery
	\item komunikační linky
	\item směrovače
	\item Protokol TCP/IP -- definuje formát zasílaných zpráv, jejich příjem mezi více entitami, akce na přijaté/odeslané zprávy
\end{itemize}

Standardy: RFC, IEEE (802.x)

\subsection{Vrstvy}
\shorthandoff{-}
\begin{tabular}{ |c | l | c |}
\hline
ISO/OSI		& Popis & TCP/IP \\ \hline \hline
Aplikační	& Informační slubžy: Email, Directory & \multirow{3}{*}{Aplikační} \\ \cline{1-2}
Prezentační	& Nezávislost aplikací z pohledu reprezentace dat (ASN.1)  & \\ \cline{1-2}
\multirow{2}{*}{Relační}	& \multirow{2}{*}{Ustavení, správa a ukončení spojení} &	\\ \cline{3-3}
 & & \multirow{2}{*}{Transportní} \\ \cline{1-2}
Transportní & Přenos dat mezi aplikacemi, spolehlivý TP0, TP1, \dots & \\ \hline
Síťová		& Směrování, identifikace cesty mezi systémy & Síťová \\ \hline
Linková		& Přenos dat mezi sousedními systémy	& Linková \\ \hline
Fyzická		& Příjem a vysílání proudu bitů. > Síťová karta & Fyzická \\ \hline
\end{tabular}
\shorthandon{-}

Komunikace s okolím: Nejdříve soubory UNIXu, ale to bylo nepostačující. Nyní BSD sockets

\section{BSD Sockets}
Mechanismus pro přístup ke službám protokolů transportní vrstvy, přístup přes deskriptor (podobné souborům), ale speciální operace.

\paragraph{Operace}
\begin{itemize}
	\item Vytvoření
	\item Vazba na lokální port
	\item Vazba na vzdálený port
	\item Spojení/čekání na spojení
	\item Read/Write, speciální send/recv, sendto/recvfrom
\end{itemize}

Odlišnosti od souborů:  síťové chyby, čekání na data, SOCK\_STREAM, SOCK\_DGRAM

\paragraph{Adresace}
\begin{itemize}
	\item Síťové rozhraní: IPv4/IPv6 adresa
	\item Proces: Číslo portu
	\item Klient/server -- adresy na obou stranách
	\begin{itemize}
		\item Čtveřice
		\item Pětice (i s protokolem transportní vrstvy)
	\end{itemize}
\end{itemize}

Server: Socket(), Bind(), Listen(), Accept(), Read(), Write(), Close()

Klient: Socket(), [Bind()], Connect(), Write(), Read(), Close()

\paragraph{Organizace paměti}
Síťová x lokální, Little /Big endian

\paragraph{Blokující operace}
write (čekání na místo v bufferu), read, accept (čekání na spojení/data od klienta)

Lze nastavit operace neblokující, použít Select() -- vrací řízení, jestliže je I/O připravena

\paragraph{Konkurentní server} komunikuje se všemi klienty zároveň (pro každého klienta samostatný proces). Fork(), Signal(). Dobré, pokud není potřeba uchovávat globální stav serveru. Je třeba řešit problém sirotků.

\paragraph{Iterativní server} obsluhuje klienty v pořadí příchodu požadavků na spojení.

\section{UDP}
User Datagram Protocol -- jednoduchý bez záruky doručení (stačí pro DNS, multimedia, \dots), nevytváří spojení, port identifikuje aplikaci na cílové stanici.

\paragraph{Datagram} obsahuje Port odesílatele a příjemce, délku, kontrolní součet, data.

Porty jsou pro server využívané well-known, klient generuje většinou náhodný > 1023

\subsection{Spolehlivý přenos}
jednosměrný, chování popsáno KA.

\begin{itemize}
	\item RDT 1.0 -- přenos přes spolehlivý kanál je spolehlivý
	\item RDT 2.0 -- můžou nastávat bitové chyby, proto se používá kontrolní součet a ACK, NACK (co když se poškodí potvrzení?)
	\item RDT 2.1 -- pořadová čísla 0, 1. Kontrola pořadového čísla a potvrzení
	\item RDT 2.2 -- pouze pozitivní potvrzení
	\item RDT 3.0 -- ztráty packetů, potřeba časovače a znovuodeslání packetu.
	
	Garantuje spolehlivost, ale sám o sobě má malou výkonost $U = \frac{L/R}{RTT+L/R} \approx 0,027 \%$ L -- velikost packetu, R -- přenosová rychlost, RTT -- Round Trip Time
\end{itemize}

\paragraph{Stop-and-wait} většinu času čeká na potvrzení, velmi pomalé (výše)

\paragraph{Zřetězené protokoly} větší rozsah číslování, vyrovnávací paměti. Výkonnost N krát vyšší (počet packetů poslaných zároveň bez potvrzení prvního).

\paragraph{Go-back-N}
\begin{itemize}
	\item k-bitové sekvenční číslo
	\item okno velikosti až N pro nepotvrzené packety
	\item ACK(n) potvrzuje všechny packety $ \leq $ n
	\item časovač pro každý packet
	\item Neumožňuje přijímat packety mimo pořadí.
\end{itemize}

\paragraph{Selective Repeat}
\begin{itemize}
	\item Selektivně potvrzuje každý packet
	\item Přijímané uchovává ve vyrovnávací paměti (i mimo pořadí)
	\item časovač pro každý packet
	\item Po přijetí/potvrzení přijetí prvního packetu v okně posouvá
	\item Okno obsahuje N po sobě jdoucích čísel, rozsah sekvenčních čísel musí být alespoň dvojnásobek velikosti okna
\end{itemize}

\section{TCP}
point-to-point, spolehlivost (zachování pořadí, bez omezení velikosti), zřetězený přenos, vyrovnávací paměti, plně duplexní v jednom spojení. Spojově orientovaný (handshaking)

\paragraph{TCP segment}
Porty, číslo sekvence a potvrzení, příznaky, options, Data, Checksum.

Obsahuje jakákoliv data bez struktury -- stream v navazujících packetech.

\paragraph{Inicializace spojení}
\begin{itemize}
	\item Poloviční asociace -- protokol, IP, port
	\item Plná asociace -- protokol, IP, port, IP2, port2
\end{itemize}

\paragraph{Otevření spojení}
\begin{itemize}
	\item Aktivní -- iniciuje spojení (většinou klient)
	\item Pasivní -- čekání na spojení (server)
	\item Active-Pasive normálně, Active-Active (distribuované systémy)
\end{itemize}

\paragraph{3-way-handshake} SYN $\to$ SYN, ACK $\to$ ACK

\paragraph{Ukončení} FIN $\to$ ACK (half close), FIN $\to$ ACK od druhé strany (plné)

\paragraph{Initial Sequence number ISN} na obou stranách náhodné čísle sekvence, které postupně v komunikaci roste. K identifikaci.

\section{Řízení přístupu}
zřetězené segmenty, kumulativní potvrzení (AKC -- číslo očekávaného segmentu), jeden časovač, segmenty mimo pořadí RFC nespecifikuje.

Selektivní potvrzování (SACK -- volba při inicializace spojení).

Znovuodeslání po ztrátě packetu/ACK nebo zpoždění packetu/ACK -- jak dlouho > RTT (mění se)

\begin{description}
	\item[(Smooted) Round Trip Time] čas potřebný na přenos segmentu a přijetí potvrzení, ignorujeme měření pro znovuodeslané, nebo zpožděné ACK. Průměrná hodnota je určena z několika posledních RTT:
	
	$\text{SRTT}' = (1 - \alpha) \text{SRTT} + \alpha \text{RTT}$, kde $\alpha = 0,125$ dle RFC 
	
	\item[Rozptyl RTT] $\text{DevRTT} = (1 - \beta) \text{DevRTT} + \beta | \text{SRTT} - \text{RTT} |$, kde $\beta = 0,25$
	
	\item[Retransmission Time-Out] $\text{RTO} = \text{SRTT} + 4 \text{DevRTT}$
\end{description}

\paragraph{Karnův algoritmus}
\begin{itemize}
	\item Ignoruj měření pro znovu vyslané packety
	\item RTO by mělo být zdvojnásobeno po opakovaně vyslaném packetu (exponential Back-off)
\end{itemize}

\paragraph{Fast Retransmit}
detekce ztracených segmentů pomocí duplikovaných ACK -- ještě před vypršením timeoutu.

\subsection{Řízení toku} Klouzající okénko Sliding window. Velikost se mění během vysílání. Cílem je maximální využití přenosové linky a minimální zpoždění potvrzováním.

\paragraph{Urgentní data} interaktivní aplikace vyžadují rychlou odezvu a proto jsou tato data zaslána společně s jinými daty přednostně bez čekání na ostatní v bufferu (příznak Urgent, Urgent pointer, data).

\paragraph{PSH} příznak zabraňující uváznutí dat v bufferu (čekání na naplnění) a uváznutí komunikace. Vyžaduje okamžité odeslání opět pro interaktivní aplikace (na konci každého příkazu).

\subsection{Řízení zahlcení}

více dat, než je přenosová kapacita linka. Směrovače obsahují fronty a když jsou zahlceny, zahazují packety.

\begin{description}
	\item[Network Assisted] komponenty sítě poskytují koncový stanicím informace o stavu (ATM ABR)

	\item[End-end] bez informací o síťové vrstvě. Sledování chování -- RTT, ztráty packetů (TCP, Internet).

Řízeno koncovými systémy, jednoduchá algoritmy pro odhad stavu sítě, vhodná rychlost. Ztráta znamená zahlcení. Limity jsou odhadovány sledováním ztrát packetů.

Congestion Window (cwnd) -- každá strana počítá velikost okna, aditivní nebo multiplikativní změny velikosti

\begin{description}
	\item[Tahoe] Slow Start, Condestion Avoidance, Fast Retransmit
	
	Exponenciální růst okna až do první ztráty packetu -- proměnná \verb|ssthresh|. Při ztrátě packetu se nastavuje na hodnotu cwnd/2
	
	cwnd $<$ ssthresh -- Slow start -- exponenciální růst\\
	cwnd $>$ ssthresh -- Congestion avoidance -- lineární růst\\
	\item[Reno] Fast Recovery, Fast Retransmit
	
	Timeout  -- vážné zahlcení -- okno nastav na minimum a Slow Start systému \\
	Duplikace ACK -- není kritické -- okno zmenši na polovinu, Congestion Avoidance
	\item[New Reno] nový Fast Revovery algoritmus
\end{description}	
\end{description}	

\section{Síťová vrstva (IP)}
přeposílání, směrován (Routing).

\begin{description}
	\item[Datagramové sítě] nespojovaná služba, bezstavové směrovače, best effort
	\item[Sítě s vyhrazenými okruhy] spojovaná, stavové směrovače, host-host, různé služby.
\end{description}

\paragraph{IPv4 Datagram} verze, délka (proměnná), checksum, hlavičky, options, adresy IP, ToS (zajištění QoS), DF/MF (Don't fragment, More fragments), unikátní identifikátor, TTL -- hopcount. Protokol vyšší vrstvy.

\subsection{Adresy}
\paragraph{Třídy: prvni bity}
\begin{itemize}
	\item A: 0 (1B maska sítě)
	\item B: 10 (2B maska sítě)
	\item C: 110 (3B maska sítě)
	\item D: 1110 (Multicast)
	\item E: 1111 (rezerva)
\end{itemize}

Druhy: Unicast, Multicast, Broadcast

\paragraph{Subneting} -- maska podsítě určuje hranici mezi sítí a hostem

\paragraph{VLSM} -- Variable length subnet mask -- efektivnější využití adresového prostoru.

\paragraph{CIDR} -- Classless Interdomain Routing -- eliminace classfull adresování

\paragraph{Privátní adresy} neadresovatelné v internetu: 192.168.*, 10.*

\subsection{ICMP}
používán hosty, směrovači -- oznámení chyb, žádost o službu, diagnózu sítě.

Traceroute -- ping s TTL postupně 1- daleko

\subsection{DHCP} aplikační protokol klient/server. Mechanismus přidělení IP adresy a TCP/IP parametrů. Přes UDP.

Discover -- Offer -- Request -- Ack

\subsection{NAT}
Překlad adres. Navenek stejná IP adresa a změněny porty. NAT drží tabulku LAN/WLAN s překladem vnitřní IP+Port / Vnější IP + Port, aby mohl správně přeposílat odpovědi.

Modifikuje hlavičky (aplikační protokol musí být navržen, aby jej to neohrozilo). Další možnost přeposílání provozu zvenčí na konkrétní vnitřní IP.

































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Směrování a filtrování dat v Internetu} \label{cha:40}

4. semestr, IPK, 6. přednáška \\
5. semestr, ISA, 9., 10. přednáška

(algoritmy Link-state a Distance-vector, RIP, OSPF, klasifikace paketů a filtrování, firewally, kvalita služeb)

\section{Filtrování}

Pravidla pro vstupní/výstupní provoz, kontrola obsahu: Rozhodnutí o propuštění/zablokování paketu (Protokol, IP odesílatele a příjemce, port odesílatele a příjemce.

Př: \verb|10 permit TCP from 147.229.0.0 to any dst-port 80|

Pokročilé filtrování: inspekce paketů známých protokolů (aplikační úrovně): filtrování URL, P2P sítě. Dále například kontextově nebo časově závislá pravidla.

\paragraph{Vyhledávání adres a prefixů} směrovače, nezáleží na pořadí, hledá nejdelší shodu s prefixem.

\subsection{Klasifikace} Typy: Exact $\times$ Prefix $\times$ Interval. Výsledkem je číslo porovnávacího pravidla.

paket: $H = \{ H_1, H_2, \dots H_K\}$, $K$ hlaviček

klasifikátor: $R = \{R_1, R_2, \dots R_N\}$ pravidla, každé obsahuje K položek/dimenzí.

\paragraph{Požadavky} Rychlost, Paměťové nároky, Rozšiřitelnost, Aktualizace

\begin{description}
	\item[Podle počtu dimenzí] 1D, 2D, nD
	\item[Podle techniky vyhledávání]
	\begin{description}
		\item[Lineární] nejjednodušší implementace, časová složitost $O(N*K)$. Pro všechna pravidla projdi postupně všechny dimenze
		\item[Rozděl a panuj] rekurzivní, bitové vektory.
		\item[Stromové] Trie -- binární strom pro klasifikaci jedné dimenze IP, snadné.
		
		\paragraph{Vícebitové} n-nární strom, kde počet potomků určuje krok -- více bitů se porovná v každém kroku. Vyžaduje přesnou velikost prefixů.
		
		Komprese: V uzlu hodnota, či ukazatel. Bitová mapa (Lulea)
		
		\paragraph{Stromové vyhledávání ve 2D} pro každou dimenzi strom trie, stromy druhé úrovně se duplikují -- prostorová složitost $O(N^K)$
		
		\emph{Stromové vyhledávání ve 2D bez duplicit + backtracking} -- snížení prostorové náročnosti, ale roste časoví.
		
		\emph{S ukazateli na další možný strom} -- snížení časové náročnosti
		\item[Bitové vektory] 
		\item[Vektorové součiny]
		\item[Rozhodovací stromy]
	\end{description}
\end{description}

\paragraph{Vyhledávání ve více dimenzích}
časově i prostorově náročné, jsou přijaty kompromisy, využívány různé heuristiky. Např. prefix IP má maximálně 24bitů, neřeší se průniky prefixů, nepoužívají se intervaly (praxe).

\begin{enumerate}
	\item Lineární -- preference dvojic S+D IP (kombinace 2D) + lineární průchod dalšími dimenzemi.
	\item Bitový vektor -- pro každou hlavičku (jednotlivé bity jsou jednotlivá pravidla), výsledek bitovým AND
	\item Vektorový součin -- množina všech kombinací v R, předpočítány vektorové součty
	\item Rekurzivní klasifikace toků dle RFC -- třídy ekvivalence, redukce paměťové složitosti, vznikají dílčí vektorové součty a vektorové součty nad třídami. Stromová struktura.
\end{enumerate}

\paragraph{Využití} Firewally, QoS, detekce útoků

\section{Zajištění kvality služeb}

Protokol IP přenáší data s kvalitou Best Effort delivery. Pro potřeby splnění SLA (Service Level Agreement) potřeba upravit (dostupnost, charakteristika).

Přizpůsobení provozu: Označení paketů, omezení/rozložení provozu.

\begin{description}
	\item[Rozložení provozu (shaping)] Regulace rychlosti a objemu. Řešení shluků pomocí front. Lepší využití pásma (Výstup ISP).
	\item[Omezení provozu (policing)] Řízení maximální rychlosti. Neprovádí ukládání, pakety zahazuje (Vstup ISP).
\end{description}

\subsection{Plánování QoS pomocí front}
\begin{description}
	\item[FIFO] Bez priorit
	\item[Prioritní fronty] Více front, rozdělení podle klasifikace -- hrozí hladovění
	\item[Cyklické fronty (Round Robin)] fronta odpovídá toku, cyklická obsluha všech front
	\item[Váhové fronty WFQ] Dynamické vytváření/zánik front pro jednotlivé toky. Váha určuje počet odebíraných paketů z fronty.
	\item[Leaky Bucket] řízení toku (shaping, vstup)
	
	Počítadlo X. Inkrementace o r, rychlost. Pacet projde, pokud je v počítadle dostatečná velikost pro příchozí paket. Omezená délka vstupní fronty.
	
	\item[Token Bucket] omezení rychlosti (hloubkou vědra určíme maximální výkyvy).
	
	Může být s frontou, nebo bez. Tokeny generovány určitou rychlostí, pokud jich je dost, pošleme dále paket (velikost, počet).
\end{description}

\paragraph{Specifikace toku QoS u Integrovaných služeb}
\begin{itemize}
	\item CIR -- průměrná rychlost (r = token rate)
	\item R -- maximální rychlost generování paketů
	\item CBS -- max. bytů při rychlosti R (b = bucket size)
	\item T -- maximální doba trvání špičky
\end{itemize}

\subsection{Integrované služby IntServ}
zajištění QoS nad IP. Rezervace zdrojů pomocí protokolu RSVP. Pevně vytvořené spojení.

\paragraph{Třídy služeb} malý počet, nedostatečná granularita. 
\begin{enumerate}
	\item Garantované služby -- striktní maximální zpoždění ve frontách
	\item Kontrolování zátěže
	\item Největší úsilí -- běžná kvalita nad IP
\end{enumerate}
\paragraph{RSVP} signalizační protokol pro rezervaci zdrojů, provádí koncová stanice, rezervace pásma v multicastových stromech. Nepoužitelné pro páteční směrovače.

\subsection{Diferencované služby DiffServ}
velká rozšiřitelnost, konfigurovatelnost a flexibilita, možnost rozložení zátěže na jiné linky.
\begin{description}
	\item[Klasifikace] edge směrovače -- podle údajů z hlavičky (IP, TCP, UDP), nastaví IP precedenci, ToS nebo DS bajt (třída chování, priorita zahazování).
	\item[Přeposílání] backbone směrovače
\end{description}

\paragraph{Třídy chování}
\begin{itemize}
	\item EF Přednostní přeposílání
	\item AE Garantované přeposílání
	\item BE Nejvyšší úsilí
\end{itemize}

\paragraph{Priorita zahazování (viz WRED)}

Interactive Voice $>$ Video $>$ Streaming media $>$ Local critical (SAP, Oracle) $>$ Telephone signaling $>$ Network signaling $>$ P2P $>$ WWW, Email

\subsection{Prevence zahlcení}
problém front na síťových zařízeních -- globální synchronizace TCP, hladovění

\paragraph{RED} Random Early Detection -- zahazování paketů od určité meze zaplnění fronty. Režimy: Nezahazování, Náhodné zahazování, úplné zahazování.

\paragraph{WRED} Weighted RED -- využívé IP precedenci/DSCP, příznak drop probability. Zaplnění fronty pro začátek zahazování je různý pro různé třídy.

\section{Směrování}

Síťová vrstva, zajišťuje doručení paketů koncovým zařízením. Šíření směrovacích informací v internetu (směrovací protokoly).

Směrovač musí rozhodnout, na které rozhraní má paket přesunout pro dosažení cíle.
\begin{itemize}
	\item Přepínání (forwarding) -- lokální akce přesunu paketu z jednoho rozhraní na jiné
	\item Směrování (routing) -- nalezení cesty pro packet. Používá směrovací algoritmus (Distribuovaný výpočet).
\end{itemize}

\subsection{Směrovací tabulka} obsahuje pro každou IP (prefix) odpovídající rozhraní na které má být předána. Může být definována staticky, nebo aktualizována pomocí směrovacích protokolů.
\begin{description}
	\item[Perfect match podle třídy] rozpoznání třídy podle prvních bitů.
	\item[CIDR] agregace adres ve směrovačích + šíření
	\item[Longest prefix match] prefixové stromy
	\item[MLPS] virtuální okruhy, speciální hardware pro match IP a prefixu: CAM (hodnoty 0,1,x)
\end{description}

\paragraph{koncová stanice} Vlastní adresu doručí lokálně, lokální adresu pošle přímo, adresu mimo síť pošle na lokální bránu.

\subsection{Směrovač}
Funkce směrovače:
\begin{description}
	\item[Zpracování směrovacích informací] -- cesta, směrovací tabulka, směrovací protokoly
	\item[Přepínání paketů] validace, cílová adresa, nalzení výstupního rozhraní, kontrola TTL, checksum
	\item[Speciální] Transformace paketů, tunelování, klasifikace, filtrování, účtování.
\end{description}

\subsection{Vývoj směrovačů}
\begin{description}
	\item[1. generace] SW směrovače
	\item[2. generace] Paralelní zpracování, vnitřní sběrnice pro komunikaci (do roku 2000)
	\item[3. generace] Distribuované zpracování
\end{description}

\begin{description}
	\item[Sběrnice s centrálním CPU] Zpracovává všechny požadavky
	\item[Sběrnice s lokální cache] Zpracovává na kartě. Co nelze je předáno centrálnímu CPU (také aktualizace cache, příjem směrovacích informací)
	\item[Sběrnice s paralelním zpracováním] Vše je přeposláno z karty na Forwarding Engine a ten přeposílá opět na některou z karet.
	\item[Přepínač s více procesory] rychlejší -- fast/slow path (výpadek cache FE). Limitující obsluha cache.
\end{description}

\section{Směrovací algoritmy}

\subsection{Dijkstrův algoritmus}
Topologie sítě je předem známa všem uzlům, včetně ceny linek. Všichni mají stejné informace.

Každý směrovač počítá cestu pro každou síť s nejmenší cenou.

\lstset{caption={Dijkstrův algoritmus}}
\begin{lstlisting}
forall nodes v
	if v is adjacent to A then
		D(v) = C(A,v)
	else
		D(v) = inf
N = {A}
loop
	find n not in N such that D(w) is a minimum
	add w to N
	forall v adjacent to w and not in N
		D(v) = min(D(v), D(w) + C(w,v))
until all nodes in N
\end{lstlisting}

\subsection{Distance-Vector -- Bellman-Fulkerson-Fordův algoritmus}
iterativní, nové infromace se šíří mezi sousedy, distribuovaný výpočet -- komunikace se sousedy a výpočet ceny cesty.

Každý uzel obsahuje tabulku: řádku=cíle, sloupce=sousedé, buňky=ceny.

Stavy: Čekáni na změny od souseda -- přepočet -- informování sousedů, pokud nastala změna.

Dobré zprávy se šíří rychle, špatné pomalu. Poison-Reverse zabraňuje označením ceny cesty na nekonečno (Zabraňuje počítání do nekonečna).

\subsection{Path-Vector}
uvnitř AS. Počítáno na všech uzlech pro všechny cíle. Pro každý uzel je spočítána celá cesta (detekce smyček). Flexibilní lokální politiky může aplikovat každý uzel.

BGP. Politiky jsou smlouvy mezi ISP


\section{Směrovací protokoly}
\begin{description}
	\item[RIP] Classfull v1, Classless v2, metrikou je hopcount ($>$ 15 je $\infty$). Každých 30 sekund aktualizace (UDP, Broadcast)
	
	Request Message (spuštění směrovače), Response Message (odpověď, aktualizace tabulky
	
	180 sekund bez odezvy -- neplatný směrovač, zneplatněna cesta a šíření informace.
	
	\item[OSPF] Open Shortest Path First -- šíření informace o změně v celé oblasti (flooding). Využit Dijkstrův algoritmus, aktualizace po změně, nebo po 30 minutách, testování linek pomocí HELO paketů.
	
	IP protokol (ACK, znovuodeslání, sekvenční čísla), lze zabezpečit, vyvaovat zátěž. Multicast OSPF
\end{description}












\end{document}
